<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>学成在线--内容管理模块开发 | Kyle's Blog</title><meta name="keywords" content="SpringBoot,SpringCloud,MyBatisPlus"><meta name="author" content="Kyle Violet"><meta name="copyright" content="Kyle Violet"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="黑马学成在线--内容管理模块开发">
<meta property="og:type" content="article">
<meta property="og:title" content="学成在线--内容管理模块开发">
<meta property="og:url" content="https://cyborg2077.github.io/2023/02/02/XuechengOnlinePart2/index.html">
<meta property="og:site_name" content="Kyle&#39;s Blog">
<meta property="og:description" content="黑马学成在线--内容管理模块开发">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic3.zhimg.com%2Fv2-dbe4189cad999946abdcd174fba140ea_r.jpg&refer=http%3A%2F%2Fpic3.zhimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1651217592&t=44946406f8e7b9ed15f483e0495b33c9">
<meta property="article:published_time" content="2023-02-02T15:19:40.000Z">
<meta property="article:modified_time" content="2023-03-27T02:53:53.257Z">
<meta property="article:author" content="Kyle Violet">
<meta property="article:tag" content="SpringBoot">
<meta property="article:tag" content="SpringCloud">
<meta property="article:tag" content="MyBatisPlus">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic3.zhimg.com%2Fv2-dbe4189cad999946abdcd174fba140ea_r.jpg&refer=http%3A%2F%2Fpic3.zhimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1651217592&t=44946406f8e7b9ed15f483e0495b33c9"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://cyborg2077.github.io/2023/02/02/XuechengOnlinePart2/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?f8440b73b5064587c92bcc0ec23ce01c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-RQZSMGWCQS"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-RQZSMGWCQS');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '学成在线--内容管理模块开发',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-27 10:53:53'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script data-pjax src="https://ali-oss.xmwpro.com/cdn/js/echarts.min.js"></script><script src="https://npm.elemecdn.com/echarts@5.3.2/dist/echarts.min.js"></script><link rel="stylesheet" href="/css/readPercent.css"><link rel="stylesheet" href="/css/custom/twikoo_beautify.css"  media="defer" onload="this.media='all'"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_3049706_6drr2nvsz9b.css"><link rel="stylesheet" href="/css/wave.css"><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><style type="text/css"> #universe {  display: block; position: fixed; margin: 0; padding: 0; border: 0; outline: 0; left: 0; top: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; } </style><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-categories-card@1.0.0/lib/categorybar.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-clock/lib/clock.min.css"><link rel="stylesheet" href="/css/runtime.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.15/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2022/04/18/fj4XvrdM5o62hbA.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">105</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">86</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw iconfont icon-liuyan"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-shenghuo"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gossip/"><i class="fa-fw iconfont icon-talk-new"></i><span> 闲言碎语</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw iconfont icon-bilibili"></i><span> 追番</span></a></li><li><a class="site-page child" href="/secret/"><i class="fa-fw fas fa-heart"></i><span> 记忆胶囊</span></a></li><li><a class="site-page child" href="/fitness/"><i class="fa-fw iconfont icon-jianshen-"></i><span> 健身日寄</span></a></li><li><a class="site-page child" href="/reward/"><i class="fa-fw iconfont icon-zhangdan"></i><span> 打赏榜单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic3.zhimg.com%2Fv2-dbe4189cad999946abdcd174fba140ea_r.jpg&amp;refer=http%3A%2F%2Fpic3.zhimg.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1651217592&amp;t=44946406f8e7b9ed15f483e0495b33c9')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Kyle's Blog</a></span><div id="he-plugin-simple"></div><div id="none_space"></div><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw iconfont icon-liuyan"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-shenghuo"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gossip/"><i class="fa-fw iconfont icon-talk-new"></i><span> 闲言碎语</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw iconfont icon-bilibili"></i><span> 追番</span></a></li><li><a class="site-page child" href="/secret/"><i class="fa-fw fas fa-heart"></i><span> 记忆胶囊</span></a></li><li><a class="site-page child" href="/fitness/"><i class="fa-fw iconfont icon-jianshen-"></i><span> 健身日寄</span></a></li><li><a class="site-page child" href="/reward/"><i class="fa-fw iconfont icon-zhangdan"></i><span> 打赏榜单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">学成在线--内容管理模块开发</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-02-02T15:19:40.000Z" title="发表于 2023-02-02 23:19:40">2023-02-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-27T02:53:53.257Z" title="更新于 2023-03-27 10:53:53">2023-03-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/">实战项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">27.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>116分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="学成在线--内容管理模块开发"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>在此特别感谢黑马程序员提供的课程</p>
</blockquote>
<div class="bvideo">
    <a href="//www.bilibili.com/video/BV1j8411N7Bm" target="_blank">
        <div class="bvideo-box">
            <div class="bvideo-cover">
                <div class="cover-default"></div>
                <div class="bvideo-cover-layer" style="background-image:url(https://images.weserv.nl/?url=http://i0.hdslb.com/bfs/archive/b15eeaafd0ed8d6defd00e81a5f4181d3aafd757.jpg)">
                    <i class="icon-video"></i>
                </div>
                <span class="duration">51:51:58</span>
            </div>
            <div class="bvideo-info">
                <p class="title">黑马程序员Java企业级实战开发《学成在线》微服务项目，基于SpringCloud、SpringCloudAlibaba技术栈开发，项目搭建到选课支付学习全通关</p>
                <p class="card-status">
                    <span class="play-num">
                        <i class="fa fa-youtube-play"></i>
                        <span>26.1万</span></span>
                    <span>
                        <i class="fa fa-list-alt"></i>
                        <span>3714</span></span></p>
                <div class="partition">
                    <label class="card-label">视频</label>
                    <label class="up-label"></label>
                    <label class="up-name">黑马程序员</label>
                </div>
                <div class="actions hide"></div>
            </div>
        </div>
    </a>
</div>
<h1 id="写在最前"><a href="#写在最前" class="headerlink" title="写在最前"></a>写在最前</h1><ul>
<li>完整项目地址：<a target="_blank" rel="noopener" href="https://github.com/Cyborg2077/xuecheng-plus/tree/master">https://github.com/Cyborg2077/xuecheng-plus/tree/master</a></li>
</ul>
<h1 id="模块需求分析"><a href="#模块需求分析" class="headerlink" title="模块需求分析"></a>模块需求分析</h1><h2 id="什么是需求分析"><a href="#什么是需求分析" class="headerlink" title="什么是需求分析"></a>什么是需求分析</h2><ul>
<li>百度百科汇总对需求分析的定义如下</li>
</ul>
<blockquote>
<p>需求分析也称为软件需求分析、系统需求分析或需求分析工程等，是开发人员经过深入细致的调研和分析，准确理解用户和项目的功能、性能、可靠性等具体需求，将用户非形式的需求表叔转化为完整的需求定义，从而确定系统必须做什么的过程</p>
</blockquote>
<ul>
<li><p>简单理解就是要高清问题域，问题域就是用户的需求，软件要为用户解决什么问题，实现哪些业务功能，满足什么样的性能要求</p>
</li>
<li><p>那么如何做需求分析？</p>
<ol>
<li>首先确认用户需求<ul>
<li>用户需求即用户的原始需求。通过用户访谈、问卷调查、开会讨论、查阅资料等调研手段梳理用户的原始需求，产品人员根据用户需求绘制界面原型，再通过界面原型让用户确认需求是否符合预期</li>
</ul>
</li>
<li>确认关键问题<ul>
<li>用户的原始需求可能是含糊不清的，需求分析要从繁杂的问题中梳理出关键问题。比如：俭学机构的老师想要将课程发布到网上，这是原始需求，根据这个用户需求我们需要进行扩展分析，扩展出以下几个点：<ol>
<li>课程发布需要哪些信息？</li>
<li>如果用户发布了不良信息怎么办？</li>
<li>课程发布后用户怎么查看？</li>
</ol>
</li>
<li>课程发布需要课程名称、价格、介绍、图片（封面）、师资信息等。继续延伸分析：这么多课程信息进行归类，方便用户编辑，可以分为课程基本信息、课程营销信息、课程师资信息。</li>
<li>按照这样的思路对用户需求逐项分析，梳理出若干问题，再从中找到关键信息。比如：上边对课程信息分类后，哪些是关键信息，课程名称、课程图片、课程介绍扥基本信息为关键信息，所以发布课程的第一步要编写课程基本信息。</li>
<li>找到了关键问题，下一步就是进行数据建模，创建课程基本信息表，并设计其中的字段</li>
</ul>
</li>
<li>数据建模<ul>
<li>数据建模要根据分析的关键问题将其相关的信息全部建模。比如：根据发布课程的用户需求，可创建课程基本信息表、课程营销信息表、课程师资表、课程发布记录表、课程审核记录表等</li>
</ul>
</li>
<li>编写需求规格说明书<ul>
<li>针对每一个关键问题最终都需要编写需求规格说明书，包括：功能名称、功能描述、参与者、基本时间流程、可选事件流、数据描述、前置条件、后置条件等</li>
<li>比如添加课程的需求规格如下</li>
</ul>
</li>
</ol>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">项目</th>
<th style="text-align:center">添加课程</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">功能名称</td>
<td style="text-align:center">添加课程</td>
</tr>
<tr>
<td style="text-align:center">功能描述</td>
<td style="text-align:center">添加课程基本信息</td>
</tr>
<tr>
<td style="text-align:center">参与者</td>
<td style="text-align:center">教学机构管理员</td>
</tr>
<tr>
<td style="text-align:center">前置条件</td>
<td style="text-align:center">教学机构管理只允许向自己机构添加课程<br />拥有添加课程的权限</td>
</tr>
<tr>
<td style="text-align:center">基本事件流程</td>
<td style="text-align:center">1、登录教学机构平台<br />2、进入课程列表页面<br />3、点击添加课程按钮进入添加课程界面<br />4、填写课程基本信息<br />5、点击提交。</td>
</tr>
<tr>
<td style="text-align:center">可选事件流程</td>
<td style="text-align:center">成功：提示添加成功，跳转到课程营销信息添加界面<br />失败：提示具体的失败信息，用户根据失败信息进行修改。</td>
</tr>
<tr>
<td style="text-align:center">数据描述</td>
<td style="text-align:center">课程基本信息：课程id、课程名称、课程介绍、课程大分类、课程小分类、课程等级、课程图片、所属机构、课程创建时间、课程修改时间、课程状态</td>
</tr>
<tr>
<td style="text-align:center">后置条件</td>
<td style="text-align:center">向课程基本信息插入一条记录</td>
</tr>
<tr>
<td style="text-align:center">补充说明</td>
</tr>
</tbody>
</table>
</div>
<h2 id="模块介绍"><a href="#模块介绍" class="headerlink" title="模块介绍"></a>模块介绍</h2><ul>
<li>内容管理这个词存在于很多软件系统，什么是内容管理？</li>
<li>内容管理系统（content management system，CMS），是一种位于WEB前端（Web服务器）和后端办公系统或流程（内容创作、编辑）之间的软件系统。内容的创作人员，编辑人员、发布人员使用内容管理系统来提交、修改、审批、发布内容。这里的内容可能包括文件、表格、图片、数据库中的数据甚至视频等一切你想法不到网站的信息</li>
<li>本项目作为一个大型的在线教育平台，其内容管理模块主要对课程及相关内容进行管理，包括：课程的基本信息、课程图片、课程师资信息、课程的授课计划、课程视频、课程文档等内容的管理</li>
</ul>
<h2 id="业务流程"><a href="#业务流程" class="headerlink" title="业务流程"></a>业务流程</h2><ul>
<li>内容管理由教学机构人员和平台的运营人员共同完成。</li>
<li>教学机构人员的业务流程如下：<ol>
<li>登录教学机构</li>
<li>维护课程信息，添加一门课程需要编辑课程的基本信息、上床课程图片、课程营销信息、课程计划、上传课程视频、课程师资信息等内容</li>
<li>课程信息编辑完成，通过课程预览确认无误后提交课程审核。</li>
<li>待运营人员课程审核通过后方可进行课程发布</li>
</ol>
</li>
<li>运用人员的业务流程如下：<ol>
<li>查询待审核的课程信息</li>
<li>审核课程信息</li>
<li>提交审核结果</li>
</ol>
</li>
</ul>
<h2 id="界面原型"><a href="#界面原型" class="headerlink" title="界面原型"></a>界面原型</h2><ul>
<li>产品工程师根据用户需求制作产品界面原型，开发工程师除了根据用户需求进行需求分析以外，还会根据界面原型上的元素信息进行需求分析</li>
</ul>
<h2 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h2><ul>
<li>数据模型就是对应的数据库表</li>
</ul>
<h1 id="创建模块工程"><a href="#创建模块工程" class="headerlink" title="创建模块工程"></a>创建模块工程</h1><h2 id="模块工程结构"><a href="#模块工程结构" class="headerlink" title="模块工程结构"></a>模块工程结构</h2><ul>
<li>在之前我们已经创建好了项目父工程和基础工程<br><img src="https://s1.ax1x.com/2023/01/29/pSaRyvV.png" alt=""></li>
<li>那下面我们继续来创建内容管理模块的工程结构。本项目是一个前后端分离项目，前端与后端开发人员之间主要依据接口进行开发，前后端交互流程如下<ol>
<li>前端请求后端服务提供的接口</li>
<li>后端服务的Controller层接收前端的请求</li>
<li>Controller层调用Service层进行业务处理</li>
<li>Service层调用Dao持久层对数据持久化</li>
</ol>
</li>
<li><p>流程分为前端、接口层、业务层三部分，所以模块工程结构如下图所示</p>
<ul>
<li>xuecheng-plus-content-api：接口工程，为前端提供接口</li>
<li>xuecheng-plus-content-service：业务工程，为接口工程提供业务支撑</li>
<li>xuecheng-plus-content-model：数据模型工程，存储数据模型类、数据传输类型等<br><img src="https://s1.ax1x.com/2023/01/30/pSwBPhV.png" alt=""></li>
</ul>
</li>
<li><p>结合项目父工程、项目基础工程后，如下图</p>
<ul>
<li>xuecheng-plus-content：内容管理模块工程，负责聚合xuecheng-plus-content-api、xuecheng-plus-content-service、xuecheng-plus-content-model<br><img src="https://s1.ax1x.com/2023/01/30/pSwBuA1.png" alt=""></li>
</ul>
</li>
</ul>
<h2 id="创建模块工程-1"><a href="#创建模块工程-1" class="headerlink" title="创建模块工程"></a>创建模块工程</h2><ol>
<li>创建内容管理模块父工程xuecheng-plus-content，修改pom.xml，声明为聚合工程，且有三个子模块<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xuecheng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xuecheng-plus-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../xuecheng-plus-parent<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xuecheng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xuecheng-plus-content<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>xuecheng-plus-content<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>xuecheng-plus-content<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>xuecheng-plus-content-api<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>xuecheng-plus-content-model<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>xuecheng-plus-content-service<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>创建xuecheng-plus-content-api工程，设置父工程为<code>xuecheng-plus-content</code>，按照上图中的依赖关系修改pom文件<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xuecheng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xuecheng-plus-content<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xuecheng-plus-content-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>xuecheng-plus-content-api<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>xuecheng-plus-content-api<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xuecheng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xuecheng-plus-content-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xuecheng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xuecheng-plus-content-model<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>创建xuecheng-plus-content-model工程，设置父工程为<code>xuecheng-plus-content</code>，按照上图中的依赖关系修改pom文件<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xuecheng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xuecheng-plus-content<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xuecheng-plus-content-model<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>xuecheng-plus-content-model<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>xuecheng-plus-content-model<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xuecheng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xuecheng-plus-base<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>创建xuecheng-plus-content-service工程，设置父工程为<code>xuecheng-plus-content</code>，按照上图中的依赖关系修改pom文件<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xuecheng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xuecheng-plus-content<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xuecheng-plus-content-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>xuecheng-plus-content-service<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>xuecheng-plus-content-service<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xuecheng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xuecheng-plus-content-model<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>创建好的目录结构如下图所示<br><img src="https://s1.ax1x.com/2023/01/30/pSwrLp6.png" alt=""></li>
</ul>
<h1 id="课程查询"><a href="#课程查询" class="headerlink" title="课程查询"></a>课程查询</h1><h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2><h3 id="业务流程-1"><a href="#业务流程-1" class="headerlink" title="业务流程"></a>业务流程</h3><ol>
<li>教学机构恩怨点击课程管理，进入课程查询界面</li>
<li>在课程查询页面输入查询条件查询课程信息<ul>
<li>当不输入查询条件时，输出全部课程信息</li>
<li>输入查询条件，查询符合条件的课程信息</li>
<li>约束：教学机构只允许查询本教学机构的课程信息</li>
</ul>
</li>
</ol>
<h3 id="数据模型-1"><a href="#数据模型-1" class="headerlink" title="数据模型"></a>数据模型</h3><ul>
<li>课程查询功能涉及到的数据表有；课程基本信息表，教学计划表<br><img src="https://s1.ax1x.com/2023/01/30/pSw2tYj.png" alt="课程基本信息表"><br><img src="https://s1.ax1x.com/2023/01/30/pSw2zB8.png" alt="课程计划表"></li>
<li>下面从查询条件、查询列表两方面进行分析<ol>
<li>查询条件<ul>
<li>包括：课程名称、课程审核状态、课程发布状态</li>
<li>课程名称：可以模糊搜索</li>
<li>课程审核状态：未提交、已提交、审核通过、审核未通过</li>
<li>课程发布状态：未发布、已发布、已下线</li>
<li>因为是分页查询，所以查询条件中还要包括当前页码、每页显示记录数</li>
</ul>
</li>
<li>查询结果<ul>
<li>包括：课程id、课程名称、任务数、创建时间、审核状态、类型</li>
<li>从结果上看基本来源于课程基本信息表，任务书需要关联教学计划表查询</li>
<li>因为是分页查询，所以查询结果中还要包括总记录数、当前页码、每页显示记录数</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="生成PO"><a href="#生成PO" class="headerlink" title="生成PO"></a>生成PO</h3><ul>
<li>PO即持久对象（Persistent Object），它们是由一组属性和属性的get/set方法组成的。PO对应于数据库的表</li>
<li>在开发持久层代码需要根据数据表编写PO类，在实际开发中通常使用代码生成器工具来生成PO类代码（人人开源、MP代码生成器等）</li>
<li><p>这里是使用的MP的generator工程生成PO类，详细操作可以参考我这篇文章</p>
<div class="tag link"><a class="link-card" title="MyBatisPlus" href="https://cyborg2077.github.io/2022/09/20/MyBatisPlus/"><div class="left"><img src="https://pic.imgdb.cn/item/6335135c16f2c2beb100182d.jpg"/></div><div class="right"><p class="text">MyBatisPlus</p><p class="url">https://cyborg2077.github.io/2022/09/20/MyBatisPlus/</p></div></a></div>
</li>
<li><p>将生成好的PO类拷贝至xuecheng-plus-content-model工程的com.xuecheng.content.model.po包下，同时在model工程的pom.xml中添加MP的依赖，版本控制在父工程已经完成了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-annotation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus-boot-starter.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="接口定义"><a href="#接口定义" class="headerlink" title="接口定义"></a>接口定义</h2><h3 id="接口定义分析"><a href="#接口定义分析" class="headerlink" title="接口定义分析"></a>接口定义分析</h3><ul>
<li><p>定义一个接口需要包括以下几个方面</p>
<ol>
<li>协议<ul>
<li>通常使用HTTP协议，查询类的接口请求方式通常为GET或POST，查询条件较少的时候使用GET，较多的时候使用POST</li>
<li>本接口使用http post</li>
<li>同时也要确定content-type，参数以什么数据格式提交，结果以什么数据格式响应</li>
<li>一般情况下都以json格式响应</li>
</ul>
</li>
<li>分析请求参数<ul>
<li>根据前面对数据模型的分析，请求参数为：课程名称、课程审核状态、当前页码、每页显示的记录数</li>
<li>根据分析的请求参数定义模型类</li>
</ul>
</li>
<li>分析响应结果<ul>
<li>根据前面对数据模型的分析，响应结果为数据列表和一些分页信息（总记录数、当前页码、每页显示记录数）</li>
<li>数据列表中数据的属性包括：课程id、课程名称、任务数、创建时间、审核状态、类型<div class="note warning no-icon flat"><p>注意：查询结果中的审核状态为数据字典中的代码字段，前端会根据审核状态代码字段找到对应的名称显示（例如错误响应码404/401/502等）</p>
</div></li>
<li>根据分析的相应结果定义模型类</li>
</ul>
</li>
<li>分析完成，使用SpringBoot注解开发一个Http接口</li>
<li>使用接口文档工具查看接口的内容</li>
<li>接口中调用Service方法完成业务处理</li>
</ol>
</li>
<li><p>接口请求示例</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">POST /content/course/list?pageNo=<span class="number">2</span>&amp;pageSize=<span class="number">1</span></span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;auditStatus&quot;</span>: <span class="string">&quot;202002&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//成功响应结果</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;items&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">26</span>,</span><br><span class="line">      <span class="attr">&quot;companyId&quot;</span>: <span class="number">1232141425</span>,</span><br><span class="line">      <span class="attr">&quot;companyName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;spring cloud实战&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;users&quot;</span>: <span class="string">&quot;所有人&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;tags&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;mt&quot;</span>: <span class="string">&quot;1-3&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;mtName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;st&quot;</span>: <span class="string">&quot;1-3-2&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;stName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;grade&quot;</span>: <span class="string">&quot;200003&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;teachmode&quot;</span>: <span class="string">&quot;201001&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;本课程主要从四个章节进行讲解： 1.微服务架构入门 2.spring cloud 基础入门 3.实战Spring Boot 4.注册中心eureka。&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;pic&quot;</span>: <span class="string">&quot;https://cdn.educba.com/academy/wp-content/uploads/2018/08/Spring-BOOT-Interview-questions.jpg&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2019-09-04 09:56:19&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;changeDate&quot;</span>: <span class="string">&quot;2021-12-26 22:10:38&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;createPeople&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;changePeople&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;auditStatus&quot;</span>: <span class="string">&quot;202002&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;auditMind&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;auditNums&quot;</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;auditDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;auditPeople&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;status&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;coursePubId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;coursePubDate&quot;</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;counts&quot;</span>: <span class="number">23</span>,</span><br><span class="line">  <span class="attr">&quot;page&quot;</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">&quot;pageSize&quot;</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="课程查询接口定义"><a href="#课程查询接口定义" class="headerlink" title="课程查询接口定义"></a>课程查询接口定义</h3><ol>
<li><p>定义请求模型类</p>
<ul>
<li>对于查询条件较多的接口定义单独的模型类接收参数</li>
<li>由于分页查询这一类的接口在项目中很多地方都会用到，这里针对分页查询的参数（当前页码、每页显示的记录数）单独在xuecheng-plus-base基础工程中定义<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xuecheng.base.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageParams</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 默认起始页码</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> DEFAULT_PAGE_CURRENT = <span class="number">1L</span>;</span><br><span class="line">    <span class="comment">// 默认每页记录数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> DEFAULT_PAGE_SIZE = <span class="number">10L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当前页码</span></span><br><span class="line">    <span class="keyword">private</span> Long pageNo = DEFAULT_PAGE_CURRENT;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当前每页记录数</span></span><br><span class="line">    <span class="keyword">private</span> Long pageSize = DEFAULT_PAGE_SIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>除了分页查询参数，剩下的就是课程查询的特有参数，此时需要在内容管理的model工程中定义课程查询的参数模型类</li>
<li>定义DTO包，DTO即数据传输对象（Data Transfer Object），用于接口层和业务层之间传输数据<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xuecheng.content.model.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueryCourseParamDto</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 审核状态</span></span><br><span class="line">    <span class="keyword">private</span> String auditStatus;</span><br><span class="line">    <span class="comment">// 课程名称</span></span><br><span class="line">    <span class="keyword">private</span> String courseName;</span><br><span class="line">    <span class="comment">// 发布状态</span></span><br><span class="line">    <span class="keyword">private</span> String publishStatus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>多样化的模型类</p>
<ul>
<li>现在项目中有两种模型类：DTO数据传输对象、PO持久化对象。<ul>
<li>DTO用于接口层向业务层之间传输数据</li>
<li>PO用于业务层与持久层之间传输数据</li>
<li>有些公司还会设置VO对象，VO对象用在前端和接口层之间传输数据</li>
<li>当前端有多个平台且接口存在差异时，就需要设置VO对象用于前端和接口层传输数据。比如：课程列表查询接口，根据用户需求，用户在手机端也要查询课程信息，此时课程查询接口是否需要编写手机端和PC端两个接口呢？</li>
<li>如果用户要求通过手机和PC的查询条件或查询结果<code>不一样</code>，那此时就需要定义两个Controller课程查询接口，每个接口定义VO对象与前端传输数据<ul>
<li>手机查询：根据课程状态查询，查询结果只有课程名称和课程状态</li>
<li>PC查询：可以改根据课程名称、课程状态、课程审核状态等条件查询，查询结果也比手机查询的结果内容多</li>
</ul>
</li>
<li>此时，Service业务层尽量提供一个业务接口，即使两个前端接口需要的数据不一样，Service可以提供一个最群的查询结果，由Controller层进行数据整合。<br><img src="https://s1.ax1x.com/2023/01/30/pSw4JRH.png" alt=""></li>
</ul>
</li>
<li>如果前端接口没有多样性，且比较固定，此时可以取消VO，只用DTO即可</li>
</ul>
</li>
<li><p>定义响应模型类</p>
<ul>
<li>根据接口分析，下面定义响应结果模型类</li>
<li>针对分页查询结果经过分析，也存在固定的数据和格式，所以还是在base工程定义一个基础的结果模型类<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageResult</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 数据列表</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; items;</span><br><span class="line">    <span class="comment">// 总记录数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> counts;</span><br><span class="line">    <span class="comment">// 当前页码</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> page;</span><br><span class="line">    <span class="comment">// 每页记录数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> pageSize;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>定义接口</p>
<ul>
<li>根据分析，此接口提供http post协议，查询条件以json格式提交，响应结果为json格式</li>
<li>首先咋xuecheng-plus-content-api中添加依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xuecheng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xuecheng-plus-content-model<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xuecheng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xuecheng-plus-content-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--cloud的基础环境包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring Boot 的 Spring Web MVC 集成 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 排除 Spring Boot 依赖的日志包冲突 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring Boot 集成 log4j2 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Spring Boot 集成 swagger --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.spring4all<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>之后定义Controller方法<ul>
<li>说明：pageParams分页参数通过url的key/value传入，queryCourseParams通过json数据传入，所以queryCourseParams前面需要用@RequestBody注解将json转为QueryCourseParamDto对象。这里的两个@Api注解是swagger的，用于描述接口的<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(value = &quot;课程信息编辑接口&quot;, tags = &quot;课程信息编辑接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseBaseInfoController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/course/list&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;课程查询接口&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PageResult&lt;CourseBase&gt; <span class="title">list</span><span class="params">(PageParams pageParams, <span class="meta">@RequestBody</span> QueryCourseParamDto queryCourseParams)</span> </span>&#123;</span><br><span class="line">        CourseBase courseBase = <span class="keyword">new</span> CourseBase();</span><br><span class="line">        courseBase.setId(<span class="number">15L</span>);</span><br><span class="line">        courseBase.setDescription(<span class="string">&quot;测试课程&quot;</span>);</span><br><span class="line">        PageResult&lt;CourseBase&gt; result = <span class="keyword">new</span> PageResult&lt;&gt;();</span><br><span class="line">        result.setItems(Arrays.asList(courseBase));</span><br><span class="line">        result.setPage(<span class="number">1</span>);</span><br><span class="line">        result.setPageSize(<span class="number">10</span>);</span><br><span class="line">        result.setCounts(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>定义启动类，使用@EnableSwagger2Doc注解，启用Swagger<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>添加配置文件<div class="tabs" id="日志和最高优先级配置项"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#日志和最高优先级配置项-1">log4j2-dev.xml</button></li><li class="tab"><button type="button" data-href="#日志和最高优先级配置项-2">bootstrap.yml</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="日志和最高优先级配置项-1"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">monitorInterval</span>=<span class="string">&quot;180&quot;</span> <span class="attr">packages</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;logdir&quot;</span>&gt;</span>logs<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;PATTERN&quot;</span>&gt;</span>%date&#123;YYYY-MM-dd HH:mm:ss,SSS&#125; %level [%thread][%file:%line] - %msg%n%throwable<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">&quot;Console&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;$&#123;PATTERN&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;ErrorAppender&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;$&#123;logdir&#125;/error.log&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">filePattern</span>=<span class="string">&quot;$&#123;logdir&#125;/$$&#123;date:yyyy-MM-dd&#125;/error.%d&#123;yyyy-MM-dd-HH&#125;.log&quot;</span> <span class="attr">append</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;$&#123;PATTERN&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;ERROR&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;ACCEPT&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;DENY&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">&quot;1&quot;</span> <span class="attr">modulate</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;DebugAppender&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;$&#123;logdir&#125;/info.log&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">filePattern</span>=<span class="string">&quot;$&#123;logdir&#125;/$$&#123;date:yyyy-MM-dd&#125;/info.%d&#123;yyyy-MM-dd-HH&#125;.log&quot;</span> <span class="attr">append</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;$&#123;PATTERN&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;ACCEPT&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;DENY&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">&quot;1&quot;</span> <span class="attr">modulate</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--异步appender--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Async</span> <span class="attr">name</span>=<span class="string">&quot;AsyncAppender&quot;</span> <span class="attr">includeLocation</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;ErrorAppender&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;DebugAppender&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Async</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--过滤掉spring和mybatis的一些无用的debug信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.springframework&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;cn.itcast.wanxinp2p.consumer.mapper&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;springfox&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.apache.http&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.netflix.discovery&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;RocketmqCommon&quot;</span>  <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;RocketmqRemoting&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>  &gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;RocketmqClient&quot;</span> <span class="attr">level</span>=<span class="string">&quot;WARN&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.dromara.hmily&quot;</span> <span class="attr">level</span>=<span class="string">&quot;WARN&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.dromara.hmily.lottery&quot;</span> <span class="attr">level</span>=<span class="string">&quot;WARN&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.dromara.hmily.bonuspoint&quot;</span> <span class="attr">level</span>=<span class="string">&quot;WARN&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--OFF   0--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--FATAL   100--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ERROR   200--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--WARN   300--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--INFO   400--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--DEBUG   500--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--TRACE   600--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ALL   Integer.MAX_VALUE--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> <span class="attr">includeLocation</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;AsyncAppender&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;DebugAppender&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="日志和最高优先级配置项-2"><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/content</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">63040</span></span><br><span class="line"><span class="comment"># 微服务配置</span></span><br><span class="line"><span class="attr">spring:</span> </span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">content-api</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志文件配置路径</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">config:</span> <span class="string">classpath:log4j2-dev.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># swagger 文档配置</span></span><br><span class="line"><span class="attr">swagger:</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">&quot;学成在线内容管理系统&quot;</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">&quot;内容系统管理系统对课程相关信息进行业务管理数据&quot;</span></span><br><span class="line">  <span class="attr">base-package:</span> <span class="string">com.xuecheng.content</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></li>
<li>运行启动类，访问<a target="_blank" rel="noopener" href="http://localhost:63040/content/swagger-ui.html">http://localhost:63040/content/swagger-ui.html</a>, 查看接口信息<br><img src="https://s1.ax1x.com/2023/01/31/pSwXDRP.png" alt=""></li>
<li>使用PostMan测试我们的接口也能返回我们的测试数据<br><img src="https://s1.ax1x.com/2023/01/31/pSwzieU.png" alt=""></li>
</ul>
</li>
</ol>
<h3 id="Swagger介绍"><a href="#Swagger介绍" class="headerlink" title="Swagger介绍"></a>Swagger介绍</h3><ul>
<li>什么是Swagger？<ul>
<li>OpenAPI规范（OpenAPI Specification 简称OAS）是Linux基金会的一个项目，试图通过定义一种用来描述API格式或API定义的语言，来规范RESTful服务开发过程，并且已经发布并开源在GitHub上：<a target="_blank" rel="noopener" href="https://github.com/OAI/OpenAPI-Specification">https://github.com/OAI/OpenAPI-Specification</a></li>
<li>Swagger是全球最大的OpenAPI规范（OAS）API开发工具框架，Swagger是一个在线接口文档的生成工具，前后端开发人员依据接口文档进行开发，只要添加Swagger的依赖和配置信息即可使用它<div class="tabs" id="swagger的xml和yml"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#swagger的xml和yml-1">pom.xml</button></li><li class="tab"><button type="button" data-href="#swagger的xml和yml-2">bootstrap.yml</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="swagger的xml和yml-1"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Spring Boot 集成 swagger --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.spring4all<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="swagger的xml和yml-2"><ul>
<li>base-package为包扫描路径，扫描Controller类<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swagger:</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">&quot;学成在线内容管理系统&quot;</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">&quot;内容系统管理系统对课程相关信息进行业务管理数据&quot;</span></span><br><span class="line">  <span class="attr">base-package:</span> <span class="string">com.xuecheng.content</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>
</li>
</ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></li>
</ul>
</li>
<li>SpringBoot可以集成Swagger，Swagger根据Controller类中的注解生成接口文档，在模型类上也可以添加注解对模型类的属性进行说明，方便对接口文档的阅读，例如在我们之前编写的PageParams模型类上添加注解<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class PageParams &#123;</span><br><span class="line">    // 默认起始页码</span><br><span class="line">    public static final long DEFAULT_PAGE_CURRENT = 1L;</span><br><span class="line">    // 默认每页记录数</span><br><span class="line">    public static final long DEFAULT_PAGE_SIZE = 10L;</span><br><span class="line"></span><br><span class="line">    // 当前页码</span><br><span class="line"><span class="addition">+   @ApiModelProperty(&quot;当前页码&quot;)</span></span><br><span class="line">    private Long pageNo = DEFAULT_PAGE_CURRENT;</span><br><span class="line"></span><br><span class="line">    // 当前每页记录数</span><br><span class="line"><span class="addition">+   @ApiModelProperty(&quot;每页记录数&quot;)</span></span><br><span class="line">    private Long pageSize = DEFAULT_PAGE_SIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>重启服务，再次进入接口文档，可以看到添加的描述<br><img src="https://s1.ax1x.com/2023/01/31/pSwj8Fs.png" alt=""></li>
<li>Swagger常用的注解如下</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">@Api</th>
<th style="text-align:center">修饰整个类，描述Controller的作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">@ApiOperation</td>
<td style="text-align:center">描述一个类的一个方法，或者说一个接口</td>
</tr>
<tr>
<td style="text-align:center">@ApiParam</td>
<td style="text-align:center">单个参数描述</td>
</tr>
<tr>
<td style="text-align:center">@ApiModel</td>
<td style="text-align:center">用对象来接收参数</td>
</tr>
<tr>
<td style="text-align:center">@ApiModelProperty</td>
<td style="text-align:center">用对象接收参数时，描述对象的一个字段</td>
</tr>
<tr>
<td style="text-align:center">@ApiResponse</td>
<td style="text-align:center">HTTP响应其中1个描述</td>
</tr>
<tr>
<td style="text-align:center">@ApiResponses</td>
<td style="text-align:center">HTTP响应整体描述</td>
</tr>
<tr>
<td style="text-align:center">@ApiIgnore</td>
<td style="text-align:center">使用该注解忽略这个API</td>
</tr>
<tr>
<td style="text-align:center">@ApiError</td>
<td style="text-align:center">发生错误返回的信息</td>
</tr>
<tr>
<td style="text-align:center">@ApiImplicitParam</td>
<td style="text-align:center">一个请求参数</td>
</tr>
<tr>
<td style="text-align:center">@ApiImplicitParams</td>
<td style="text-align:center">多个请求参数</td>
</tr>
</tbody>
</table>
</div>
<h2 id="接口开发"><a href="#接口开发" class="headerlink" title="接口开发"></a>接口开发</h2><h3 id="DAO开发"><a href="#DAO开发" class="headerlink" title="DAO开发"></a>DAO开发</h3><ul>
<li>业务层为接口层提供业务处理支撑，本项目业务层包括了持久层代码，一些大型公司的团队职责划分更细，会将持久层和业务层分为两个工程，不过这需要增加成本</li>
<li>DAO即数据访问对象，通过DAO去访问数据库对数据进行持久化，本项目持久层使用MyBatisPlus进行开发</li>
<li>持久层的基础代码我们使用MP提供的代码生成器生成，将生成的Mapper和对应的xml拷贝纸service工程的com.xuecheng.content.mapper包下</li>
<li>同时在service的pom.xml中添加MP和日志的一些依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xuecheng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xuecheng-plus-content-model<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- MySQL 驱动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- mybatis plus的依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring Boot 集成 Junit --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 排除 Spring Boot 依赖的日志包冲突 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Spring Boot 集成 log4j2 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>在com.xuecheng.content.config包下创建MP配置类，配置分页拦截器<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * MybatisPlus配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.xuecheng.content.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义分页拦截器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title">mybatisPlusInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MybatisPlusInterceptor interceptor = <span class="keyword">new</span> MybatisPlusInterceptor();</span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> PaginationInnerInterceptor(DbType.MYSQL));</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>然后在yml中配置数据库连接信息和日志信息等<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">content-service</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/xc_content?serverTimezone=UTC&amp;userUnicode=true&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">config:</span> <span class="string">classpath:log4j2-dev.xml</span></span><br></pre></td></tr></table></figure></li>
<li>最后编写测试方法并进行测试，控制台可以输出查到的数据（前提保证你的id真的对应有数据）<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = XuechengPlusContentServiceApplication.class)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XuechengPlusContentServiceApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CourseBaseMapper courseBaseMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        CourseBase courseBase = courseBaseMapper.selectById(<span class="number">22</span>);</span><br><span class="line">        log.info(<span class="string">&quot;查询到数据：&#123;&#125;&quot;</span>, courseBase);</span><br><span class="line">        Assertions.assertNotNull(courseBase);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Service开发"><a href="#Service开发" class="headerlink" title="Service开发"></a>Service开发</h3><ol>
<li><p>数据字典表   </p>
<ul>
<li>课程基本信息查询的主要数据来源是课程基本信息表，这里有一点需要注意：课程的审核状态、发布状态</li>
<li>审核状态在查询条件和查询结果中都存在，包括：未审核、审核通过、审核未通过这三种</li>
<li>那么我们思考一个问题：直接在数据库表中的字段填充<code>审核未通过</code>这几个大字，合适吗？<ul>
<li>如果将<code>审核未通过</code>这五个字记录在课程基本信息表中，查询出来的状态就是<code>审核未通过</code>这几个字，那么如果有一天客户想把<code>审核未通过</code>改为<code>未通过</code>，怎么办？</li>
<li>词汇我们可以批量处理数据库中的数据，写一个update语句，将所有的<code>审核未通过</code>更新为<code>未通过</code>。看起来解决了问题，但是万一后期客户抽风又想改呢？真实情况就是这样，但是这一类数据也有共同点：它有一些分类项，且这些分类项比较固定，大致的意思都是一样的，只是表述方式不一样。</li>
</ul>
</li>
<li>那么针对这一类数据，为了提高系统的可扩展性，专门定义数据字典去维护，例如  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;<span class="attr">&quot;code&quot;</span>:<span class="string">&quot;202001&quot;</span>,<span class="attr">&quot;desc&quot;</span>:<span class="string">&quot;审核未通过&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">&quot;code&quot;</span>:<span class="string">&quot;202002&quot;</span>,<span class="attr">&quot;desc&quot;</span>:<span class="string">&quot;未审核&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">&quot;code&quot;</span>:<span class="string">&quot;202003&quot;</span>,<span class="attr">&quot;desc&quot;</span>:<span class="string">&quot;审核通过&quot;</span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li>
<li>那么我们创建系统管理数据库xc_system，在其中创建管理系统服务的数据表，导入黑马提供的SQL脚本就好了。这样查询出的数据在前端展示时，就根据代码取出它对应的内容显示给用户。如果客户需要修改<code>审核未通过</code>的显示内容，直接在数据字典中修改就好了，无需修改课程基本信息表<br><img src="https://s1.ax1x.com/2023/01/31/pS0ktLn.png" alt=""></li>
</ul>
</li>
<li><p>Service开发</p>
<ul>
<li>首先创建Service接口<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CourseBaseInfoService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 课程查询接口</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pageParams 分页参数</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> queryCourseParams 查询条件</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">PageResult&lt;CourseBase&gt; <span class="title">queryCourseBaseList</span><span class="params">(PageParams pageParams, QueryCourseParamDto queryCourseParams)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>然后创建实现类<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseBaseInfoServiceImpl</span> <span class="keyword">implements</span> <span class="title">CourseBaseInfoService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    CourseBaseMapper courseBaseMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PageResult&lt;CourseBase&gt; <span class="title">queryCourseBaseList</span><span class="params">(PageParams pageParams, QueryCourseParamDto queryCourseParams)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 构建条件查询器</span></span><br><span class="line">        LambdaQueryWrapper&lt;CourseBase&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">        <span class="comment">// 构建查询条件：按照课程名称模糊查询</span></span><br><span class="line">        queryWrapper.like(StringUtils.isNotEmpty(queryCourseParams.getCourseName()), CourseBase::getCompanyName, queryCourseParams.getCourseName());</span><br><span class="line">        <span class="comment">// 构建查询条件，按照课程审核状态查询</span></span><br><span class="line">        queryWrapper.eq(StringUtils.isNotEmpty(queryCourseParams.getAuditStatus()), CourseBase::getAuditStatus, queryCourseParams.getAuditStatus());</span><br><span class="line">        <span class="comment">// 构建查询条件，按照课程发布状态查询</span></span><br><span class="line">        queryWrapper.eq(StringUtils.isNotEmpty(queryCourseParams.getPublishStatus()), CourseBase::getStatus, queryCourseParams.getPublishStatus());</span><br><span class="line">        <span class="comment">// 分页对象</span></span><br><span class="line">        Page&lt;CourseBase&gt; page = <span class="keyword">new</span> Page&lt;&gt;(pageParams.getPageNo(), pageParams.getPageSize());</span><br><span class="line">        <span class="comment">// 查询数据内容获得结果</span></span><br><span class="line">        Page&lt;CourseBase&gt; pageInfo = courseBaseMapper.selectPage(page, queryWrapper);</span><br><span class="line">        <span class="comment">// 获取数据列表</span></span><br><span class="line">        List&lt;CourseBase&gt; items = pageInfo.getRecords();</span><br><span class="line">        <span class="comment">// 获取数据总条数</span></span><br><span class="line">        <span class="keyword">long</span> counts = pageInfo.getTotal();</span><br><span class="line">        <span class="comment">// 构建结果集</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PageResult&lt;&gt;(items, counts, pageParams.getPageNo(), pageParams.getPageSize());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>使用单元测试类进行测试,<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">CourseBaseInfoService courseBaseInfoService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">contextQueryCourseTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    PageResult&lt;CourseBase&gt; result = courseBaseInfoService.queryCourseBaseList(<span class="keyword">new</span> PageParams(<span class="number">1L</span>, <span class="number">10L</span>), <span class="keyword">new</span> QueryCourseParamDto());</span><br><span class="line">    log.info(<span class="string">&quot;查询到数据：&#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h3 id="接口代码完善"><a href="#接口代码完善" class="headerlink" title="接口代码完善"></a>接口代码完善</h3><ul>
<li>控制层、业务层、持久层三层通常可以面向接口并行开发，比如：业务层开发的同时可以先只编写一个Service接口，接口层的同时即可以面向Service接口去开发，待接口层和业务层完成后进行联调。</li>
<li>下面是课程查询接口的实现<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">CourseBaseInfoService courseBaseInfoService;</span><br><span class="line"><span class="meta">@ApiOperation(&quot;课程查询接口&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/course/list&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageResult&lt;CourseBase&gt; <span class="title">list</span><span class="params">(PageParams pageParams, <span class="meta">@RequestBody</span> QueryCourseParamDto queryCourseParams)</span> </span>&#123;</span><br><span class="line">    PageResult&lt;CourseBase&gt; result = courseBaseInfoService.queryCourseBaseList(pageParams, queryCourseParams);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>我们可以在Swagger中进行测试，也可以在PostMan中进行测试<ul>
<li>这里演示一下在Swagger中测试，输入参数，这里查询条件均设为空，当前页码1，页大小2<br><img src="https://s1.ax1x.com/2023/01/31/pS0nZfx.png" alt=""></li>
<li>测试成功，查询到了数据<br><img src="https://s1.ax1x.com/2023/01/31/pS0n17d.png" alt=""></li>
</ul>
</li>
</ul>
<h2 id="接口测试"><a href="#接口测试" class="headerlink" title="接口测试"></a>接口测试</h2><h3 id="HttpClient测试"><a href="#HttpClient测试" class="headerlink" title="HttpClient测试"></a>HttpClient测试</h3><ul>
<li>Swagger是一个在线接口文档，虽然使用它也能测试，但是需要浏览器进入Swagger，最关键的是它不能保存测试数据。</li>
<li>PostMan对内存的消耗也比较大，而且需要下载客户端。</li>
<li>在IDEA中有一个非常方便的http接口测试工具HTTP Client，下面介绍它的使用方法，后面我们使用它来进行接口测试<div class="note warning no-icon flat"><p>先检查一下自己的IDEA是否已经安装了HTTP Client插件</p>
</div></li>
<li>进入Controller类，找到HTTP接口对应的方法<br><img src="https://s1.ax1x.com/2023/01/31/pS0uta9.png" alt=""></li>
<li>点击<code>在HTTP客户端中生成请求</code>，即可生成一个测试用例，IDEA会为我们生成一个.http结尾的文件，我们可以添加请求参数进行测试<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">### 课程查询列表</span><br><span class="line">POST http:<span class="comment">//localhost:63040/content/course/list?pageNo=1&amp;pageSize=10</span></span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;auditStatus&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publishStatus&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>同样通过测试，可以查询到数据<br><img src="https://s1.ax1x.com/2023/01/31/pS0Mk7Q.png" alt=""></li>
<li>.http文件即测试用例文档，它可以随着项目工程一起保存（也可以提交git），这样测试数据就可以保存下来，方便进行测试</li>
<li>为了方便保存.http文件，我们单独在项目工程的根目录下创建一个目录单独来存放他们</li>
<li>同时为了将来方便和网关集成测试，这里把测试主机地址在配置文件http-client.env.json中配置<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;dev&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;host&quot;</span>: <span class="string">&quot;localhost:63010&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;content_host&quot;</span>: <span class="string">&quot;localhost:63040&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;system_host&quot;</span>: <span class="string">&quot;localhost:63110&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;media_host&quot;</span>: <span class="string">&quot;localhost:63050&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cache_host&quot;</span>: <span class="string">&quot;localhost:63035&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>那么现在就可以用<code>&#123;&#123;content_host&#125;&#125;</code>替换掉原来的<a target="_blank" rel="noopener" href="http://localhost:63040">http://localhost:63040</a> 了，同时环境改为dev<br><img src="https://s1.ax1x.com/2023/01/31/pS0MjDU.png" alt=""></li>
</ul>
<h3 id="导入系统管理服务"><a href="#导入系统管理服务" class="headerlink" title="导入系统管理服务"></a>导入系统管理服务</h3><ul>
<li>要进行前后端联调首先启动前端工程，浏览器访问<a target="_blank" rel="noopener" href="http://localhost:8601/">http://localhost:8601/</a> ，此时会报错，因为还有一个接口我们还没有完成：<a target="_blank" rel="noopener" href="http://localhost:63110/system/dictionary/all">http://localhost:63110/system/dictionary/all</a></li>
<li>该接口指向的是系统管理服务，次链接是前端请求后端获取数据字典数据的接口地址</li>
<li>拷贝黑马提供的xuecheng-plus-system工程到项目根目录即可，然后修改数据库连接配置，该工程仅包含数据字典对应的PO类，Mapper映射和一些配置类，然后提供了两个简单的接口，查询全部数据文档。</li>
<li>启动系统管理服务，浏览器访问<a target="_blank" rel="noopener" href="http://localhost:63110/system/dictionary/all">http://localhost:63110/system/dictionary/all</a> ，如果可以正常读取数据字典的信息，则说明导入成功</li>
</ul>
<h3 id="解决跨域问题"><a href="#解决跨域问题" class="headerlink" title="解决跨域问题"></a>解决跨域问题</h3><ul>
<li>启动前端工程，工程首页不能正常显示，查看浏览器报错如下<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access to XMLHttpRequest at &#x27;http://harib-eir.info/xuecheng-plus.com?adTagId=dbb6a410-0bec-11ec-8010-0a70670a1f67&amp;fallbackUrl=ww87.xuecheng-plus.com&#x27; (redirected from &#x27;http://localhost:8601/api/content/course/list?pageNo=1&amp;pageSize=10&#x27;) from origin &#x27;http://localhost:8601&#x27; has been blocked by CORS policy: Response to preflight request doesn&#x27;t pass access control check: No &#x27;Access-Control-Allow-Origin&#x27; header is present on the requested resource.</span><br></pre></td></tr></table></figure></li>
<li><p>提示：从<a href="http://localhost:8601访问http://localhost:63110/system/dictionary/all被CORS">http://localhost:8601访问http://localhost:63110/system/dictionary/all被CORS</a> policy阻止，因为没有Access-Control-Allow-Origin 头信息。CORS全称是 cross origin resource share 表示跨域资源共享。</p>
</li>
<li><p>比如：</p>
<ul>
<li>从<a target="_blank" rel="noopener" href="http://localhost:8601">http://localhost:8601</a>  到   <a target="_blank" rel="noopener" href="http://localhost:8602">http://localhost:8602</a>  由于端口不同，是跨域。</li>
<li>从<a target="_blank" rel="noopener" href="http://192.168.101.10:8601">http://192.168.101.10:8601</a>  到   <a target="_blank" rel="noopener" href="http://192.168.101.11:8601">http://192.168.101.11:8601</a>  由于主机不同，是跨域。</li>
<li>从<a target="_blank" rel="noopener" href="http://192.168.101.10:8601">http://192.168.101.10:8601</a>  到   <a target="_blank" rel="noopener" href="https://192.168.101.11:8601">https://192.168.101.11:8601</a>  由于协议不同，是跨域。</li>
</ul>
</li>
</ul>
<div class="note warning no-icon flat"><p>注意：服务器之间不存在跨域请求。</p>
</div>
<ul>
<li>浏览器判断是跨域请求会在请求头上添加origin，表示这个请求来源哪里，例如<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.1</span><br><span class="line">Origin: http://localhost:8601</span><br></pre></td></tr></table></figure></li>
<li>服务器接收到请求判断这个Origin是否跨域，如果允许则在响应头中说明允许该来源的跨域请求，如下<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin：http://localhost:8601</span><br></pre></td></tr></table></figure></li>
<li>如果允许域名来源的跨域请求，则响应如下<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin：*</span><br></pre></td></tr></table></figure></li>
<li><p>解决跨域的方法</p>
<ol>
<li>JSONP<ul>
<li>通过script标签的src属性进行跨域请求，如果服务端要响应内容，则先读取请求参数callback值，callback是一个回调函数的名称，服务端读取callback的值后将响应内容通过调用callback函数的方式告诉请求方<br><img src="https://s1.ax1x.com/2023/01/31/pS0BLFI.png" alt=""></li>
</ul>
</li>
<li>添加响应头<ul>
<li>服务端在响应头添加<code>Access-Control-Allow-Origin: *</code></li>
</ul>
</li>
<li>通过nginx代理跨域<ul>
<li>由于服务端之间没有跨域，浏览器通过nginx去访问跨域地址</li>
<li>浏览器先访问<a target="_blank" rel="noopener" href="http://192.168.101.10:8601">http://192.168.101.10:8601</a> nginx提供的地址，进入页面</li>
<li>此页面要跨域访问<a target="_blank" rel="noopener" href="http://192.168.101.11:8601">http://192.168.101.11:8601</a> ，不能直接跨域访问<a target="_blank" rel="noopener" href="http://www.baidu.com:8601">http://www.baidu.com:8601</a>  ，而是访问nginx的一个同源地址，比如：<a target="_blank" rel="noopener" href="http://192.168.101.11:8601/api">http://192.168.101.11:8601/api</a> ，通过<a target="_blank" rel="noopener" href="http://192.168.101.11:8601/api">http://192.168.101.11:8601/api</a> 的代理去访问<a href="http://www.baidu.com:8601。">http://www.baidu.com:8601。</a></li>
<li>这样就实现了跨域访问。</li>
<li>浏览器到<a target="_blank" rel="noopener" href="http://192.168.101.11:8601/api">http://192.168.101.11:8601/api</a> 没有跨域</li>
<li>nginx到<a target="_blank" rel="noopener" href="http://www.baidu.com:8601">http://www.baidu.com:8601</a> 通过服务端通信，没有跨域。<br><img src="https://s1.ax1x.com/2023/01/31/pS0BbTA.png" alt=""></li>
</ul>
</li>
</ol>
</li>
<li><p>这里采用添加请求头的方式解决跨域问题。在xuecheng-plus-system-api模块下新建配置类GlobalCorsConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalCorsConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CorsFilter <span class="title">getCorsFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        CorsConfiguration configuration = <span class="keyword">new</span> CorsConfiguration();</span><br><span class="line">        <span class="comment">//添加哪些http方法可以跨域，比如：GET,Post，（多个方法中间以逗号分隔），*号表示所有</span></span><br><span class="line">        configuration.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//添加允许哪个请求进行跨域，*表示所有,可以具体指定http://localhost:8601 表示只允许http://localhost:8601/跨域</span></span><br><span class="line">        configuration.addAllowedOrigin(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//所有头信息全部放行</span></span><br><span class="line">        configuration.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//允许跨域发送cookie</span></span><br><span class="line">        configuration.setAllowCredentials(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        UrlBasedCorsConfigurationSource urlBasedCorsConfigurationSource = <span class="keyword">new</span> UrlBasedCorsConfigurationSource();</span><br><span class="line">        urlBasedCorsConfigurationSource.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>, configuration);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CorsFilter(urlBasedCorsConfigurationSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>此配置类实现了跨域过滤器，在响应头添加<code>Access-Control-Allow-Origin</code></li>
<li>重启系统管理服务，前端工程可以正常进入<a target="_blank" rel="noopener" href="http://localhost:8601">http://localhost:8601</a> ，查看NetWork选项卡，跨域问题成功解决<br><img src="https://s1.ax1x.com/2023/01/31/pS0r226.png" alt=""></li>
</ul>
<h3 id="前后端联调"><a href="#前后端联调" class="headerlink" title="前后端联调"></a>前后端联调</h3><ul>
<li>前端启动完毕，在启动内容管理服务端。</li>
<li>前端默认连接的是项目的网关地址，由于现在网关工程还没有创建，这里需要更改前端工程的参数配置文件，修改网关地址为内容管理服务的地址</li>
<li>编辑.env文件<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前台管理页面-端口</span></span><br><span class="line"><span class="attr">VUE_APP_CLIENT_MANAGE_PORT</span>=<span class="string">8601</span></span><br><span class="line"><span class="comment"># 首页、列表、学习</span></span><br><span class="line"><span class="attr">VUE_APP_CLIENT_PORTAL_URL</span>=<span class="string">http://www.xuecheng-plus.com</span></span><br><span class="line"><span class="comment"># 后台服务网关</span></span><br><span class="line"><span class="comment">#VUE_APP_SERVER_API_URL=http://www.xuecheng-plus.com/api</span></span><br><span class="line"><span class="comment">#VUE_APP_SERVER_API_URL=http://localhost:63010</span></span><br><span class="line"><span class="comment">#VUE_APP_SERVER_API_URL=http://172.16.63.20:63010</span></span><br><span class="line"><span class="attr">VUE_APP_SERVER_API_URL</span>=<span class="string">http://localhost:63040</span></span><br><span class="line"><span class="comment"># 权限认证</span></span><br><span class="line"><span class="comment">#VUE_APP_SERVER_AUTHORIZATION=ewogICAgImF1ZCI6IFsKICAgICAgICAieHVlY2hlbmctcmVzb3VyY2UiCiAgICBdLAogICAgInBheWxvYWQiOiB7CiAgICAgICAgIjExNzcxNDQyMDk0NjMxMjgxMjUiOiB7CiAgICAgICAgICAgICJyZXNvdXJjZXMiOiBbCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJ1c2VyX2F1dGhvcml0aWVzIjogewogICAgICAgICAgICAgICAgInJfMDAxIjogWwogICAgICAgICAgICAgICAgICAgICJ4Y19jb21wYW55X21vZGlmeSIsCgkJCQkJInhjX2NvbXBhbnlfdmlldyIsCgkJCQkJInhjX2NvdXJzZV9iYXNlX2RlbCIsCgkJCQkJInhjX2NvdXJzZV9iYXNlX2VkaXQiLAoJCQkJCSJ4Y19jb3Vyc2VfYmFzZV9saXN0IiwKCQkJCQkieGNfY291cnNlX2Jhc2Vfc2F2ZSIsCgkJCQkJInhjX2NvdXJzZV9iYXNlX3ZpZXciLAoJCQkJCSJ4Y19jb3Vyc2VfcHVibGlzaCIsCgkJCQkJInhjX21hcmtldF9zYXZlX21vZGlmeSIsCgkJCQkJInhjX21hcmtldF92aWV3IiwKCQkJCQkieGNfbWVkaWFfZGVsIiwKCQkJCQkieGNfbWVkaWFfbGlzdCIsCgkJCQkJInhjX21lZGlhX3ByZXZpZXciLAoJCQkJCSJ4Y19tZWRpYV9zYXZlIiwKCQkJCQkieGNfdGVhY2hlcl9saXN0IiwKCQkJCQkieGNfdGVhY2hlcl9tb2RpZnkiLAoJCQkJCSJ4Y190ZWFjaGVyX3NhdmUiLAoJCQkJCSJ4Y193b3JrcmVjb3JkX2NvcnJlY3Rpb24iLAoJCQkJCSJ4Y193b3JrcmVjb3JkX2xpc3QiLAoJCQkJCSJ4Y190ZWFjaHBsYW53b3JrX2RlbCIsCgkJCQkJInhjX3RlYWNocGxhbndvcmtfbGlzdCIsCgkJCQkJInhjX3RlYWNocGxhbndvcmtfc2F2ZV9tb2RpZnkiLAoJCQkJCSJ4Y190ZWFjaHBsYW5fZGVsIiwKCQkJCQkieGNfdGVhY2hwbGFuX3NhdmVfbW9kaWZ5IiwKCQkJCQkieGNfdGVhY2hwbGFuX3ZpZXciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgInJfMDAyIjogWwogICAgICAgICAgICAgICAgICAgICJ4Y19jb3Vyc2VfYWRtaW5fbGlzdCIsCgkJCQkJInhjX2NvdXJzZV9iYXNlX2NvbW1pdCIsCgkJCQkJInhjX3N5c3RlbV9jYXRlZ29yeSIsCgkJCQkJInhjX21fbWVkaWFfbGlzdCIsCgkJCQkJInhjX21lZGlhX2F1ZGl0IgogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgICJ1c2VyX25hbWUiOiAieGMtdXNlci1maXJzdCIsCiAgICAic2NvcGUiOiBbCiAgICAgICAgInJlYWQiCiAgICBdLAogICAgIm1vYmlsZSI6ICIxNTAxMjM0NTY3OCIsCiAgICAiZXhwIjogMTYwNjUyNTEyMiwKICAgICJjbGllbnRfYXV0aG9yaXRpZXMiOiBbCiAgICAgICAgIlJPTEVfVVNFUiIKICAgIF0sCiAgICAianRpIjogIjFlYjdlOTg3LWQ3YzItNDBmNS1iMGQ2LWNkNjEzOWNiMThlMCIsCiAgICAiY2xpZW50X2lkIjogInhjLWNvbS1wbGF0Zm9ybSIsCiAgICAiY29tcGFueUlkIjogMTIzMjE0MTQyNQp9</span></span><br><span class="line"><span class="attr">VUE_APP_SERVER_AUTHORIZATION</span>=<span class="string"></span></span><br><span class="line"><span class="comment">#ewogICAgImF1ZCI6IFsKICAgICAgICAieHVlY2hlbmctcmVzb3VyY2UiCiAgICBdLAogICAgInBheWxvYWQiOiB7CiAgICAgICAgIjExNzcxNDQyMDk0NjMxMjgxMjUiOiB7CiAgICAgICAgICAgICJyZXNvdXJjZXMiOiBbCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJ1c2VyX2F1dGhvcml0aWVzIjogewogICAgICAgICAgICAgICAgInJfMDAxIjogWwogICAgICAgICAgICAgICAgICAgICJ4Y19jb21wYW55X21vZGlmeSIsCgkJCQkJInhjX2NvbXBhbnlfdmlldyIsCgkJCQkJInhjX2NvdXJzZV9iYXNlX2RlbCIsCgkJCQkJInhjX2NvdXJzZV9iYXNlX2VkaXQiLAoJCQkJCSJ4Y19jb3Vyc2VfYmFzZV9saXN0IiwKCQkJCQkieGNfY291cnNlX2Jhc2Vfc2F2ZSIsCgkJCQkJInhjX2NvdXJzZV9iYXNlX3ZpZXciLAoJCQkJCSJ4Y19jb3Vyc2VfcHVibGlzaCIsCgkJCQkJInhjX21hcmtldF9zYXZlX21vZGlmeSIsCgkJCQkJInhjX21hcmtldF92aWV3IiwKCQkJCQkieGNfbWVkaWFfZGVsIiwKCQkJCQkieGNfbWVkaWFfbGlzdCIsCgkJCQkJInhjX21lZGlhX3ByZXZpZXciLAoJCQkJCSJ4Y19tZWRpYV9zYXZlIiwKCQkJCQkieGNfdGVhY2hlcl9saXN0IiwKCQkJCQkieGNfdGVhY2hlcl9tb2RpZnkiLAoJCQkJCSJ4Y190ZWFjaGVyX3NhdmUiLAoJCQkJCSJ4Y193b3JrcmVjb3JkX2NvcnJlY3Rpb24iLAoJCQkJCSJ4Y193b3JrcmVjb3JkX2xpc3QiLAoJCQkJCSJ4Y190ZWFjaHBsYW53b3JrX2RlbCIsCgkJCQkJInhjX3RlYWNocGxhbndvcmtfbGlzdCIsCgkJCQkJInhjX3RlYWNocGxhbndvcmtfc2F2ZV9tb2RpZnkiLAoJCQkJCSJ4Y190ZWFjaHBsYW5fZGVsIiwKCQkJCQkieGNfdGVhY2hwbGFuX3NhdmVfbW9kaWZ5IiwKCQkJCQkieGNfdGVhY2hwbGFuX3ZpZXciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgInJfMDAyIjogWwogICAgICAgICAgICAgICAgICAgICJ4Y19jb3Vyc2VfYWRtaW5fbGlzdCIsCgkJCQkJInhjX2NvdXJzZV9iYXNlX2NvbW1pdCIsCgkJCQkJInhjX3N5c3RlbV9jYXRlZ29yeSIsCgkJCQkJInhjX21fbWVkaWFfbGlzdCIsCgkJCQkJInhjX21lZGlhX2F1ZGl0IgogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgICJ1c2VyX25hbWUiOiAieGMtdXNlci1maXJzdCIsCiAgICAic2NvcGUiOiBbCiAgICAgICAgInJlYWQiCiAgICBdLAogICAgIm1vYmlsZSI6ICIxNTAxMjM0NTY3OCIsCiAgICAiZXhwIjogMTYwNjUyNTEyMiwKICAgICJjbGllbnRfYXV0aG9yaXRpZXMiOiBbCiAgICAgICAgIlJPTEVfVVNFUiIKICAgIF0sCiAgICAianRpIjogIjFlYjdlOTg3LWQ3YzItNDBmNS1iMGQ2LWNkNjEzOWNiMThlMCIsCiAgICAiY2xpZW50X2lkIjogInhjLWNvbS1wbGF0Zm9ybSIsCiAgICAiY29tcGFueUlkIjogMTIzMjE0MTQyNQp9</span></span><br><span class="line"><span class="comment"># Cookie域</span></span><br><span class="line"><span class="attr">VUE_APP_SERVER_DOMAIN</span>=<span class="string">xuecheng-plus.com</span></span><br><span class="line"><span class="comment"># 七牛云静态页</span></span><br><span class="line"><span class="attr">VUE_APP_SERVER_QINIU_URL</span>=<span class="string">http://localhost11</span></span><br><span class="line"><span class="comment"># 图片服务器地址</span></span><br><span class="line"><span class="attr">VUE_APP_SERVER_PICSERVER_URL</span>=<span class="string">http://192.168.101.65:9000</span></span><br></pre></td></tr></table></figure></li>
<li>启动前端工程，进入课程管理，可以看到界面显示的课程信息，那么到此就基本完成了前后端联调<br><img src="https://s1.ax1x.com/2023/01/31/pS0y1ts.png" alt=""></li>
</ul>
<h1 id="课程分类查询"><a href="#课程分类查询" class="headerlink" title="课程分类查询"></a>课程分类查询</h1><h2 id="需求分析-1"><a href="#需求分析-1" class="headerlink" title="需求分析"></a>需求分析</h2><ul>
<li>下面我们进行添加课程的接口开发，在新增课程界面，有三处信息需要选择，课程分类、课程等级、课程类型<br><img src="https://s1.ax1x.com/2023/02/01/pSDujQP.png" alt=""></li>
<li>其中，课程等级和课程类型都来源于数字字典表，此部分的信息前端已从系统管理服务中读取。但是课程类型的数据是通过另外一个接口来读取的，现在还没有编写<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">请求网址: http://localhost:8601/api/content/course-category/tree-nodes</span><br><span class="line">请求方法: GET</span><br><span class="line">状态代码: 404 Not Found</span><br><span class="line">远程地址: 127.0.0.1:8601</span><br></pre></td></tr></table></figure></li>
<li>课程分类信息没有在数据字典表中存储，而是有单独一张课程分类表，下面我们来看看课程分类表的结构<br><img src="https://s1.ax1x.com/2023/02/01/pSDKkzq.png" alt=""></li>
<li>这张表是一个树形结构，通过父节点id将各元素组成一个树，下面是一部分数据<br><img src="https://s1.ax1x.com/2023/02/01/pSDKnwF.png" alt=""></li>
<li>那么现在的需求就是：在内容管理服务中编写一个接口，读取课程分类表的数据，组成一个树形结构返回给前端</li>
</ul>
<h2 id="接口定义-1"><a href="#接口定义-1" class="headerlink" title="接口定义"></a>接口定义</h2><ul>
<li>通过查看前端的请求记录，可以得出该接口的协议为：HTTP GET，请求参数为空<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">请求网址: http://localhost:8601/api/content/course-category/tree-nodes</span><br><span class="line">请求方法: GET</span><br><span class="line">状态代码: 404 Not Found</span><br><span class="line">远程地址: 127.0.0.1:8601</span><br></pre></td></tr></table></figure></li>
<li>此接口要返回全部课程分类，以树状结构返回，下面是示例<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="attr">&quot;childrenTreeNodes&quot;</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;childrenTreeNodes&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;id&quot;</span> : <span class="string">&quot;1-1-1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;isLeaf&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;isShow&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;label&quot;</span> : <span class="string">&quot;HTML/CSS&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;HTML/CSS&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;orderby&quot;</span> : <span class="number">1</span>,</span><br><span class="line">            <span class="attr">&quot;parentid&quot;</span> : <span class="string">&quot;1-1&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;childrenTreeNodes&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;id&quot;</span> : <span class="string">&quot;1-1-2&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;isLeaf&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;isShow&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;label&quot;</span> : <span class="string">&quot;JavaScript&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;JavaScript&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;orderby&quot;</span> : <span class="number">2</span>,</span><br><span class="line">            <span class="attr">&quot;parentid&quot;</span> : <span class="string">&quot;1-1&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;childrenTreeNodes&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;id&quot;</span> : <span class="string">&quot;1-1-3&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;isLeaf&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;isShow&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;label&quot;</span> : <span class="string">&quot;jQuery&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;jQuery&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;orderby&quot;</span> : <span class="number">3</span>,</span><br><span class="line">            <span class="attr">&quot;parentid&quot;</span> : <span class="string">&quot;1-1&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;id&quot;</span> : <span class="string">&quot;1-1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;isLeaf&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;isShow&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;label&quot;</span> : <span class="string">&quot;前端开发&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;前端开发&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;orderby&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;parentid&quot;</span> : <span class="string">&quot;1&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="attr">&quot;childrenTreeNodes&quot;</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;childrenTreeNodes&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;id&quot;</span> : <span class="string">&quot;1-2-1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;isLeaf&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;isShow&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;label&quot;</span> : <span class="string">&quot;微信开发&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;微信开发&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;orderby&quot;</span> : <span class="number">1</span>,</span><br><span class="line">            <span class="attr">&quot;parentid&quot;</span> : <span class="string">&quot;1-2&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;childrenTreeNodes&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;id&quot;</span> : <span class="string">&quot;1-2-2&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;isLeaf&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;isShow&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;label&quot;</span> : <span class="string">&quot;iOS&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;iOS&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;orderby&quot;</span> : <span class="number">2</span>,</span><br><span class="line">            <span class="attr">&quot;parentid&quot;</span> : <span class="string">&quot;1-2&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;childrenTreeNodes&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;id&quot;</span> : <span class="string">&quot;1-2-3&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;isLeaf&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;isShow&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;label&quot;</span> : <span class="string">&quot;其它&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;其它&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;orderby&quot;</span> : <span class="number">8</span>,</span><br><span class="line">            <span class="attr">&quot;parentid&quot;</span> : <span class="string">&quot;1-2&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;id&quot;</span> : <span class="string">&quot;1-2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;isLeaf&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;isShow&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;label&quot;</span> : <span class="string">&quot;移动开发&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;移动开发&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;orderby&quot;</span> : <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;parentid&quot;</span> : <span class="string">&quot;1&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li>
<li>可以看到，上面的数据格式是一个数组结构，数组的元素即为分类信息，分类信息设计两级分类<ul>
<li>第一级的分类信息示例如下，这部分字段其实就是课程分类信息表的属性，即我们之前生成的CourseCategory类<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;id&quot;</span> : <span class="string">&quot;1-2&quot;</span>,</span><br><span class="line"><span class="string">&quot;isLeaf&quot;</span> : <span class="literal">null</span>,</span><br><span class="line"><span class="string">&quot;isShow&quot;</span> : <span class="literal">null</span>,</span><br><span class="line"><span class="string">&quot;label&quot;</span> : <span class="string">&quot;移动开发&quot;</span>,</span><br><span class="line"><span class="string">&quot;name&quot;</span> : <span class="string">&quot;移动开发&quot;</span>,</span><br><span class="line"><span class="string">&quot;orderby&quot;</span> : <span class="number">2</span>,</span><br><span class="line"><span class="string">&quot;parentid&quot;</span> : <span class="string">&quot;1&quot;</span></span><br></pre></td></tr></table></figure></li>
<li>第二级的分类是第一级分类中的childrenTreeNode属性，它是一个数组结构<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;childrenTreeNodes&quot;</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;childrenTreeNodes&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;id&quot;</span> : <span class="string">&quot;1-2-1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;isLeaf&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;isShow&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;label&quot;</span> : <span class="string">&quot;微信开发&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;微信开发&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;orderby&quot;</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;parentid&quot;</span> : <span class="string">&quot;1-2&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;childrenTreeNodes&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;id&quot;</span> : <span class="string">&quot;1-2-2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;isLeaf&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;isShow&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;label&quot;</span> : <span class="string">&quot;iOS&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;iOS&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;orderby&quot;</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">&quot;parentid&quot;</span> : <span class="string">&quot;1-2&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;childrenTreeNodes&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;id&quot;</span> : <span class="string">&quot;1-2-3&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;isLeaf&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;isShow&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;label&quot;</span> : <span class="string">&quot;其它&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;其它&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;orderby&quot;</span> : <span class="number">8</span>,</span><br><span class="line">        <span class="attr">&quot;parentid&quot;</span> : <span class="string">&quot;1-2&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>那么我们可以定义一个DTO类表示分类信息的模型类，让其继承CourseCategory（对应一级分类），然后设置一个List属性（对应二级分类）<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseCategoryTreeDto</span> <span class="keyword">extends</span> <span class="title">CourseCategory</span> </span>&#123;</span><br><span class="line">    List childrenTreeNodes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>这样模型类就定义好了，下面我们来定义接口<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController(&quot;/course-category/tree-nodes&quot;)</span></span><br><span class="line"><span class="meta">@Api(value = &quot;课程分类相关接口&quot;, tags = &quot;课程分类相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseCategoryController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ApiOperation(&quot;课程分类相关接口&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CourseCategoryTreeDto&gt; <span class="title">queryTreeNodes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="接口开发-1"><a href="#接口开发-1" class="headerlink" title="接口开发"></a>接口开发</h2><ul>
<li>如何生成一个树形结构对象？这里有两种方案<div class="tabs" id="两种树形结构对象生成方案"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#两种树形结构对象生成方案-1">方案一</button></li><li class="tab"><button type="button" data-href="#两种树形结构对象生成方案-2">方案二</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="两种树形结构对象生成方案-1"><ul>
<li>可以将数据从数据库中读取出来，在Java程序中遍历数据组成一个树形结构对象</li>
<li>那这里先简单介绍一下如何编写SQL语句，注意到表中设置了每条数据的id和parentid，我们可以据此来创建内连接查询<br><img src="https://s1.ax1x.com/2023/02/01/pSDKnwF.png" alt=""></li>
<li>连接条件为<code>two.parentid = one.id</code>（二级分类的父节点为一级分类），同时<code>one.parentid = 1</code>（一级分类的父节点为根节点），这样就可以查询出所有的数据<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> </span><br><span class="line">course_category <span class="keyword">one</span></span><br><span class="line"><span class="keyword">JOIN</span> course_category two </span><br><span class="line"><span class="keyword">ON</span> two.parentid <span class="operator">=</span> one.id</span><br><span class="line"><span class="keyword">WHERE</span> one.parentid <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>但是此种方式存在一点问题，如果我们有三级分类的话，那么还得继续修改SQL语句<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    SELECT * FROM </span><br><span class="line">    course_category one</span><br><span class="line">    JOIN course_category two </span><br><span class="line">    ON two.parentid = one.id</span><br><span class="line">    JOIN course_category three</span><br><span class="line"><span class="addition">+   ON three.parentid = two.id</span></span><br><span class="line">    WHERE one.parentid = &#x27;1&#x27;</span><br></pre></td></tr></table></figure></li>
<li>所以如果当树的层级不固定时，此时就可以使用MySQL的递归实现，使用with语法，下面举一个简单的例子<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> <span class="keyword">RECURSIVE</span> t1 <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">AS</span> n</span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">    <span class="keyword">SELECT</span> n <span class="operator">+</span> <span class="number">1</span> <span class="keyword">FROM</span> t1 <span class="keyword">WHERE</span> n <span class="operator">&lt;</span> <span class="number">5</span></span><br><span class="line">)</span><br><span class="line">SELECCT <span class="operator">*</span> <span class="keyword">FROM</span> t1;</span><br></pre></td></tr></table></figure></li>
<li>它会把查询出来的结果再次代入到查询子句中继续查询，这里的<code>SELECT 1 AS n</code>，就是给一个递归的初始值，<code>WHERE n &lt; 5</code> 则是终止条件</li>
<li>那么我们现在来使用递归查询全部数据 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> <span class="keyword">RECURSIVE</span> t1 <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> p.<span class="operator">*</span> <span class="keyword">FROM</span> course_category p <span class="keyword">WHERE</span> p.id <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">    <span class="keyword">SELECT</span> c.<span class="operator">*</span> <span class="keyword">FROM</span> course_category c <span class="keyword">JOIN</span> t1 <span class="keyword">WHERE</span> c.parentid <span class="operator">=</span> t1.id</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1;</span><br></pre></td></tr></table></figure>
<img src="https://s1.ax1x.com/2023/02/01/pSDJXSe.png" alt=""></li>
<li>成功查询到数据了之后，我们现在就需要用Java代码将其组装成树形结构，在此之前，我们先来编写mapper（采用更灵活的递归查询）<ul>
<li>现在service中编写mapper对应的接口<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CourseCategoryMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">CourseCategory</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;CourseCategoryTreeDto&gt; <span class="title">selectTreeNodes</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>编写xml<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectTreeNodes&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;com.xuecheng.content.model.dto.CourseCategoryTreeDto&quot;</span>&gt;</span></span><br><span class="line">    WITH RECURSIVE t1 AS (</span><br><span class="line">        SELECT p.* FROM course_category p WHERE p.id = #&#123;id&#125;</span><br><span class="line">        UNION ALL</span><br><span class="line">        SELECT c.* FROM course_category c JOIN t1 WHERE c.parentid = t1.id</span><br><span class="line">    )</span><br><span class="line">    SELECT * FROM t1;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>mapper写好了之后，我们来编写Service，首先定义接口<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CourseCategoryService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 课程分类查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 根节点id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 根节点下面的所有子节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;CourseCategoryTreeDto&gt; <span class="title">queryTreeNodes</span><span class="params">(String id)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>具体实现，我们的mapper接口只返回了所有子节点的数据，那么现在我们要将这些子节点封装成一个树形结构<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseCategoryServiceImpl</span> <span class="keyword">implements</span> <span class="title">CourseCategoryService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CourseCategoryMapper courseCategoryMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CourseCategoryTreeDto&gt; <span class="title">queryTreeNodes</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取所有的子节点</span></span><br><span class="line">        List&lt;CourseCategoryTreeDto&gt; categoryTreeDtos = courseCategoryMapper.selectTreeNodes(id);</span><br><span class="line">        <span class="comment">// 定义一个List，作为最终返回的数据</span></span><br><span class="line">        List&lt;CourseCategoryTreeDto&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">// 为了方便找子节点的父节点，这里定义一个HashMap，key是节点的id，value是节点本身</span></span><br><span class="line">        HashMap&lt;String, CourseCategoryTreeDto&gt; nodeMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">// 将数据封装到List中，只包括根节点的下属节点（1-1、1-2 ···），这里遍历所有节点</span></span><br><span class="line">        categoryTreeDtos.stream().forEach(item -&gt; &#123;</span><br><span class="line">            <span class="comment">// 这里寻找父节点的直接下属节点（1-1、1-2 ···）</span></span><br><span class="line">            <span class="keyword">if</span> (item.getParentid().equals(id)) &#123;</span><br><span class="line">                nodeMap.put(item.getId(), item);</span><br><span class="line">                result.add(item);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 获取每个子节点的父节点</span></span><br><span class="line">            String parentid = item.getParentid();</span><br><span class="line">            CourseCategoryTreeDto parentNode = nodeMap.get(parentid);</span><br><span class="line">            <span class="comment">// 判断HashMap中是否存在该父节点（按理说必定存在，以防万一）</span></span><br><span class="line">            <span class="keyword">if</span> (parentNode != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 为父节点设置子节点（将1-1-1设为1-1的子节点）</span></span><br><span class="line">                List childrenTreeNodes = parentNode.getChildrenTreeNodes();</span><br><span class="line">                <span class="comment">// 如果子节点暂时为null，则初始化一下父节点的子节点（给个空集合就行）</span></span><br><span class="line">                <span class="keyword">if</span> (childrenTreeNodes == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    parentNode.setChildrenTreeNodes(<span class="keyword">new</span> ArrayList&lt;CourseCategoryTreeDto&gt;());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 将子节点设置给父节点</span></span><br><span class="line">                parentNode.getChildrenTreeNodes().add(item);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 返回根节点的直接下属节点（1-1、1-2 ···）</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>编写测试方法，进行调试<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">CourseCategoryService courseCategoryService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">contextCourseCategoryTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;CourseCategoryTreeDto&gt; courseCategoryTreeDtos = courseCategoryService.queryTreeNodes(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    System.out.println(courseCategoryTreeDtos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="https://s1.ax1x.com/2023/02/02/pSDNxOJ.png" alt=""></li>
<li>使用HTTP Client测试接口<br><img src="https://s1.ax1x.com/2023/02/02/pSDUZOH.png" alt=""></li>
<li>编写Controller方法<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(value = &quot;课程分类相关接口&quot;, tags = &quot;课程分类相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseCategoryController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CourseCategoryService courseCategoryService;</span><br><span class="line">    <span class="meta">@ApiOperation(&quot;课程分类相关接口&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/course-category/tree-nodes&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CourseCategoryTreeDto&gt; <span class="title">queryTreeNodes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> courseCategoryService.queryTreeNodes(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>重启服务，已经可以看到课程分类的信息了<br><img src="https://s1.ax1x.com/2023/02/02/pSDUpwR.png" alt=""></li>
</ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="两种树形结构对象生成方案-2"><ul>
<li>通过表的自连接查出数据，使用mybatis映射成一个树形结构</li>
<li>定义mapper接口方法，编写SQL<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CourseCategoryMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">CourseCategory</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;CourseCategoryTreeDto&gt; <span class="title">selectTreeNodes</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>编写对应的XML<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectTreeNodes&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;treeNodeResultMap&quot;</span> &gt;</span></span><br><span class="line">    select</span><br><span class="line">        one.id            one_id,</span><br><span class="line">        one.name          one_name,</span><br><span class="line">        one.parentid      one_parentid,</span><br><span class="line">        one.orderby       one_orderby,</span><br><span class="line">        one.label         one_label,</span><br><span class="line">        two.id            two_id,</span><br><span class="line">        two.name          two_name,</span><br><span class="line">        two.parentid      two_parentid,</span><br><span class="line">        two.orderby       two_orderby,</span><br><span class="line">        two.label         two_label</span><br><span class="line">    from course_category one</span><br><span class="line">             inner join course_category two on one.id = two.parentid</span><br><span class="line">    where one.parentid = 1</span><br><span class="line">      and one.is_show = 1</span><br><span class="line">      and two.is_show = 1</span><br><span class="line">    order by one.orderby,</span><br><span class="line">             two.orderby</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>编写resultMap映射<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 课程分类树型结构查询映射结果 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;treeNodeResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.xuecheng.content.model.dto.CourseCategoryTreeDto&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 一级数据映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>     <span class="attr">column</span>=<span class="string">&quot;one_id&quot;</span>        <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;one_name&quot;</span>      <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;one_label&quot;</span>     <span class="attr">property</span>=<span class="string">&quot;label&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;one_parentid&quot;</span>  <span class="attr">property</span>=<span class="string">&quot;parentid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;one_orderby&quot;</span>   <span class="attr">property</span>=<span class="string">&quot;orderby&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 一级中包含多个二级数据：二级的集合数据 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;childrenTreeNodes&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.xuecheng.content.model.dto.CourseCategoryTreeDto&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 二级数据映射 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>     <span class="attr">column</span>=<span class="string">&quot;two_id&quot;</span>        <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;two_name&quot;</span>      <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;two_label&quot;</span>     <span class="attr">property</span>=<span class="string">&quot;label&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;two_parentid&quot;</span>  <span class="attr">property</span>=<span class="string">&quot;parentid&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;two_orderby&quot;</span>   <span class="attr">property</span>=<span class="string">&quot;orderby&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>service接口和对应的实现类，测试方法，均与方案一一致，这里就不予赘述了</li>
</ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
</li>
</ul>
<h1 id="新增课程"><a href="#新增课程" class="headerlink" title="新增课程"></a>新增课程</h1><h2 id="需求分析-2"><a href="#需求分析-2" class="headerlink" title="需求分析"></a>需求分析</h2><h3 id="业务流程-2"><a href="#业务流程-2" class="headerlink" title="业务流程"></a>业务流程</h3><ul>
<li>根据前面对内容管理模块的数据模型分析，课程相关的信息有：课程基本信息、课程营销信息、课程图片信息、课程计划、课程师资信息，所以新增一门课程就需要完成这几部分的信息的编写</li>
<li>以下是业务流程<ol>
<li>进入课程查询列表</li>
<li>点击添加课程，选择课程类型是直播还是录播，课程类型不同，课程的授课方式也不同</li>
<li>选择完毕，点击下一步，进入课程基本信息添加界面<ul>
<li>本界面分为两部分信息，一部分是课程基本信息，一部分是课程营销信息</li>
</ul>
</li>
<li>添加课程计划信息<ul>
<li>课程计划即课程的大纲目录</li>
<li>课程计划分为两级，章节和小节</li>
<li>每个小节需要上传课程视频，用户点击小节标题即可开始播放视频</li>
<li>如果是直播课程，则会进入直播间</li>
</ul>
</li>
<li>课程计划填写完毕，进入课程师资管理<ul>
<li>在课程师资界面维护该课程的授课老师</li>
<li>到此，一门课程新增完成</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="数据模型-2"><a href="#数据模型-2" class="headerlink" title="数据模型"></a>数据模型</h3><ul>
<li>新增课程功能，只向课程基本信息表、课程营销信息表添加记录<ul>
<li>课程基本信息表<br><img src="https://s1.ax1x.com/2023/02/02/pSDBaWt.png" alt=""></li>
<li>课程营销信息表<br><img src="https://s1.ax1x.com/2023/02/02/pSDBwSP.png" alt=""></li>
</ul>
</li>
<li>新建课程的初始审核状态为<code>未提交</code>，初始发布状态为<code>未发布</code></li>
</ul>
<h2 id="接口定义-2"><a href="#接口定义-2" class="headerlink" title="接口定义"></a>接口定义</h2><ul>
<li>根据业务流程，这里先定义提交课程基本信息的接口<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">请求网址: http://localhost:8601/api/content/course</span><br><span class="line">请求方法: POST</span><br><span class="line">状态代码: 404 Not Found</span><br><span class="line">远程地址: 127.0.0.1:8601</span><br></pre></td></tr></table></figure></li>
<li>接口协议：HTTP POST</li>
<li>接口请求示例如下<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">### 创建课程</span><br><span class="line">POST &#123;&#123;content_host&#125;&#125;/content/course</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;mt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;st&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;pic&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;teachmode&quot;</span>: <span class="string">&quot;200002&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;users&quot;</span>: <span class="string">&quot;初级人员&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;tags&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;grade&quot;</span>: <span class="string">&quot;204001&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;charge&quot;</span>: <span class="string">&quot;201000&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;price&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;originalPrice&quot;</span>:<span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;qq&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;wechat&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;phone&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;validDays&quot;</span>: <span class="number">365</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">###响应结果如下</span><br><span class="line">#成功响应结果如下</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="number">109</span>,</span><br><span class="line">  <span class="attr">&quot;companyId&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;companyName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;测试课程103&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;users&quot;</span>: <span class="string">&quot;初级人员&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;tags&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;mt&quot;</span>: <span class="string">&quot;1-1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;mtName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;st&quot;</span>: <span class="string">&quot;1-1-1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;stName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;grade&quot;</span>: <span class="string">&quot;204001&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;teachmode&quot;</span>: <span class="string">&quot;200002&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;pic&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2022-09-08 07:35:16&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;changeDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;createPeople&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;changePeople&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;auditStatus&quot;</span>: <span class="string">&quot;202002&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;coursePubId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;coursePubDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;charge&quot;</span>: <span class="string">&quot;201000&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;price&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;originalPrice&quot;</span>:<span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;qq&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;wechat&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;phone&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;validDays&quot;</span>: <span class="number">365</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>请求参数和CourseBase模型类不一致，所以我们需要定义一个模型类来接收请求参数；同时，响应结果中包含了课程基本信息和课程营销信息还有课程分类信息，所以我们也需要定义一个响应结果模型类<div class="tabs" id="定义新增课程接收参数模型类和响应结果模型类"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#定义新增课程接收参数模型类和响应结果模型类-1">请求参数模型类</button></li><li class="tab"><button type="button" data-href="#定义新增课程接收参数模型类和响应结果模型类-2">响应结果模型类</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="定义新增课程接收参数模型类和响应结果模型类-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xuecheng.content.model.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotEmpty;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 添加课程dto</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;AddCourseDto&quot;, description = &quot;新增课程基本信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AddCourseDto</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程名称&quot;, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;适用人群&quot;, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> String users;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程标签&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String tags;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;大分类&quot;, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> String mt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;小分类&quot;, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> String st;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程等级&quot;, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> String grade;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;教学模式（普通，录播，直播等）&quot;, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> String teachmode;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程介绍&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程图片&quot;, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> String pic;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;收费规则，对应数据字典&quot;, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> String charge;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;价格&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Float price;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;原价&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Float originalPrice;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;qq&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String qq;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;微信&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String wechat;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;电话&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;有效期&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer validDays;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="定义新增课程接收参数模型类和响应结果模型类-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xuecheng.content.model.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xuecheng.content.model.po.CourseBase;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 课程基本信息dto</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseBaseInfoDto</span> <span class="keyword">extends</span> <span class="title">CourseBase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 收费规则，对应数据字典</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String charge;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 价格</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Float price;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 原价</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Float originalPrice;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 咨询qq</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String qq;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 微信</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String wechat;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 电话</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 有效期天数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer validDays;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 大分类名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String mtName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 小分类名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String stName;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></li>
<li>定义接口如下，返回类型和请求参数类型均为我们刚刚创建的模型类<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;新增课程基础信息接口&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/course&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CourseBaseInfoDto <span class="title">createCourseBase</span><span class="params">(<span class="meta">@RequestBody</span> AddCourseDto addCourseDto)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="接口开发-2"><a href="#接口开发-2" class="headerlink" title="接口开发"></a>接口开发</h2><ol>
<li>定义service接口，这里额外需要一个机构id，因为我们的业务是教学机构登录账号，然后添加该教学机构的下属课程<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增课程基本信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> companyId 教学机构id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> addCourseDto 课程基本信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">CourseBaseInfoDto <span class="title">createCourseBase</span><span class="params">(Long companyId, AddCourseDto addCourseDto)</span></span>;</span><br></pre></td></tr></table></figure></li>
<li>编写service接口实现类    <ul>
<li>首先我们需要对请求参数做合法性校验，判断一下用户是否输入了必填项，还有一些项的默认值</li>
<li>然后对请求参数进行封装，调用mapper进行数据持久化</li>
<li>组装返回结果<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">CourseBaseMapper courseBaseMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line">CourseMarketMapper courseMarketMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line">CourseCategoryMapper courseCategoryMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CourseBaseInfoDto <span class="title">createCourseBase</span><span class="params">(Long companyId, AddCourseDto addCourseDto)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 合法性校验</span></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(addCourseDto.getName())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;课程名称为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(addCourseDto.getMt())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;课程分类为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(addCourseDto.getSt())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;课程分类为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(addCourseDto.getGrade())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;课程等级为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(addCourseDto.getTeachmode())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;教育模式为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(addCourseDto.getUsers())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;适应人群为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(addCourseDto.getCharge())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;收费规则为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 封装请求参数</span></span><br><span class="line">    <span class="comment">// 封装课程基本信息</span></span><br><span class="line">    CourseBase courseBase = <span class="keyword">new</span> CourseBase();</span><br><span class="line">    BeanUtils.copyProperties(addCourseDto, courseBase);</span><br><span class="line">    <span class="comment">// 2.1 设置默认审核状态（去数据字典表中查询状态码）</span></span><br><span class="line">    courseBase.setAuditStatus(<span class="string">&quot;202002&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.2 设置默认发布状态</span></span><br><span class="line">    courseBase.setStatus(<span class="string">&quot;203001&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.3 设置机构id</span></span><br><span class="line">    courseBase.setCompanyId(companyId);</span><br><span class="line">    <span class="comment">// 2.4 设置添加时间</span></span><br><span class="line">    courseBase.setCreateDate(LocalDateTime.now());</span><br><span class="line">    <span class="comment">// 2.5 插入课程基本信息表</span></span><br><span class="line">    <span class="keyword">int</span> baseInsert = courseBaseMapper.insert(courseBase);</span><br><span class="line">    Long courseId = courseBase.getId();</span><br><span class="line">    <span class="comment">// 封装课程营销信息</span></span><br><span class="line">    CourseMarket courseMarket = <span class="keyword">new</span> CourseMarket();</span><br><span class="line">    BeanUtils.copyProperties(addCourseDto, courseMarket);</span><br><span class="line">    courseMarket.setId(courseId);</span><br><span class="line">    <span class="comment">// 2.6 判断收费规则，若课程收费，则价格必须大于0</span></span><br><span class="line">    String charge = courseMarket.getCharge();</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;201001&quot;</span>.equals(charge)) &#123;</span><br><span class="line">        Float price = addCourseDto.getPrice();</span><br><span class="line">        <span class="keyword">if</span> (price == <span class="keyword">null</span> || price.floatValue() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;课程设置了收费，价格不能为空，且必须大于0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.7 插入课程营销信息表</span></span><br><span class="line">    <span class="keyword">int</span> marketInsert = courseMarketMapper.insert(courseMarket);</span><br><span class="line">    <span class="keyword">if</span> (baseInsert &lt;= <span class="number">0</span> || marketInsert &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;新增课程基本信息失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3. 返回添加的课程信息</span></span><br><span class="line">    <span class="keyword">return</span> getCourseBaseInfo(courseId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> CourseBaseInfoDto <span class="title">getCourseBaseInfo</span><span class="params">(Long courseId)</span> </span>&#123;</span><br><span class="line">    CourseBaseInfoDto courseBaseInfoDto = <span class="keyword">new</span> CourseBaseInfoDto();</span><br><span class="line">    <span class="comment">// 1. 根据课程id查询课程基本信息</span></span><br><span class="line">    CourseBase courseBase = courseBaseMapper.selectById(courseId);</span><br><span class="line">    <span class="keyword">if</span> (courseBase == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// 1.1 拷贝属性</span></span><br><span class="line">    BeanUtils.copyProperties(courseBase, courseBaseInfoDto);</span><br><span class="line">    <span class="comment">// 2. 根据课程id查询课程营销信息</span></span><br><span class="line">    CourseMarket courseMarket = courseMarketMapper.selectById(courseId);</span><br><span class="line">    <span class="comment">// 2.1 拷贝属性</span></span><br><span class="line">    <span class="keyword">if</span> (courseMarket != <span class="keyword">null</span>)</span><br><span class="line">        BeanUtils.copyProperties(courseMarket, courseBaseInfoDto);</span><br><span class="line">    <span class="comment">// 3. 查询课程分类名称，并设置属性</span></span><br><span class="line">    <span class="comment">// 3.1 根据小分类id查询课程分类对象</span></span><br><span class="line">    CourseCategory courseCategoryBySt = courseCategoryMapper.selectById(courseBase.getSt());</span><br><span class="line">    <span class="comment">// 3.2 设置课程的小分类名称</span></span><br><span class="line">    courseBaseInfoDto.setStName(courseCategoryBySt.getName());</span><br><span class="line">    <span class="comment">// 3.3 根据大分类id查询课程分类对象</span></span><br><span class="line">    CourseCategory courseCategoryByMt = courseCategoryMapper.selectById(courseBase.getMt());</span><br><span class="line">    <span class="comment">// 3.4 设置课程大分类名称</span></span><br><span class="line">    courseBaseInfoDto.setMtName(courseCategoryByMt.getName());</span><br><span class="line">    <span class="keyword">return</span> courseBaseInfoDto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<ul>
<li>下面编写Controller方法<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;新增课程基础信息接口&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/course&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CourseBaseInfoDto <span class="title">createCourseBase</span><span class="params">(<span class="meta">@RequestBody</span> AddCourseDto addCourseDto)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 机构id，暂时硬编码模拟假数据</span></span><br><span class="line">    Long companyId = <span class="number">22L</span>;</span><br><span class="line">    <span class="keyword">return</span> courseBaseInfoService.createCourseBase(companyId, addCourseDto);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="接口测试-1"><a href="#接口测试-1" class="headerlink" title="接口测试"></a>接口测试</h2><ul>
<li>使用HTTP Client测试<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">### 新增课程</span><br><span class="line">POST &#123;&#123;content_host&#125;&#125;/content/course</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mt&quot;</span>: <span class="string">&quot;1-1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;st&quot;</span>: <span class="string">&quot;1-1-1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;测试课程tmp&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;pic&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;teachmode&quot;</span>: <span class="string">&quot;200002&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;users&quot;</span>: <span class="string">&quot;初级人员&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;tags&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;grade&quot;</span>: <span class="string">&quot;204001&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;这是一门测试课程&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;charge&quot;</span>: <span class="string">&quot;201000&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;price&quot;</span>: <span class="number">99</span>,</span><br><span class="line">  <span class="attr">&quot;originalPrice&quot;</span>: <span class="number">999</span>,</span><br><span class="line">  <span class="attr">&quot;qq&quot;</span>: <span class="string">&quot;123564&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;wechat&quot;</span>: <span class="string">&quot;123654&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;phone&quot;</span>: <span class="string">&quot;156213&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;validDays&quot;</span>: <span class="number">365</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>测试成功，去数据库中查询，也可以看到数据<br><img src="https://s1.ax1x.com/2023/02/02/pSrgsQs.png" alt=""></li>
</ul>
<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><h3 id="异常问题分析"><a href="#异常问题分析" class="headerlink" title="异常问题分析"></a>异常问题分析</h3><ul>
<li>在service方法中，有很多的参数合法性校验，当参数不合法的时候抛出异常，例如我们添加课程时，设置一个负数的课程价格，会报500异常<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;timestamp&quot;</span>:<span class="string">&quot;2023-02-02T14:42:36.820+00:00&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>:<span class="number">500</span>,</span><br><span class="line">    <span class="attr">&quot;error&quot;</span>:<span class="string">&quot;Internal Server Error&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;path&quot;</span>:<span class="string">&quot;/content/course&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>现在存在一个问题：并没有输出我们抛出异常时的指定异常信息，只有查看控制台日志才能看到异常信息<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.RuntimeException: 课程设置了收费，价格不能为空，且必须大于0</span><br></pre></td></tr></table></figure></li>
<li>所以我们现在要对异常信息进行处理，异常处理除了输出在日志中，还需要提示给用户。</li>
<li>前端和后端需要做一些约定<ol>
<li>错误体会信息统一以json格式返回给前端</li>
<li>以HTTP状态码决定当前是否出错，非<code>200</code>状态码为操作异常</li>
</ol>
</li>
<li>那么如何规范异常信息？<ul>
<li>代码中统一抛出项目的自定义异常类型，这样可以统一去捕获这一类或几类的异常</li>
<li>规范了异常类型，就可以去获取异常信息</li>
<li>如果捕获了非项目自定义的异常类型，则统一向用户提示<code>执行过程异常，请重试</code>的错误信息</li>
</ul>
</li>
<li>如何捕获异常？<ul>
<li>代码统一使用try/catch方式去捕获代码比较臃肿，可以通过SpringMVC提供的控制器增强类统一由一个类去完成异常的捕获<br><img src="https://s1.ax1x.com/2023/02/02/pSrIqit.png" alt=""></li>
</ul>
</li>
</ul>
<h3 id="统一异常处理实现"><a href="#统一异常处理实现" class="headerlink" title="统一异常处理实现"></a>统一异常处理实现</h3><ul>
<li>根据上面分析的方案，统一在base基础工程实现统一异常处理，各模块依赖了base基础工程，都可以使用</li>
<li>统一异常处理的步骤如下    <ol>
<li>在base工程中添加依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>定义一个枚举类，枚举一些通用的异常信息<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@description</span> 通用错误信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">CommonError</span> </span>&#123;</span><br><span class="line">    UNKOWN_ERROR(<span class="string">&quot;执行过程异常，请重试&quot;</span>),</span><br><span class="line">    PARAS_ERROR(<span class="string">&quot;非法参数&quot;</span>),</span><br><span class="line">    OBJECT_NULL(<span class="string">&quot;对象为空&quot;</span>),</span><br><span class="line">    QUERY_NULL(<span class="string">&quot;查询结果为空&quot;</span>),</span><br><span class="line">    REQUEST_NULL(<span class="string">&quot;请求参数为空&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String errMessage;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getErrMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> errMessage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    CommonError(String errMessage) &#123;</span><br><span class="line">        <span class="keyword">this</span>.errMessage = errMessage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>自定义异常类型<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@description</span> 学成在线项目异常类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XueChengPlusException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String errMessage;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getErrMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> errMessage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XueChengPlusException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XueChengPlusException</span><span class="params">(String errMessage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(errMessage);</span><br><span class="line">        <span class="keyword">this</span>.errMessage = errMessage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">cast</span><span class="params">(CommonError commonError)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> XueChengPlusException(commonError.getErrMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">cast</span><span class="params">(String errMessage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> XueChengPlusException(errMessage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>响应用户的统一类型<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestErrorResponse</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String errMessage;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>全局异常处理器<ul>
<li>从<code>Spring 3.0</code> - <code>Spring 3.2</code>版本之间，对Spring架构和SpringMVC的Controller的异常捕获提供了相应的异常处理<ul>
<li><code>@ExceptionHandler</code>：<code>Spring3.0</code>提供的标识，在方法上或类上的注解，用于表明方法的处理异常类型</li>
<li><code>@ControllerAdvice</code>：<code>Spring3.2</code>提供的新注解，用于增强SpringMVC中的Controller。通常与<code>@ExceptionHandler</code>结合使用，来处理SpringMVC的异常信息</li>
<li><code>@ResponseStatus</code>：<code>Spring3.0</code>提供的标识在方法或类上的注解，用状态码和应返回的原因标记方法或异常类。调用处理程序方法时，状态码将应用于HTTP响应</li>
</ul>
</li>
<li>通过上面的注解便可实现微服务全局异常处理，具体代码如下<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@description</span> 全局异常处理器</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(XueChengPlusException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span> <span class="comment">// 该异常枚举错误码为500，</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestErrorResponse <span class="title">customException</span><span class="params">(XueChengPlusException exception)</span> </span>&#123;</span><br><span class="line">        log.error(<span class="string">&quot;系统异常：&#123;&#125;&quot;</span>, exception.getErrMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestErrorResponse(exception.getErrMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestErrorResponse <span class="title">exception</span><span class="params">(Exception exception)</span> </span>&#123;</span><br><span class="line">        log.error(<span class="string">&quot;系统异常：&#123;&#125;&quot;</span>, exception.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestErrorResponse(exception.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="异常处理测试"><a href="#异常处理测试" class="headerlink" title="异常处理测试"></a>异常处理测试</h3><ul>
<li>在ContentAPI的启动类上添加<code>scanBasePackages = &quot;com.xuecheng&quot;</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableSwagger2Doc</span></span><br><span class="line"><span class="meta">@SpringBootApplication(scanBasePackages = &quot;com.xuecheng&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContentApiApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ContentApiApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>在异常处理测试之前，我们首先要将代码中抛出自定义类型的异常<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (price == <span class="keyword">null</span> || price.floatValue() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    XueChengPlusException.cast(<span class="string">&quot;课程设置了收费，价格不能为空，且必须大于0&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>使用HTTP Client进行测试，故意将收费课程价格设置为负数，捕获到的响应信息如下<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST http:<span class="comment">//localhost:53040/content/course</span></span><br><span class="line"></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">500</span> </span><br><span class="line">Content-Type: application/json</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Date: Fri, <span class="number">03</span> Feb <span class="number">2023</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">20</span> GMT</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;errMessage&quot;</span>: <span class="string">&quot;课程设置了收费，价格不能为空，且必须大于0&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>前后端联调，测试前端会不会抛出我们自定义的异常信息<br><img src="https://s1.ax1x.com/2023/02/03/pSs9EpF.png" alt=""></li>
<li>那么至此，项目的异常处理测试完毕，我们在开发中对于业务分支中的错误，要抛出项目自定义的异常类型</li>
</ul>
<h3 id="面试"><a href="#面试" class="headerlink" title="面试"></a>面试</h3><ol>
<li>系统如何处理异常？<ul>
<li>我们自定义一个统一的异常处理器去捕获并处理异常</li>
<li>使用控制器增强注解@ControllerAdvice（也可以用@RestControllerAdvice）和异常处理注解@ExceptionHandler来实现</li>
</ul>
</li>
<li>如何处理自定义异常？<ul>
<li>程序在编写代码时，根据校验结果主动抛出自定义异常类对象，抛出异常时指定详细的异常信息，异常处理器捕获异常信息记录、异常日志，并响应给用户</li>
</ul>
</li>
<li>如何处理未知异常？<ul>
<li>接口执行过程中的一些运行时异常也会被异常处理器统一捕获，记录异常日志，统一响应给用户500错误</li>
<li>在异常处理其中还可以对某个异常类型进行单独处理（使用@ExceptionHandler来声明要捕获的异常类型）</li>
</ul>
</li>
</ol>
<h2 id="JSR303校验"><a href="#JSR303校验" class="headerlink" title="JSR303校验"></a>JSR303校验</h2><h3 id="统一校验的需求"><a href="#统一校验的需求" class="headerlink" title="统一校验的需求"></a>统一校验的需求</h3><ul>
<li>前端请求后端接口传输参数，是在<code>Controller</code>中校验还是<code>Service</code>中校验？<ul>
<li>答案是都需要校验，只是分工不同</li>
</ul>
</li>
<li><code>Controller</code>中校验请求参数的合法性，包括：必填项校验、数据格式校验，比如：参数是否符合一定的日期格式等<ul>
<li><code>Controller</code>中可以将校验的代码写成通用代码</li>
</ul>
</li>
<li><code>Service</code>中要校验的是业务规则相关的内容，比如：课程已经审核通过，所以提交失败等<ul>
<li><code>Service</code>中需要根据业务规则去校验，所以不方便写成通用代码</li>
</ul>
</li>
<li>早在<code>JavaEE6</code>规范中，就定义了参数校验的规范，它就是<code>JSR-303</code>，它定义了<code>Bean Validation</code>，即对bean属性进行校验</li>
<li><code>SpringBoot</code>提供了<code>JSR-303</code>的支持，它就是<code>spring-boot-stater-validation</code>，它的底层使用<code>Hibernate Validation</code>，<code>Hibernate Validation</code>是<code>Bean Validation</code>的参考实现</li>
<li>所以我们打算在<code>Controller</code>层使用<code>spring-boot-stater-validation</code>完成对参数的基本合法性进行校验</li>
</ul>
<h3 id="统一校验实现"><a href="#统一校验实现" class="headerlink" title="统一校验实现"></a>统一校验实现</h3><ul>
<li>首先在Base工程中引入<code>spring-boot-starter-validation</code>依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>现在准备对内容管理模块添加课程接口进行校验<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;新增课程基础信息接口&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/course&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CourseBaseInfoDto <span class="title">createCourseBase</span><span class="params">(<span class="meta">@RequestBody</span> AddCourseDto addCourseDto)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 机构id，暂时硬编码模拟假数据</span></span><br><span class="line">    Long companyId = <span class="number">22L</span>;</span><br><span class="line">    <span class="keyword">return</span> courseBaseInfoService.createCourseBase(companyId, addCourseDto);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>此接口使用AddCourseDto模型对象接收参数，所以进入AddCourseDto模型类，在属性上添加校验规则<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@ApiModel(value = &quot;AddCourseDto&quot;, description = &quot;新增课程基本信息&quot;)</span><br><span class="line">public class AddCourseDto &#123;</span><br><span class="line"></span><br><span class="line"><span class="addition">+   @NotEmpty(message = &quot;课程名称不能为空&quot;)</span></span><br><span class="line">    @ApiModelProperty(value = &quot;课程名称&quot;, required = true)</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line"><span class="addition">+   @NotEmpty(message = &quot;适用人群不能为空&quot;)</span></span><br><span class="line"><span class="addition">+   @Size(min = 10, message = &quot;适用人群内容过少，至少10个字符&quot;)</span></span><br><span class="line">    @ApiModelProperty(value = &quot;适用人群&quot;, required = true)</span><br><span class="line">    private String users;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;课程标签&quot;)</span><br><span class="line">    private String tags;</span><br><span class="line"></span><br><span class="line"><span class="addition">+   @NotEmpty(message = &quot;课程分类不能为空&quot;)</span></span><br><span class="line">    @ApiModelProperty(value = &quot;大分类&quot;, required = true)</span><br><span class="line">    private String mt;</span><br><span class="line"></span><br><span class="line"><span class="addition">+   @NotEmpty(message = &quot;课程分类不能为空&quot;)</span></span><br><span class="line">    @ApiModelProperty(value = &quot;小分类&quot;, required = true)</span><br><span class="line">    private String st;</span><br><span class="line"></span><br><span class="line"><span class="addition">+   @NotEmpty(message = &quot;课程等级不能为空&quot;)</span></span><br><span class="line">    @ApiModelProperty(value = &quot;课程等级&quot;, required = true)</span><br><span class="line">    private String grade;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;教学模式（普通，录播，直播等）&quot;, required = true)</span><br><span class="line">    private String teachmode;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;课程介绍&quot;)</span><br><span class="line">    private String description;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;课程图片&quot;, required = true)</span><br><span class="line">    private String pic;</span><br><span class="line"></span><br><span class="line"><span class="addition">+   @NotEmpty(message = &quot;收费规则不能为空&quot;)</span></span><br><span class="line">    @ApiModelProperty(value = &quot;收费规则，对应数据字典&quot;, required = true)</span><br><span class="line">    private String charge;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;价格&quot;)</span><br><span class="line">    private Float price;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;原价&quot;)</span><br><span class="line">    private Float originalPrice;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;qq&quot;)</span><br><span class="line">    private String qq;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;微信&quot;)</span><br><span class="line">    private String wechat;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;电话&quot;)</span><br><span class="line">    private String phone;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;有效期&quot;)</span><br><span class="line">    private Integer validDays;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>上面用到了<code>@NotEmpty</code>和<code>@Size</code>两个注解，<code>@NotEmpty</code>表示属性不能为空，<code>@Size</code>表示限制属性内容的长度</li>
<li>在javax.validation.constraints包下有很多这样的校验注解</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">限制</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">@Nul</td>
<td style="text-align:center">限制只能为null</td>
</tr>
<tr>
<td style="text-align:center">@NotNull</td>
<td style="text-align:center">限制制必须不为null</td>
</tr>
<tr>
<td style="text-align:center">@AssertFalse</td>
<td style="text-align:center">限制必须为false</td>
</tr>
<tr>
<td style="text-align:center">@AssertTrue</td>
<td style="text-align:center">限制必须为true</td>
</tr>
<tr>
<td style="text-align:center">@DecimalMax(value)</td>
<td style="text-align:center">限制必须为一个不大于指定值的数字</td>
</tr>
<tr>
<td style="text-align:center">@DecimalMin(value)</td>
<td style="text-align:center">限制必须为一个不小于指定值的数字</td>
</tr>
<tr>
<td style="text-align:center">@Digits(integer fraction</td>
<td style="text-align:center">限制必须为一个小数，且整数部分的位数不能超过integer，小数部分的位数不能超过fraction</td>
</tr>
<tr>
<td style="text-align:center">@Future</td>
<td style="text-align:center">限制必须是一个将来的日期</td>
</tr>
<tr>
<td style="text-align:center">@Max(value)</td>
<td style="text-align:center">限制必须为一个不大于指定值的数字</td>
</tr>
<tr>
<td style="text-align:center">@Min(value)</td>
<td style="text-align:center">限制必须为一个不小于指定值的数字</td>
</tr>
<tr>
<td style="text-align:center">@Past</td>
<td style="text-align:center">限制必须是一个过去的日期</td>
</tr>
<tr>
<td style="text-align:center">@Pattern(value)</td>
<td style="text-align:center">限制必须符合指定的正则表达式</td>
</tr>
<tr>
<td style="text-align:center">@Size(max, min)</td>
<td style="text-align:center">限制字符长度必须在min到max之间</td>
</tr>
<tr>
<td style="text-align:center">@NotEmpty</td>
<td style="text-align:center">验证注解的元素值不为null且不为空(字符串长度不为0、集合大小不为0)</td>
</tr>
<tr>
<td style="text-align:center">@NotBlank</td>
<td style="text-align:center">验证注解的元素值不为空(不为null、去除首位空格后长度为0)，不同于@NotEmpty,@NotBlank只应用于字符串且在比较时会去除字符串的空格</td>
</tr>
<tr>
<td style="text-align:center">@Email</td>
<td style="text-align:center">验证注解的元素值是Email，也可以通过正则表达式和flag指定自定义的email格式</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>定义好了规则校验，还需要开启校验，在Controller方法中添加<code>@Validated</code>注解，如下<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;新增课程基础信息接口&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/course&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CourseBaseInfoDto <span class="title">createCourseBase</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Validated</span> AddCourseDto addCourseDto)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 机构id，暂时硬编码模拟假数据</span></span><br><span class="line">    Long companyId = <span class="number">22L</span>;</span><br><span class="line">    <span class="keyword">return</span> courseBaseInfoService.createCourseBase(companyId, addCourseDto);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>如果校验出错，Spring会抛出<code>MethodArgumentNotValidException</code>异常，我们需要在全局异常处理器中捕获异常，解析出异常信息<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line"><span class="meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RestErrorResponse <span class="title">doMethodArgumentNotValidException</span><span class="params">(MethodArgumentNotValidException exception)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 由于用户输入的内容可能存在多处错误，所以我们要将所有错误信息都提示给用户</span></span><br><span class="line">    BindingResult bindingResult = exception.getBindingResult();</span><br><span class="line">    <span class="comment">// 获取错误集合</span></span><br><span class="line">    List&lt;FieldError&gt; fieldErrors = bindingResult.getFieldErrors();</span><br><span class="line">    <span class="comment">// 拼接字符串</span></span><br><span class="line">    StringBuffer stringBuffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    fieldErrors.forEach(fieldError -&gt; stringBuffer.append(fieldError.getDefaultMessage()).append(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">    <span class="comment">// 记录日志</span></span><br><span class="line">    log.error(stringBuffer.toString());</span><br><span class="line">    <span class="comment">// 响应给用户</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RestErrorResponse(stringBuffer.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>重启内容管理服务，使用HTTP Client进行测试，将必填项设置为空，适用人群设置小于10个字，执行测试，接口响应结果如下<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST http:<span class="comment">//localhost:53040/content/course</span></span><br><span class="line"></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">500</span> </span><br><span class="line">Content-Type: application/json</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Date: Fri, <span class="number">03</span> Feb <span class="number">2023</span> <span class="number">04</span>:<span class="number">52</span>:<span class="number">30</span> GMT</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;errMessage&quot;</span>: <span class="string">&quot;课程名称不能为空,适用人群内容过少，至少10个字符,&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>可以看到校验器已生效</li>
</ul>
<h3 id="分组校验"><a href="#分组校验" class="headerlink" title="分组校验"></a>分组校验</h3><ul>
<li>有时候在同一个属性上设置一个校验规则不能满足要求 <ul>
<li>比如：订单标号是由系统生成，所以在添加订单时，要求订单编号为空；但是在更新订单时，要求订单编号不能为空。</li>
</ul>
</li>
<li>此时就需要用到分组校验，在同一个属性定义多个校验规则属于不同的分组<ul>
<li>比如：添加订单定义<code>@NULL</code>规则属于<code>insert</code>分组，更新订单定义<code>@NotEmpty</code>属于<code>update</code>分组，<code>insert</code>和<code>update</code>是分组的名称，可以自定义的<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Null(message = &quot;订单id需为空&quot;, groups = Insert.class)</span></span><br><span class="line"><span class="meta">@NotEmpty(message = &quot;订单id不能为空&quot;, groups = Update.class)</span></span><br><span class="line"><span class="keyword">private</span> String id;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>下面举例说明，我们用class类型来表示不同的分组，所以我们定义不同的接口类型（空接口）表示不同的分组，由于校验分组是公用的，所以定义在base工程中<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xuecheng.base.exception;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 校验分组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValidationGroups</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Insert</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Update</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Delete</span></span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>下面在定义校验规则时指定分组<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NotEmpty(message = &quot;添加课程名称不能为空&quot;, groups = ValidationGroups.Insert.class)</span></span><br><span class="line"><span class="meta">@NotEmpty(message = &quot;修改课程名称不能为空&quot;, groups = ValidationGroups.Update.class)</span></span><br><span class="line"><span class="meta">@ApiModelProperty(value = &quot;课程名称&quot;, required = true)</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br></pre></td></tr></table></figure></li>
<li>在Controller方法中启动校验规则时指定要使用的分组名<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;新增课程基础信息接口&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/course&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CourseBaseInfoDto <span class="title">createCourseBase</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Validated(ValidationGroups.Insert.class)</span> AddCourseDto addCourseDto)</span> </span>&#123;</span><br><span class="line">    Long companyId = <span class="number">22L</span>;</span><br><span class="line">    <span class="keyword">return</span> courseBaseInfoService.createCourseBase(companyId, addCourseDto);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>重启服务，使用HTTP Client进行测试<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST http:<span class="comment">//localhost:53040/content/course</span></span><br><span class="line"></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">500</span> </span><br><span class="line">Content-Type: application/json</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Date: Fri, <span class="number">03</span> Feb <span class="number">2023</span> <span class="number">05</span>:<span class="number">28</span>:<span class="number">23</span> GMT</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;errMessage&quot;</span>: <span class="string">&quot;添加课程名称不能为空,&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>由于这里指定的是Insert分组，所以抛出异常信息<code>添加课程名称不能为空</code>，如果修改分组为Update分组，则异常信息为<code>修改课程名称不能为空</code>，符合我们的预期</li>
</ul>
<h3 id="校验规则不满足？"><a href="#校验规则不满足？" class="headerlink" title="校验规则不满足？"></a>校验规则不满足？</h3><ul>
<li>如果<code>javax.validation.constraints</code>包下的校验规则满足不了需求怎么办？<ol>
<li>手写校验代码</li>
<li>自定义校验规则注解</li>
</ol>
</li>
</ul>
<h3 id="面试-1"><a href="#面试-1" class="headerlink" title="面试"></a>面试</h3><ul>
<li>请求参数的合法性如何校验？<ul>
<li>使用基于<code>JSR-303</code>的校验框架实现，<code>SpringBoot</code>提供了<code>JSR-303</code>的支持，它就是<code>spring-boot-starter-validation</code>，它包括了很多校验规则，只需要在模型类中通过注解指定校验规则，在<code>Controller</code>方法上开启校验。</li>
</ul>
</li>
</ul>
<h1 id="修改课程"><a href="#修改课程" class="headerlink" title="修改课程"></a>修改课程</h1><h2 id="需求分析-3"><a href="#需求分析-3" class="headerlink" title="需求分析"></a>需求分析</h2><h3 id="业务流程-3"><a href="#业务流程-3" class="headerlink" title="业务流程"></a>业务流程</h3><ol>
<li>点击课程列表查询</li>
<li>点击编辑，此时应该看到对应数据的回显数据</li>
<li>点击保存，完成修改</li>
</ol>
<h3 id="数据模型-3"><a href="#数据模型-3" class="headerlink" title="数据模型"></a>数据模型</h3><ul>
<li>修改课程还是涉及到之前的课程基本信息表和课程营销信息表</li>
<li>但是修改课程提交的数据比新增课程多了一项课程id，因为修改课程需要对某个具体的课程进行修改，新增课程的课程id是系统生成的</li>
<li>修改完成保存数据时，还需要更新课程基本信息表中的修改时间</li>
</ul>
<h2 id="接口定义-3"><a href="#接口定义-3" class="headerlink" title="接口定义"></a>接口定义</h2><h3 id="查询课程信息"><a href="#查询课程信息" class="headerlink" title="查询课程信息"></a>查询课程信息</h3><ul>
<li>定义根据课程id查询课程信息的接口，接口示例如下<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">GET /content/course/<span class="number">40</span></span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line"># 响应结果</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">40</span>,</span><br><span class="line">    <span class="attr">&quot;companyId&quot;</span>: <span class="number">1232141425</span>,</span><br><span class="line">    <span class="attr">&quot;companyName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;SpringBoot核心&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;users&quot;</span>: <span class="string">&quot;Spring Boot初学者&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;tags&quot;</span>: <span class="string">&quot;Spring项目的快速构建&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;mt&quot;</span>: <span class="string">&quot;1-3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;mtName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;st&quot;</span>: <span class="string">&quot;1-3-2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;stName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;grade&quot;</span>: <span class="string">&quot;200003&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;teachmode&quot;</span>: <span class="string">&quot;201001&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;课程系统性地深度探讨 Spring Boot 核心特性，引导小伙伴对 Java 规范的重视，启发对技术原理性的思考，掌握排查问题的技能，以及学习阅读源码的方法和技巧，全面提升研发能力，进军架构师队伍。&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;pic&quot;</span>: <span class="string">&quot;https://cdn.educba.com/academy/wp-content/uploads/2018/08/Spring-BOOT-Interview-questions.jpg&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2019-09-10 16:05:39&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;changeDate&quot;</span>: <span class="string">&quot;2022-09-09 07:27:48&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;createPeople&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;changePeople&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;auditStatus&quot;</span>: <span class="string">&quot;202004&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;203001&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;coursePubId&quot;</span>: <span class="number">21</span>,</span><br><span class="line">    <span class="attr">&quot;coursePubDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;charge&quot;</span>: <span class="string">&quot;201001&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;price&quot;</span>: <span class="number">0.01</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>查询结果为单挑课程信息，内容和新增课程的返回结果一一致，接口定义如下<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;根据课程id查询课程基础信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/course/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CourseBaseInfoDto <span class="title">getCourseBaseById</span><span class="params">(<span class="meta">@PathVariable</span> Long courseId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="修改课程信息"><a href="#修改课程信息" class="headerlink" title="修改课程信息"></a>修改课程信息</h3><ul>
<li>根据前面的数据模型分析，修改课程提交的数据比新增课程提交的数据多了一个课程id，接口示例如下<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">### 修改课程</span><br><span class="line">PUT /content/course</span><br><span class="line">Content-Type: application/json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">40</span>,</span><br><span class="line">    <span class="attr">&quot;companyName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;SpringBoot核心&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;users&quot;</span>: <span class="string">&quot;Spring Boot初学者&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;tags&quot;</span>: <span class="string">&quot;Spring项目的快速构建&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;mt&quot;</span>: <span class="string">&quot;1-3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;st&quot;</span>: <span class="string">&quot;1-3-2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;grade&quot;</span>: <span class="string">&quot;200003&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;teachmode&quot;</span>: <span class="string">&quot;201001&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;课程系统性地深度探讨 Spring Boot 核心特性，引导小伙伴对 Java 规范的重视，启发对技术原理性的思考，掌握排查问题的技能，以及学习阅读源码的方法和技巧，全面提升研发能力，进军架构师队伍。&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;pic&quot;</span>: <span class="string">&quot;https://cdn.educba.com/academy/wp-content/uploads/2018/08/Spring-BOOT-Interview-questions.jpg&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;charge&quot;</span>: <span class="string">&quot;201001&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;price&quot;</span>: <span class="number">0.01</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###修改成功响应结果如下</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">40</span>,</span><br><span class="line">    <span class="attr">&quot;companyId&quot;</span>: <span class="number">1232141425</span>,</span><br><span class="line">    <span class="attr">&quot;companyName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;SpringBoot核心&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;users&quot;</span>: <span class="string">&quot;Spring Boot初学者&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;tags&quot;</span>: <span class="string">&quot;Spring项目的快速构建&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;mt&quot;</span>: <span class="string">&quot;1-3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;mtName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;st&quot;</span>: <span class="string">&quot;1-3-2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;stName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;grade&quot;</span>: <span class="string">&quot;200003&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;teachmode&quot;</span>: <span class="string">&quot;201001&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;课程系统性地深度探讨 Spring Boot 核心特性，引导小伙伴对 Java 规范的重视，启发对技术原理性的思考，掌握排查问题的技能，以及学习阅读源码的方法和技巧，全面提升研发能力，进军架构师队伍。&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;pic&quot;</span>: <span class="string">&quot;https://cdn.educba.com/academy/wp-content/uploads/2018/08/Spring-BOOT-Interview-questions.jpg&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2019-09-10 16:05:39&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;changeDate&quot;</span>: <span class="string">&quot;2022-09-09 07:27:48&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;createPeople&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;changePeople&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;auditStatus&quot;</span>: <span class="string">&quot;202004&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;203001&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;coursePubId&quot;</span>: <span class="number">21</span>,</span><br><span class="line">    <span class="attr">&quot;coursePubDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;charge&quot;</span>: <span class="string">&quot;201001&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;price&quot;</span>: <span class="number">0.01</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>那么我们这里就需要再定义一个模型类，用于接收修改课程提交的数据，定义一个课程id属性，然后继承AddCourseDto就好了<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;EditCourseDto&quot;, description = &quot;修改课程基本信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EditCourseDto</span> <span class="keyword">extends</span> <span class="title">AddCourseDto</span></span>&#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程id&quot;, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>接口定义如下，请求路径与新增课程的一致，只是请求方式不同<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;修改课程基础信息接口&quot;)</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/course&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CourseBaseInfoDto <span class="title">modifyCourseBase</span><span class="params">(<span class="meta">@RequestBody</span> EditCourseDto editCourseDto)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="接口开发-3"><a href="#接口开发-3" class="headerlink" title="接口开发"></a>接口开发</h2><h3 id="查询课程信息-1"><a href="#查询课程信息-1" class="headerlink" title="查询课程信息"></a>查询课程信息</h3><ul>
<li>之前我们在做新增课程的时候，就已经编写过了查询课程的代码<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> CourseBaseInfoDto <span class="title">getCourseBaseInfo</span><span class="params">(Long courseId)</span> </span>&#123;</span><br><span class="line">    CourseBaseInfoDto courseBaseInfoDto = <span class="keyword">new</span> CourseBaseInfoDto();</span><br><span class="line">    <span class="comment">// 1. 根据课程id查询课程基本信息</span></span><br><span class="line">    CourseBase courseBase = courseBaseMapper.selectById(courseId);</span><br><span class="line">    <span class="keyword">if</span> (courseBase == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// 1.1 拷贝属性</span></span><br><span class="line">    BeanUtils.copyProperties(courseBase, courseBaseInfoDto);</span><br><span class="line">    <span class="comment">// 2. 根据课程id查询课程营销信息</span></span><br><span class="line">    CourseMarket courseMarket = courseMarketMapper.selectById(courseId);</span><br><span class="line">    <span class="comment">// 2.1 拷贝属性</span></span><br><span class="line">    <span class="keyword">if</span> (courseMarket != <span class="keyword">null</span>)</span><br><span class="line">        BeanUtils.copyProperties(courseMarket, courseBaseInfoDto);</span><br><span class="line">    <span class="comment">// 3. 查询课程分类名称，并设置属性</span></span><br><span class="line">    <span class="comment">// 3.1 根据小分类id查询课程分类对象</span></span><br><span class="line">    CourseCategory courseCategoryBySt = courseCategoryMapper.selectById(courseBase.getSt());</span><br><span class="line">    <span class="comment">// 3.2 设置课程的小分类名称</span></span><br><span class="line">    courseBaseInfoDto.setStName(courseCategoryBySt.getName());</span><br><span class="line">    <span class="comment">// 3.3 根据大分类id查询课程分类对象</span></span><br><span class="line">    CourseCategory courseCategoryByMt = courseCategoryMapper.selectById(courseBase.getMt());</span><br><span class="line">    <span class="comment">// 3.4 设置课程大分类名称</span></span><br><span class="line">    courseBaseInfoDto.setMtName(courseCategoryByMt.getName());</span><br><span class="line">    <span class="keyword">return</span> courseBaseInfoDto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>现在只需要将查询课程信息的方法提到接口上，这样在Controller中就可以通过Service接口调用此方法<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据课程id查询课程基本信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> courseId  课程id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">CourseBaseInfoDto <span class="title">getCourseBaseInfo</span><span class="params">(Long courseId)</span></span>;</span><br></pre></td></tr></table></figure></li>
<li>完善Controller层代码<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;根据课程id查询课程基础信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/course/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CourseBaseInfoDto <span class="title">getCourseBaseById</span><span class="params">(<span class="meta">@PathVariable</span> Long courseId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> courseBaseInfoService.getCourseBaseInfo(courseId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="修改课程信息-1"><a href="#修改课程信息-1" class="headerlink" title="修改课程信息"></a>修改课程信息</h3><ul>
<li>在Service层新增修改课程的接口与方法<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改课程信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> companyId 机构id，本机构只能修改本机构课程</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">CourseBaseInfoDto <span class="title">updateCourseBase</span><span class="params">(Long companyId, EditCourseDto editCourseDto)</span></span>;</span><br></pre></td></tr></table></figure></li>
<li>对应的实现方法如下<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CourseBaseInfoDto <span class="title">updateCourseBase</span><span class="params">(Long companyId, EditCourseDto editCourseDto)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 判断当前修改课程是否属于当前机构</span></span><br><span class="line">    Long courseId = editCourseDto.getId();</span><br><span class="line">    CourseBase courseBase = courseBaseMapper.selectById(courseId);</span><br><span class="line">    <span class="keyword">if</span> (!companyId.equals(courseBase.getCompanyId())) &#123;</span><br><span class="line">        XueChengPlusException.cast(<span class="string">&quot;只允许修改本机构的课程&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 拷贝对象</span></span><br><span class="line">    BeanUtils.copyProperties(editCourseDto, courseBase);</span><br><span class="line">    <span class="comment">// 更新，设置更新时间</span></span><br><span class="line">    courseBase.setChangeDate(LocalDateTime.now());</span><br><span class="line">    courseBaseMapper.updateById(courseBase);</span><br><span class="line">    <span class="comment">// 查询课程营销信息</span></span><br><span class="line">    CourseMarket courseMarket = courseMarketMapper.selectById(courseId);</span><br><span class="line">    <span class="comment">// 由于课程营销信息不是必填项，故这里先判断一下</span></span><br><span class="line">    <span class="keyword">if</span> (courseMarket == <span class="keyword">null</span>) &#123;</span><br><span class="line">        courseMarket = <span class="keyword">new</span> CourseMarket();</span><br><span class="line">    &#125;</span><br><span class="line">    courseMarket.setId(courseId);</span><br><span class="line">    <span class="comment">// 获取课程收费状态并设置</span></span><br><span class="line">    String charge = editCourseDto.getCharge();</span><br><span class="line">    courseMarket.setCharge(charge);</span><br><span class="line">    <span class="comment">// 如果课程收费，则判断价格是否正常</span></span><br><span class="line">    <span class="keyword">if</span> (charge.equals(<span class="string">&quot;201001&quot;</span>)) &#123;</span><br><span class="line">        Float price = editCourseDto.getPrice();</span><br><span class="line">        <span class="keyword">if</span> (price &lt;= <span class="number">0</span> || price == <span class="keyword">null</span>) &#123;</span><br><span class="line">            XueChengPlusException.cast(<span class="string">&quot;课程设置了收费，价格不能为空，且必须大于0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 对象拷贝</span></span><br><span class="line">    BeanUtils.copyProperties(editCourseDto, courseMarket);</span><br><span class="line">    <span class="comment">// 有则更新，无则插入</span></span><br><span class="line">    courseMarketService.saveOrUpdate(courseMarket);</span><br><span class="line">    <span class="keyword">return</span> getCourseBaseInfo(courseId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>需要注意的一点是：saveOrUpdate方法是MP提供的，我们要事先编写courseMarketServiceImpl，并将其注入<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseMarketServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">CourseMarketMapper</span>, <span class="title">CourseMarket</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>完善接口层代码<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">CourseMarketServiceImpl courseMarketServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiOperation(&quot;修改课程基础信息接口&quot;)</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/course&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CourseBaseInfoDto <span class="title">modifyCourseBase</span><span class="params">(<span class="meta">@RequestBody</span> EditCourseDto editCourseDto)</span> </span>&#123;</span><br><span class="line">    Long companyId = <span class="number">22L</span>;</span><br><span class="line">    <span class="keyword">return</span> courseBaseInfoService.updateCourseBase(companyId, editCourseDto);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="接口测试-2"><a href="#接口测试-2" class="headerlink" title="接口测试"></a>接口测试</h2><ul>
<li>使用HTTP Client进行测试查询课程，可以看到响应的正常数据<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">### 根据课程id查询课程基本信息</span><br><span class="line">GET &#123;&#123;content_host&#125;&#125;/content/course/<span class="number">22</span></span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">### 结果如下</span><br><span class="line">GET http:<span class="comment">//localhost:53040/content/course/22</span></span><br><span class="line"></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> </span><br><span class="line">Content-Type: application/json</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Date: Sat, <span class="number">04</span> Feb <span class="number">2023</span> <span class="number">07</span>:<span class="number">06</span>:<span class="number">22</span> GMT</span><br><span class="line">Keep-Alive: timeout=<span class="number">60</span></span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="number">22</span>,</span><br><span class="line">  <span class="attr">&quot;companyId&quot;</span>: <span class="number">1232141425</span>,</span><br><span class="line">  <span class="attr">&quot;companyName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;大数据2&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;users&quot;</span>: <span class="string">&quot;具有一定的java基础&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;tags&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;mt&quot;</span>: <span class="string">&quot;1-6&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;st&quot;</span>: <span class="string">&quot;1-6-1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;grade&quot;</span>: <span class="string">&quot;200001&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;teachmode&quot;</span>: <span class="string">&quot;200002&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;111111大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据大数据&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;pic&quot;</span>: <span class="string">&quot;https://cdn.educba.com/academy/wp-content/uploads/2018/08/Spring-BOOT-Interview-questions.jpg&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2019-09-04 09:56:19&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;changeDate&quot;</span>: <span class="string">&quot;2022-09-16 07:59:57&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;createPeople&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;changePeople&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;auditStatus&quot;</span>: <span class="string">&quot;202001&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;203001&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;charge&quot;</span>: <span class="string">&quot;201001&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;price&quot;</span>: <span class="number">11.0</span>,</span><br><span class="line">  <span class="attr">&quot;originalPrice&quot;</span>: <span class="number">1111.0</span>,</span><br><span class="line">  <span class="attr">&quot;qq&quot;</span>: <span class="string">&quot;334455&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;wechat&quot;</span>: <span class="string">&quot;223321&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;phone&quot;</span>: <span class="string">&quot;1333333&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;validDays&quot;</span>: <span class="number">33</span>,</span><br><span class="line">  <span class="attr">&quot;mtName&quot;</span>: <span class="string">&quot;云计算/大数据&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;stName&quot;</span>: <span class="string">&quot;Spark&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>使用HTTP Client测试修改课程信息<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">### 修改课程</span><br><span class="line">PUT &#123;&#123;content_host&#125;&#125;/content/course/</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>:<span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;companyId&quot;</span>:<span class="number">22</span>,</span><br><span class="line">  <span class="attr">&quot;companyName&quot;</span>:<span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;JAVA8/9/10新特性讲解&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;users&quot;</span>:<span class="string">&quot;java爱好者,有一定java基础&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;tags&quot;</span>:<span class="string">&quot;有个java 版本变化的新内容，帮助大家使用最新的思想和工具&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;mt&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;st&quot;</span>:<span class="string">&quot;1-3-2&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;grade&quot;</span>:<span class="string">&quot;204002&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;teachmode&quot;</span>:<span class="string">&quot;200002&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>:<span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;pic&quot;</span>:<span class="string">&quot;https://cdn.educba.com/academy/wp-content/uploads/2018/08/Spring-BOOT-Interview-questions.jpg&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;createDate&quot;</span>:<span class="string">&quot;2019-09-03 17:48:19&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;changeDate&quot;</span>:<span class="string">&quot;2022-09-17 16:47:29&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;createPeople&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;changePeople&quot;</span>:<span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;auditStatus&quot;</span>:<span class="string">&quot;202004&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>:<span class="string">&quot;203001&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;charge&quot;</span>:<span class="string">&quot;201001&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;price&quot;</span>:<span class="number">2</span>,</span><br><span class="line">  <span class="attr">&quot;originalPrice&quot;</span>:<span class="number">11</span>,</span><br><span class="line">  <span class="attr">&quot;qq&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;wechat&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;phone&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;validDays&quot;</span>:<span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;mtName&quot;</span>:<span class="string">&quot;根结点&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;stName&quot;</span>:<span class="string">&quot;Java&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;uiCategoryTreeSelected&quot;</span>:[</span><br><span class="line">    <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;1-3-2&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>修改成功后，去数据库中查看数据是否修改成功</li>
</ul>
<h2 id="代码优化"><a href="#代码优化" class="headerlink" title="代码优化"></a>代码优化</h2><ul>
<li>程序员写的代码不仅要完成功能实现，还要养成代码重构优化的习惯，这样久而久之在写代码的过程中就养成了代码抽取和封装的习惯</li>
<li>例如刚刚我们写的代码，在新增课程和修改课程中，都对课程营销信息进行了保存，且都校验了课程营销信息的价格字段，都是先判断收费状况，然后校验价格，最后保存，那么这里就可以将对课程营销信息的校验和保存相关代码进行抽取，如下<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">saveCourseMarket</span><span class="params">(CourseMarket courseMarket)</span> </span>&#123;</span><br><span class="line">    String charge = courseMarket.getCharge();</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(charge))</span><br><span class="line">        XueChengPlusException.cast(<span class="string">&quot;请设置收费规则&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (charge.equals(<span class="string">&quot;201001&quot;</span>)) &#123;</span><br><span class="line">        Float price = courseMarket.getPrice();</span><br><span class="line">        <span class="keyword">if</span> (price == <span class="keyword">null</span> || price &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            XueChengPlusException.cast(<span class="string">&quot;课程设置了收费，价格不能为空，且必须大于0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.7 插入课程营销信息表</span></span><br><span class="line">    <span class="keyword">boolean</span> flag = courseMarketServiceImpl.saveOrUpdate(courseMarket);</span><br><span class="line">    <span class="keyword">return</span> flag ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="查询课程计划"><a href="#查询课程计划" class="headerlink" title="查询课程计划"></a>查询课程计划</h1><h2 id="需求分析-4"><a href="#需求分析-4" class="headerlink" title="需求分析"></a>需求分析</h2><h3 id="业务流程-4"><a href="#业务流程-4" class="headerlink" title="业务流程"></a>业务流程</h3><ul>
<li>当我们添加/修改完课程基本信息后，将自动进入课程计划编辑界面</li>
<li>课程计划即课程的大纲目录</li>
<li>课程计划分为两级：章节和小节</li>
<li>本小节完成课程计划信息的查询</li>
</ul>
<h2 id="数据模型-4"><a href="#数据模型-4" class="headerlink" title="数据模型"></a>数据模型</h2><ul>
<li>课程计划查询也是一个树状结构，表结构如下<br><img src="https://s1.ax1x.com/2023/02/05/pS6e1aD.png" alt=""></li>
<li>每个课程计划都有所属课程</li>
<li>每个课程的课程计划有两个级别<ul>
<li>第一级为章，grade为1</li>
<li>第二季为小节，grade为2</li>
<li>第二级的parentid为第一级的id</li>
</ul>
</li>
<li>根据业务流程中的界面原型，课程计划列表展示时还有课程计划关联的视频信息</li>
<li>课程计划关联的视频信息在teachplan_media表<br><img src="https://s1.ax1x.com/2023/02/05/pS6esiQ.png" alt=""></li>
<li>两张表是一对一关系，每个课程计划只能在teachplan_media表中存在一个视频</li>
</ul>
<h2 id="接口定义-4"><a href="#接口定义-4" class="headerlink" title="接口定义"></a>接口定义</h2><ul>
<li>接口示例如下<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">GET /teachplan/<span class="number">22</span>/tree-nodes</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;changeDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;courseId&quot;</span>: <span class="number">74</span>,</span><br><span class="line">        <span class="attr">&quot;cousePubId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;createDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;endTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;grade&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;isPreview&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;mediaType&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;orderby&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;parentid&quot;</span>: <span class="number">112</span>,</span><br><span class="line">        <span class="attr">&quot;pname&quot;</span>: <span class="string">&quot;第1章基础知识&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;startTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;status&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="number">113</span>,</span><br><span class="line">        <span class="attr">&quot;teachPlanTreeNodes&quot;</span>: [&#123;</span><br><span class="line">            <span class="attr">&quot;changeDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="number">74</span>,</span><br><span class="line">            <span class="attr">&quot;cousePubId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;createDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;endTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;grade&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;isPreview&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;mediaType&quot;</span>: <span class="string">&quot;001002&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;orderby&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">&quot;parentid&quot;</span>: <span class="number">113</span>,</span><br><span class="line">            <span class="attr">&quot;pname&quot;</span>: <span class="string">&quot;第1节项目概述&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;startTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;status&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;id&quot;</span>: <span class="number">115</span>,</span><br><span class="line">            <span class="attr">&quot;teachPlanTreeNodes&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;teachplanMedia&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;courseId&quot;</span>: <span class="number">74</span>,</span><br><span class="line">                <span class="attr">&quot;coursePubId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">&quot;mediaFilename&quot;</span>: <span class="string">&quot;2.avi&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;mediaId&quot;</span>: <span class="number">41</span>,</span><br><span class="line">                <span class="attr">&quot;teachplanId&quot;</span>: <span class="number">115</span>,</span><br><span class="line">                <span class="attr">&quot;id&quot;</span>: <span class="literal">null</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;],</span><br><span class="line">        <span class="attr">&quot;teachplanMedia&quot;</span>: <span class="literal">null</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">&quot;changeDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;courseId&quot;</span>: <span class="number">74</span>,</span><br><span class="line">        <span class="attr">&quot;cousePubId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;createDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;endTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;grade&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;isPreview&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;mediaType&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;orderby&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;parentid&quot;</span>: <span class="number">112</span>,</span><br><span class="line">        <span class="attr">&quot;pname&quot;</span>: <span class="string">&quot;第2章快速入门&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;startTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;status&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="number">242</span>,</span><br><span class="line">        <span class="attr">&quot;teachPlanTreeNodes&quot;</span>: [&#123;</span><br><span class="line">                <span class="attr">&quot;changeDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">&quot;courseId&quot;</span>: <span class="number">74</span>,</span><br><span class="line">                <span class="attr">&quot;cousePubId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">&quot;createDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">&quot;endTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">&quot;grade&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;isPreview&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;mediaType&quot;</span>: <span class="string">&quot;001002&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;orderby&quot;</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">&quot;parentid&quot;</span>: <span class="number">242</span>,</span><br><span class="line">                <span class="attr">&quot;pname&quot;</span>: <span class="string">&quot;第1节搭建环境&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;startTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">&quot;status&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">&quot;id&quot;</span>: <span class="number">244</span>,</span><br><span class="line">                <span class="attr">&quot;teachPlanTreeNodes&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">&quot;teachplanMedia&quot;</span>: &#123;</span><br><span class="line">                    <span class="attr">&quot;courseId&quot;</span>: <span class="number">74</span>,</span><br><span class="line">                    <span class="attr">&quot;coursePubId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="attr">&quot;mediaFilename&quot;</span>: <span class="string">&quot;3.avi&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;mediaId&quot;</span>: <span class="number">42</span>,</span><br><span class="line">                    <span class="attr">&quot;teachplanId&quot;</span>: <span class="number">244</span>,</span><br><span class="line">                    <span class="attr">&quot;id&quot;</span>: <span class="literal">null</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">&quot;changeDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">&quot;courseId&quot;</span>: <span class="number">74</span>,</span><br><span class="line">                <span class="attr">&quot;cousePubId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">&quot;createDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">&quot;endTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">&quot;grade&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;isPreview&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;mediaType&quot;</span>: <span class="string">&quot;001002&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;orderby&quot;</span>: <span class="number">3</span>,</span><br><span class="line">                <span class="attr">&quot;parentid&quot;</span>: <span class="number">242</span>,</span><br><span class="line">                <span class="attr">&quot;pname&quot;</span>: <span class="string">&quot;第2节项目概述&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;startTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">&quot;status&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">&quot;id&quot;</span>: <span class="number">245</span>,</span><br><span class="line">                <span class="attr">&quot;teachPlanTreeNodes&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">&quot;teachplanMedia&quot;</span>: &#123;</span><br><span class="line">                    <span class="attr">&quot;courseId&quot;</span>: <span class="number">74</span>,</span><br><span class="line">                    <span class="attr">&quot;coursePubId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="attr">&quot;mediaFilename&quot;</span>: <span class="string">&quot;1a.avi&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;mediaId&quot;</span>: <span class="number">39</span>,</span><br><span class="line">                    <span class="attr">&quot;teachplanId&quot;</span>: <span class="number">245</span>,</span><br><span class="line">                    <span class="attr">&quot;id&quot;</span>: <span class="literal">null</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">&quot;teachplanMedia&quot;</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li>
<li>查询课程计划的请求参数：课程id</li>
<li>查询课程计划的响应结果为一个数组，数组中的元素除了包括Teachplan表中的内容，还关联了TeachplanMedia和teachPlanTreeNodes，即课程媒资信息和子目录</li>
<li>所以对于响应结果，我们需要自定义一个模型类，让该模型类继承Teachplan，然后其中再新增<code>TeachplanMedia</code>和<code>List&lt;TeachPlanTreeNodes&gt;</code>属性（子目录不止一个，可以有多个）<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeachplanDto</span> <span class="keyword">extends</span> <span class="title">Teachplan</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> TeachplanMedia teachplanMedia;</span><br><span class="line">    <span class="keyword">private</span> List&lt;TeachplanDto&gt; teachPlanTreeNodes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>接口定义如下<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(value = &quot;课程计划编辑接口&quot;, tags = &quot;课程计划编辑接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeachplanController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ApiOperation(&quot;查询课程计划树形结构&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/teachplan/&#123;courseId&#125;/tree-nodes&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;TeachplanDto&gt; <span class="title">getTreeNodes</span><span class="params">(<span class="meta">@PathVariable</span> Long courseId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="接口开发-4"><a href="#接口开发-4" class="headerlink" title="接口开发"></a>接口开发</h2><ul>
<li>使用SQL语句查询课程计划，组成一个树形结构</li>
<li>在TeachplanMapper中定义方法<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TeachplanMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Teachplan</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;TeachplanDto&gt; <span class="title">selectTreeNodes</span><span class="params">(Long courseId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>编写SQL语句<ul>
<li>一级分类和二级分类通过teachplan表的自连接进行，如果一级分类旗下没有二级分类，此时也需要显示一级分类，所以这里使用左连接，左边是一级分类，右边是二级分类</li>
<li>同时课程的媒资信息teachplan_media也需要和teachplan左连接，左边是teachplan，右边是媒资信息teachplan_media<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	p.id p_id,</span><br><span class="line">	p.pname p_pname,</span><br><span class="line">	p.parentid p_parentid,</span><br><span class="line">	p.grade p_grade,</span><br><span class="line">	p.media_type p_mediaType,</span><br><span class="line">	p.start_time p_stratTime,</span><br><span class="line">	p.end_time p_endTime,</span><br><span class="line">	p.orderby p_orderby,</span><br><span class="line">	p.course_id p_courseId,</span><br><span class="line">	p.course_pub_id p_coursePubId,</span><br><span class="line">	c.id c_id,</span><br><span class="line">	c.pname c_pname,</span><br><span class="line">	c.parentid c_parentid,</span><br><span class="line">	c.grade c_grade,</span><br><span class="line">	c.media_type c_mediaType,</span><br><span class="line">	c.start_time c_stratTime,</span><br><span class="line">	c.end_time c_endTime,</span><br><span class="line">	c.orderby c_orderby,</span><br><span class="line">	c.course_id c_courseId,</span><br><span class="line">	c.course_pub_id c_coursePubId,</span><br><span class="line">	tm.media_fileName mediaFilename,</span><br><span class="line">	tm.id teachplanMeidaId,</span><br><span class="line">	tm.media_id mediaId </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	teachplan p</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> teachplan c <span class="keyword">ON</span> c.parentid <span class="operator">=</span> p.id</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> teachplan_media tm <span class="keyword">ON</span> tm.teachplan_id <span class="operator">=</span> c.id </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	p.parentid <span class="operator">=</span> <span class="string">&#x27;0&#x27;</span> <span class="keyword">AND</span> p.course_id <span class="operator">=</span> #&#123;<span class="keyword">value</span>&#125;</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> p.orderby, c.orderby</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>定义mapper.xml，我们需要按照响应结果手动配置查询结果的映射，最终查询的结果要返回的是TeachplanDto类型<div class="tabs" id="hjwef"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#hjwef-1">响应结果json</button></li><li class="tab"><button type="button" data-href="#hjwef-2">编写mybatis映射</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="hjwef-1"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;changeDate&quot;</span>: <span class="literal">null</span>,              <span class="comment">// 一级分类              </span></span><br><span class="line">    <span class="attr">&quot;courseId&quot;</span>: <span class="number">74</span>,                                           </span><br><span class="line">    <span class="attr">&quot;cousePubId&quot;</span>: <span class="literal">null</span>,                                           </span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="literal">null</span>,                                           </span><br><span class="line">    <span class="attr">&quot;endTime&quot;</span>: <span class="literal">null</span>,                                              </span><br><span class="line">    <span class="attr">&quot;grade&quot;</span>: <span class="string">&quot;2&quot;</span>,                                             </span><br><span class="line">    <span class="attr">&quot;isPreview&quot;</span>: <span class="string">&quot;0&quot;</span>,                                             </span><br><span class="line">    <span class="attr">&quot;mediaType&quot;</span>: <span class="literal">null</span>,                                            </span><br><span class="line">    <span class="attr">&quot;orderby&quot;</span>: <span class="number">1</span>,                                             </span><br><span class="line">    <span class="attr">&quot;parentid&quot;</span>: <span class="number">112</span>,                                              </span><br><span class="line">    <span class="attr">&quot;pname&quot;</span>: <span class="string">&quot;第1章基础知识&quot;</span>,                                             </span><br><span class="line">    <span class="attr">&quot;startTime&quot;</span>: <span class="literal">null</span>,                                            </span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="literal">null</span>,                                           </span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">113</span>,                                            </span><br><span class="line">    <span class="attr">&quot;teachPlanTreeNodes&quot;</span>: [&#123;         <span class="comment">// 二级分类，其中可能存在多个       </span></span><br><span class="line">        <span class="attr">&quot;changeDate&quot;</span>: <span class="literal">null</span>,             </span><br><span class="line">        <span class="attr">&quot;courseId&quot;</span>: <span class="number">74</span>,</span><br><span class="line">        <span class="attr">&quot;cousePubId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;createDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;endTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;grade&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;isPreview&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;mediaType&quot;</span>: <span class="string">&quot;001002&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;orderby&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;parentid&quot;</span>: <span class="number">113</span>,</span><br><span class="line">        <span class="attr">&quot;pname&quot;</span>: <span class="string">&quot;第1节项目概述&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;startTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;status&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="number">115</span>,</span><br><span class="line">        <span class="attr">&quot;teachPlanTreeNodes&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;teachplanMedia&quot;</span>: &#123;         <span class="comment">// 媒资信息</span></span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="number">74</span>,</span><br><span class="line">            <span class="attr">&quot;coursePubId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;mediaFilename&quot;</span>: <span class="string">&quot;2.avi&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;mediaId&quot;</span>: <span class="number">41</span>,</span><br><span class="line">            <span class="attr">&quot;teachplanId&quot;</span>: <span class="number">115</span>,</span><br><span class="line">            <span class="attr">&quot;id&quot;</span>: <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="attr">&quot;teachplanMedia&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="hjwef-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 课程分类树形结构查询映射结果 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;treeNodeResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.xuecheng.content.model.dto.TeachplanDto&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 一级数据映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;p_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;p_pname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;pname&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;p_parentid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;parentid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;p_grade&quot;</span> <span class="attr">property</span>=<span class="string">&quot;grade&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;p_mediaType&quot;</span> <span class="attr">property</span>=<span class="string">&quot;mediaType&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;p_startTime&quot;</span> <span class="attr">property</span>=<span class="string">&quot;startTime&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;p_endTime&quot;</span> <span class="attr">property</span>=<span class="string">&quot;endTime&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;p_orderby&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderby&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;p_courseId&quot;</span> <span class="attr">property</span>=<span class="string">&quot;courseId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;p_coursePubId&quot;</span> <span class="attr">property</span>=<span class="string">&quot;coursePubId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 一级数据下可能包含多个二级数据 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;teachPlanTreeNodes&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.xuecheng.content.model.dto.TeachplanDto&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--二级数据映射--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;c_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;c_pname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;pname&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;c_parentid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;parentid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;c_grade&quot;</span> <span class="attr">property</span>=<span class="string">&quot;grade&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;c_mediaType&quot;</span> <span class="attr">property</span>=<span class="string">&quot;mediaType&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;c_startTime&quot;</span> <span class="attr">property</span>=<span class="string">&quot;startTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;c_endTime&quot;</span> <span class="attr">property</span>=<span class="string">&quot;endTime&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;c_orderby&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderby&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;c_courseId&quot;</span> <span class="attr">property</span>=<span class="string">&quot;courseId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;c_coursePubId&quot;</span> <span class="attr">property</span>=<span class="string">&quot;coursePubId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 媒资信息映射 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;teachplanMedia&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.xuecheng.content.model.po.TeachplanMedia&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;teachplanMeidaId&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;mediaFilename&quot;</span> <span class="attr">property</span>=<span class="string">&quot;mediaFilename&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;mediaId&quot;</span> <span class="attr">property</span>=<span class="string">&quot;mediaId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;c_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;teachplanId&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;c_courseId&quot;</span> <span class="attr">property</span>=<span class="string">&quot;courseId&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;c_coursePubId&quot;</span> <span class="attr">property</span>=<span class="string">&quot;coursePubId&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectTreeNodes&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;treeNodeResultMap&quot;</span>&gt;</span></span><br><span class="line">    SELECT p.id              p_id,</span><br><span class="line">           p.pname           p_pname,</span><br><span class="line">           p.parentid        p_parentid,</span><br><span class="line">           p.grade           p_grade,</span><br><span class="line">           p.media_type      p_mediaType,</span><br><span class="line">           p.start_time      p_stratTime,</span><br><span class="line">           p.end_time        p_endTime,</span><br><span class="line">           p.orderby         p_orderby,</span><br><span class="line">           p.course_id       p_courseId,</span><br><span class="line">           p.course_pub_id   p_coursePubId,</span><br><span class="line">           c.id              c_id,</span><br><span class="line">           c.pname           c_pname,</span><br><span class="line">           c.parentid        c_parentid,</span><br><span class="line">           c.grade           c_grade,</span><br><span class="line">           c.media_type      c_mediaType,</span><br><span class="line">           c.start_time      c_stratTime,</span><br><span class="line">           c.end_time        c_endTime,</span><br><span class="line">           c.orderby         c_orderby,</span><br><span class="line">           c.course_id       c_courseId,</span><br><span class="line">           c.course_pub_id   c_coursePubId,</span><br><span class="line">           tm.media_fileName mediaFilename,</span><br><span class="line">           tm.id             teachplanMeidaId,</span><br><span class="line">           tm.media_id       mediaId</span><br><span class="line">    FROM teachplan p</span><br><span class="line">             LEFT JOIN teachplan c ON c.parentid = p.id</span><br><span class="line">             LEFT JOIN teachplan_media tm ON tm.teachplan_id = c.id</span><br><span class="line">    WHERE p.parentid = &#x27;0&#x27; AND p.course_id = #&#123;value&#125;</span><br><span class="line">    ORDER BY p.orderby, c.orderby</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></li>
<li>最后定义Service接口，ServiceImpl实现类，完善Controller层代码<div class="tabs" id="yjjyg"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#yjjyg-1">TeachplanService</button></li><li class="tab"><button type="button" data-href="#yjjyg-2">TeachplanServiceImpl</button></li><li class="tab"><button type="button" data-href="#yjjyg-3">TeachplanController</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="yjjyg-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TeachplanService</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;TeachplanDto&gt; <span class="title">findTeachplanTree</span><span class="params">(Long courseId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="yjjyg-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeachplanServiceImpl</span> <span class="keyword">implements</span> <span class="title">TeachplanService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TeachplanMapper teachplanMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;TeachplanDto&gt; <span class="title">findTeachplanTree</span><span class="params">(Long courseId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> teachplanMapper.selectTreeNodes(courseId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="yjjyg-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(value = &quot;课程计划编辑接口&quot;, tags = &quot;课程计划编辑接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeachplanController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TeachplanService teachplanService;</span><br><span class="line">    <span class="meta">@ApiOperation(&quot;查询课程计划树形结构&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/teachplan/&#123;courseId&#125;/tree-nodes&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;TeachplanDto&gt; <span class="title">getTreeNodes</span><span class="params">(<span class="meta">@PathVariable</span> Long courseId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> teachplanService.findTeachplanTree(courseId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
</li>
</ul>
<h2 id="接口测试-3"><a href="#接口测试-3" class="headerlink" title="接口测试"></a>接口测试</h2><ol>
<li>使用HTTP Client测试<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">### 根据课程id查询课程计划</span><br><span class="line">GET &#123;&#123;content_host&#125;&#125;/content/teachplan/<span class="number">22</span>/tree-nodes</span><br><span class="line">Content-Type: application/json</span><br></pre></td></tr></table></figure></li>
<li>前后端联调，进入课程编辑界面，点击保存，进入到课程计划编辑界面，可以看到已经存在的课程计划<br><img src="https://s1.ax1x.com/2023/02/06/pSg9Y7j.png" alt=""></li>
</ol>
<h1 id="新增-修改课程计划"><a href="#新增-修改课程计划" class="headerlink" title="新增/修改课程计划"></a>新增/修改课程计划</h1><h2 id="需求分析-5"><a href="#需求分析-5" class="headerlink" title="需求分析"></a>需求分析</h2><h3 id="业务流程-5"><a href="#业务流程-5" class="headerlink" title="业务流程"></a>业务流程</h3><ol>
<li>进入课程计划界面<br><img src="https://s1.ax1x.com/2023/02/06/pSg9Y7j.png" alt=""></li>
<li>点击添加章，新增第一级课程计划</li>
<li>点击添加小节，可以向某第一级课程计划下添加小节</li>
<li>点击章/节的名称，可以修改名称、选择是否免费</li>
</ol>
<h3 id="数据模型-5"><a href="#数据模型-5" class="headerlink" title="数据模型"></a>数据模型</h3><ol>
<li>新增第一级课程计划<ul>
<li>默认名称：<code>新章名称[点击修改]</code></li>
<li>grade：1</li>
<li>orderby：按添加顺序</li>
</ul>
</li>
<li>新增第二级课程计划<ul>
<li>默认名称：<code>新小节名称[点击修改]</code></li>
<li>grade：2</li>
<li>orderby：按添加顺序</li>
</ul>
</li>
<li>修改第一级、第二级课程计划的名称，修改第二级课程计划是否免费</li>
</ol>
<h2 id="接口定义-5"><a href="#接口定义-5" class="headerlink" title="接口定义"></a>接口定义</h2><ul>
<li>接口示例如下<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">### 新增课程计划--章,当grade为<span class="number">1</span>时parentid为<span class="number">0</span></span><br><span class="line">POST &#123;&#123;content_host&#125;&#125;/content/teachplan</span><br><span class="line">Content-Type: application/json</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;courseId&quot;</span> : <span class="number">74</span>,</span><br><span class="line"><span class="attr">&quot;parentid&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;grade&quot;</span> : <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;pname&quot;</span> : <span class="string">&quot;新章名称 [点击修改]&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">### 新增课程计划--节</span><br><span class="line">POST &#123;&#123;content_host&#125;&#125;/content/teachplan</span><br><span class="line">Content-Type: application/json</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;courseId&quot;</span> : <span class="number">74</span>,</span><br><span class="line"><span class="attr">&quot;parentid&quot;</span>: <span class="number">247</span>,</span><br><span class="line"><span class="attr">&quot;grade&quot;</span> : <span class="number">2</span>,</span><br><span class="line"><span class="attr">&quot;pname&quot;</span> : <span class="string">&quot;新小节名称 [点击修改]&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">### 修改课程计划--节</span><br><span class="line">POST &#123;&#123;content_host&#125;&#125;/content/teachplan</span><br><span class="line">Content-Type: application/json</span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;id&quot;</span>: <span class="number">293</span>,</span><br><span class="line">	<span class="attr">&quot;pname&quot;</span>: <span class="string">&quot;3.1Nacos作配置中心&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;parentid&quot;</span>: <span class="number">292</span>,</span><br><span class="line">	<span class="attr">&quot;grade&quot;</span>: <span class="number">2</span>,</span><br><span class="line">	<span class="attr">&quot;mediaType&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">&quot;startTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">&quot;endTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">&quot;description&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">&quot;timelength&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">&quot;orderby&quot;</span>: <span class="number">1</span>,</span><br><span class="line">	<span class="attr">&quot;courseId&quot;</span>: <span class="number">117</span>,</span><br><span class="line">	<span class="attr">&quot;coursePubId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">&quot;status&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">&quot;isPreview&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">&quot;createDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">&quot;changeDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">&quot;teachplanMedia&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">&quot;teachPlanTreeNodes&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">&quot;ctlEditTitle&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="attr">&quot;ctlBarShow&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>我们可以通过同一个接口接收新增和修改两个业务的请求，以是否传递课程计划id来判断该请求是新增还是修改<ul>
<li>新增和修改的唯一区别就是是否有id，如果传递了课程计划id，说明当前是要修改该课程计划，否则是新增一个课程计划</li>
</ul>
</li>
<li>接收请求参数的模型类我这里用的是Teachplan，但黑马课件中用的是下面这个。<ul>
<li>该类中的所有属性，在Teachplan类中均有，且前端的请求载荷不止这些属性，Teachplan中的属性更全面，且本人测试使用Teachplan作为模型类也能完成相同的功能<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SaveTeachplanDto</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 教学计划id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 课程计划名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String pname;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 课程计划父级Id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long parentid;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 层级，分为1、2、3级</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer grade;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 课程类型:1视频、2文档</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String mediaType;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 课程标识</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long courseId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 课程发布标识</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long coursePubId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否支持试学或预览（试看）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String isPreview;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>定义接口如下，我这里就用Teachplan当接收请求参数的模型类了<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;课程计划创建或修改&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/teachplan&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveTeachplan</span><span class="params">(<span class="meta">@RequestBody</span> Teachplan teachplanDto)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="接口开发-5"><a href="#接口开发-5" class="headerlink" title="接口开发"></a>接口开发</h2><ul>
<li>定义保存课程计划的接口<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">saveTeachplan</span><span class="params">(Teachplan teachplan)</span></span>;</span><br></pre></td></tr></table></figure></li>
<li>编写接口实现<div class="tabs" id="trhryj"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#trhryj-1">我的写法</button></li><li class="tab"><button type="button" data-href="#trhryj-2">黑马课件中写法</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="trhryj-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveTeachplan</span><span class="params">(Teachplan teachplan)</span> </span>&#123;</span><br><span class="line">    Long teachplanId = teachplan.getId();</span><br><span class="line">    <span class="keyword">if</span> (teachplanId == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 课程计划id为null，创建对象，拷贝属性，设置创建时间和排序号</span></span><br><span class="line">        Teachplan plan = <span class="keyword">new</span> Teachplan();</span><br><span class="line">        BeanUtils.copyProperties(teachplan, plan);</span><br><span class="line">        plan.setCreateDate(LocalDateTime.now());</span><br><span class="line">        <span class="comment">// 设置排序号</span></span><br><span class="line">        plan.setOrderby(getTeachplanCount(plan.getCourseId(), plan.getParentid()) + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 如果新增失败，返回0，抛异常</span></span><br><span class="line">        <span class="keyword">int</span> flag = teachplanMapper.insert(plan);</span><br><span class="line">        <span class="keyword">if</span> (flag &lt;= <span class="number">0</span>) XueChengPlusException.cast(<span class="string">&quot;新增失败&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 课程计划id不为null，查询课程，拷贝属性，设置更新时间，执行更新</span></span><br><span class="line">        Teachplan plan = teachplanMapper.selectById(teachplanId);</span><br><span class="line">        BeanUtils.copyProperties(teachplan, plan);</span><br><span class="line">        plan.setChangeDate(LocalDateTime.now());</span><br><span class="line">        <span class="comment">// 如果修改失败，返回0，抛异常</span></span><br><span class="line">        <span class="keyword">int</span> flag = teachplanMapper.updateById(plan);</span><br><span class="line">        <span class="keyword">if</span> (flag &lt;= <span class="number">0</span>) XueChengPlusException.cast(<span class="string">&quot;修改失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getTeachplanCount</span><span class="params">(Long courseId, Long parentId)</span> </span>&#123;</span><br><span class="line">    LambdaQueryWrapper&lt;Teachplan&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(Teachplan::getCourseId, courseId);</span><br><span class="line">    queryWrapper.eq(Teachplan::getParentid, parentId);</span><br><span class="line">    <span class="keyword">return</span> teachplanMapper.selectCount(queryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="trhryj-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveTeachplan</span><span class="params">(SaveTeachplanDto teachplanDto)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//课程计划id</span></span><br><span class="line">    Long id = teachplanDto.getId();</span><br><span class="line">    <span class="comment">//修改课程计划</span></span><br><span class="line">    <span class="keyword">if</span> (id != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Teachplan teachplan = teachplanMapper.selectById(id);</span><br><span class="line">        BeanUtils.copyProperties(teachplanDto, teachplan);</span><br><span class="line">        teachplanMapper.updateById(teachplan);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//取出同父同级别的课程计划数量</span></span><br><span class="line">        <span class="keyword">int</span> count = getTeachplanCount(teachplanDto.getCourseId(),</span><br><span class="line">                teachplanDto.getParentid());</span><br><span class="line">        Teachplan teachplanNew = <span class="keyword">new</span> Teachplan();</span><br><span class="line">        <span class="comment">//设置排序号</span></span><br><span class="line">        teachplanNew.setOrderby(count + <span class="number">1</span>);</span><br><span class="line">        BeanUtils.copyProperties(teachplanDto, teachplanNew);</span><br><span class="line">        teachplanMapper.insert(teachplanNew);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
</li>
</ul>
<h2 id="接口测试-4"><a href="#接口测试-4" class="headerlink" title="接口测试"></a>接口测试</h2><ul>
<li>前后端联调，分别测试新增章、新增小节、修改章/小节<br><img src="https://s1.ax1x.com/2023/02/06/pSgPKQf.png" alt=""></li>
</ul>
<h2 id="BUG修改"><a href="#BUG修改" class="headerlink" title="BUG修改"></a>BUG修改</h2><ul>
<li>BUG是看不到添加的章节信息</li>
<li>我其实没遇到bug，因为代码是我自己敲的，看不到章节信息是因为SQL语句有问题，不应该用内连接，得用左外连接<ul>
<li>当初看视频的时候，感觉这个内连接就有问题，新增章节下面没有小节信息，用内连接必然查不出来，因为连接条件是<code>c.parentid = p.id</code></li>
<li>用左外连接（章节当左），会显示左表的全部内容，那么不管章节下有没有小节信息，都会显示章节<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teachplan p</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> teachplan c <span class="keyword">ON</span> c.parentid <span class="operator">=</span> p.id</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> teachplan_media tm <span class="keyword">ON</span> tm.teachplan_id <span class="operator">=</span> c.id</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h1 id="内容管理模块实战"><a href="#内容管理模块实战" class="headerlink" title="内容管理模块实战"></a>内容管理模块实战</h1><ul>
<li>这部分要完成的内容包括<ul>
<li>添加课程、添加课程计划、添加师资信息</li>
<li>修改课程、修改课程计划、修改师资信息</li>
<li>删除课程、删除课程计划、删除师资信息</li>
<li>课程计划上移、下移功能</li>
</ul>
</li>
</ul>
<h2 id="删除课程计划"><a href="#删除课程计划" class="headerlink" title="删除课程计划"></a>删除课程计划</h2><h3 id="需求分析-6"><a href="#需求分析-6" class="headerlink" title="需求分析"></a>需求分析</h3><ul>
<li>课程计划添加成功，如果课程还没有提交，可以删除课程计划</li>
<li>删除第一级别的章时，要求章下边没有小节方可删除</li>
<li>删除第二级别的小节的同时，也需要将其关联的媒资信息也删除</li>
<li>删除课程计划需要传输课程计划的id</li>
</ul>
<h3 id="接口定义-6"><a href="#接口定义-6" class="headerlink" title="接口定义"></a>接口定义</h3><ul>
<li><p>删除课程计划的接口示例如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">删除结点</span><br><span class="line">Request URL: /content/teachplan/<span class="number">246</span></span><br><span class="line">Request Method: DELETE</span><br><span class="line">如果失败：</span><br><span class="line">&#123;<span class="attr">&quot;errCode&quot;</span>:<span class="string">&quot;120409&quot;</span>,<span class="attr">&quot;errMessage&quot;</span>:<span class="string">&quot;课程计划信息还有子级信息，无法操作&quot;</span>&#125;</span><br><span class="line">如果成功：状态码<span class="number">200</span>，不返回信息</span><br></pre></td></tr></table></figure>
<div class="note info no-icon flat"><p>我这里没管这个错误状态码，因为与之前编写的异常模型类不符合</p>
</div>
</li>
<li><p>定义接口如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;课程计划删除&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/content/teachplan/&#123;teachplanId&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteTeachplan</span><span class="params">(<span class="meta">@PathVariable</span> Long teachplanId)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="接口开发-6"><a href="#接口开发-6" class="headerlink" title="接口开发"></a>接口开发</h3><ul>
<li>定义删除课程计划的接口<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deleteTeachplan</span><span class="params">(Long teachplanId)</span></span>;</span><br></pre></td></tr></table></figure></li>
<li>对应的接口实现<div class="tabs" id="taasd"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#taasd-1">方案一</button></li><li class="tab"><button type="button" data-href="#taasd-2">方案二</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="taasd-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteTeachplan</span><span class="params">(Long teachplanId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (teachplanId == <span class="keyword">null</span>)</span><br><span class="line">        XueChengPlusException.cast(<span class="string">&quot;课程计划id为空&quot;</span>);</span><br><span class="line">    Teachplan teachplan = teachplanMapper.selectById(teachplanId);</span><br><span class="line">    <span class="comment">// 判断当前课程计划是章还是节</span></span><br><span class="line">    Integer grade = teachplan.getGrade();</span><br><span class="line">    <span class="comment">// 当前课程计划为章</span></span><br><span class="line">    <span class="keyword">if</span> (grade == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 查询当前课程计划下是否有小节</span></span><br><span class="line">        LambdaQueryWrapper&lt;Teachplan&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">        <span class="comment">// select * from teachplan where parentid = &#123;当前章计划id&#125;</span></span><br><span class="line">        queryWrapper.eq(Teachplan::getParentid, teachplanId);</span><br><span class="line">        <span class="comment">// 获取一下查询的条目数</span></span><br><span class="line">        Integer count = teachplanMapper.selectCount(queryWrapper);</span><br><span class="line">        <span class="comment">// 如果当前章下还有小节，则抛异常</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>)</span><br><span class="line">            XueChengPlusException.cast(<span class="string">&quot;课程计划信息还有子级信息，无法操作&quot;</span>);</span><br><span class="line">        teachplanMapper.deleteById(teachplanId);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 课程计划为节</span></span><br><span class="line">        teachplanMapper.deleteById(teachplanId);</span><br><span class="line">        LambdaQueryWrapper&lt;TeachplanMedia&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(TeachplanMedia::getTeachplanId, teachplanId);</span><br><span class="line">        teachplanMediaMapper.delete(queryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="taasd-2"><ul>
<li>该方案是由B站用户<a target="_blank" rel="noopener" href="https://space.bilibili.com/20367792">Topsail</a>提出的</li>
<li>可以将判断条件改为只判断当前课程计划下是否有小节<ul>
<li>有小节，则抛异常</li>
<li>无小节，则直接删除该课程计划和对应的媒资信息<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteTeachplan</span><span class="params">(Long teachplanId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (teachplanId == <span class="keyword">null</span>)</span><br><span class="line">        XueChengPlusException.cast(<span class="string">&quot;课程计划id为空&quot;</span>);</span><br><span class="line">    LambdaQueryWrapper&lt;Teachplan&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    <span class="comment">// select * from teachplan where parentid = &#123;当前章计划id&#125;</span></span><br><span class="line">    queryWrapper.eq(Teachplan::getParentid, teachplanId);</span><br><span class="line">    <span class="comment">// 获取一下查询的条目数</span></span><br><span class="line">    Integer count = teachplanMapper.selectCount(queryWrapper);</span><br><span class="line">    <span class="comment">// 如果当前课程计划下有小节，则抛异常</span></span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">0</span>)</span><br><span class="line">        XueChengPlusException.cast(<span class="string">&quot;课程计划信息还有子级信息，无法操作&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 课程计划下无小节，直接删除该课程计划和对应的媒资信息</span></span><br><span class="line">        teachplanMapper.deleteById(teachplanId);</span><br><span class="line">        <span class="comment">// 条件构造器</span></span><br><span class="line">        LambdaQueryWrapper&lt;TeachplanMedia&gt; mediaLambdaQueryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">        <span class="comment">// 删除媒资信息中对应teachplanId的数据</span></span><br><span class="line">        mediaLambdaQueryWrapper.eq(TeachplanMedia::getTeachplanId, teachplanId);</span><br><span class="line">        teachplanMediaMapper.delete(mediaLambdaQueryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></li>
<li>完善Controller层接口<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;课程计划删除&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/teachplan/&#123;teachplanId&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteTeachplan</span><span class="params">(<span class="meta">@PathVariable</span> Long teachplanId)</span> </span>&#123;</span><br><span class="line">    teachplanService.deleteTeachplan(teachplanId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="接口测试-5"><a href="#接口测试-5" class="headerlink" title="接口测试"></a>接口测试</h3><ul>
<li>删除有子计划的章节<br><img src="https://s1.ax1x.com/2023/02/07/pSgDeN8.png" alt=""></li>
<li>删除没有子计划的章节和小节<br><img src="https://s1.ax1x.com/2023/02/07/pSgDUCF.png" alt=""></li>
<li>删除有媒资信息的小节后，去数据库中查看对应的媒资信息是否真的被删除</li>
</ul>
<h2 id="课程计划排序"><a href="#课程计划排序" class="headerlink" title="课程计划排序"></a>课程计划排序</h2><h3 id="需求分析-7"><a href="#需求分析-7" class="headerlink" title="需求分析"></a>需求分析</h3><ul>
<li>课程计划新增后默认排在同级别后面，课程计划排序的功能是可以灵活调整课程计划的显示顺序</li>
<li>上移表示将该课程计划向上移动</li>
<li>下移表示将该课程计划向下移动</li>
<li>向上移动表示和上面的课程计划交换位置，将两个课程计划的排序字段值交换</li>
<li>向下移动表示和下面的课程计划交换位置，将两个课程计划的排序字段值交换</li>
</ul>
<h3 id="接口定义-7"><a href="#接口定义-7" class="headerlink" title="接口定义"></a>接口定义</h3><ul>
<li>接口示例如下<ul>
<li>向下移动<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Request URL: http:<span class="comment">//localhost:8601/api/content/teachplan/movedown/43</span></span><br><span class="line">Request Method: POST</span><br><span class="line"><span class="number">43</span>为课程计划id</span><br></pre></td></tr></table></figure></li>
<li>向上移动<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Request URL: http:<span class="comment">//localhost:8601/api/content/teachplan/moveup/43</span></span><br><span class="line">Request Method: POST</span><br><span class="line"><span class="number">43</span>为课程计划id</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>每次传递两个参数<ol>
<li>移动类型：movedown和moveup</li>
<li>课程计划id</li>
</ol>
</li>
<li>定义接口如下<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;课程计划排序&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/teachplan/&#123;moveType&#125;/&#123;teachplanId&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderByTeachplan</span><span class="params">(<span class="meta">@PathVariable</span> String moveType, <span class="meta">@PathVariable</span> Long teachplanId)</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="接口开发-7"><a href="#接口开发-7" class="headerlink" title="接口开发"></a>接口开发</h3><ul>
<li>定义课程计划排序接口<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">orderByTeachplan</span><span class="params">(String moveType, Long teachplanId)</span></span>;</span><br></pre></td></tr></table></figure></li>
<li>编写对应的实现方法<ul>
<li>写的稍微复杂了些，其实也可以简化，在lt和orderby的前面加上判断条件就可以，但是可读性会降低<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderByTeachplan</span><span class="params">(String moveType, Long teachplanId)</span> </span>&#123;</span><br><span class="line">    Teachplan teachplan = teachplanMapper.selectById(teachplanId);</span><br><span class="line">    <span class="comment">// 获取层级和当前orderby，章节移动和小节移动的处理方式不同</span></span><br><span class="line">    Integer grade = teachplan.getGrade();</span><br><span class="line">    Integer orderby = teachplan.getOrderby();</span><br><span class="line">    <span class="comment">// 章节移动是比较同一课程id下的orderby</span></span><br><span class="line">    Long courseId = teachplan.getCourseId();</span><br><span class="line">    <span class="comment">// 小节移动是比较同一章节id下的orderby</span></span><br><span class="line">    Long parentid = teachplan.getParentid();</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;moveup&quot;</span>.equals(moveType)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (grade == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 章节上移，找到上一个章节的orderby，然后与其交换orderby</span></span><br><span class="line">            <span class="comment">// SELECT * FROM teachplan WHERE courseId = 117 AND grade = 1  AND orderby &lt; 1 ORDER BY orderby DESC LIMIT 1</span></span><br><span class="line">            LambdaQueryWrapper&lt;Teachplan&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">            queryWrapper.eq(Teachplan::getGrade, <span class="number">1</span>)</span><br><span class="line">                    .eq(Teachplan::getCourseId, courseId)</span><br><span class="line">                    .lt(Teachplan::getOrderby, orderby)</span><br><span class="line">                    .orderByDesc(Teachplan::getOrderby)</span><br><span class="line">                    .last(<span class="string">&quot;LIMIT 1&quot;</span>);</span><br><span class="line">            Teachplan tmp = teachplanMapper.selectOne(queryWrapper);</span><br><span class="line">            exchangeOrderby(teachplan, tmp);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (grade == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="comment">// 小节上移</span></span><br><span class="line">            <span class="comment">// SELECT * FROM teachplan WHERE parentId = 268 AND orderby &lt; 5 ORDER BY orderby DESC LIMIT 1</span></span><br><span class="line">            LambdaQueryWrapper&lt;Teachplan&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">            queryWrapper.eq(Teachplan::getParentid, parentid)</span><br><span class="line">                    .lt(Teachplan::getOrderby, orderby)</span><br><span class="line">                    .orderByDesc(Teachplan::getOrderby)</span><br><span class="line">                    .last(<span class="string">&quot;LIMIT 1&quot;</span>);</span><br><span class="line">            Teachplan tmp = teachplanMapper.selectOne(queryWrapper);</span><br><span class="line">            exchangeOrderby(teachplan, tmp);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;movedown&quot;</span>.equals(moveType)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (grade == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 章节下移</span></span><br><span class="line">            <span class="comment">// SELECT * FROM teachplan WHERE courseId = 117 AND grade = 1 AND orderby &gt; 1 ORDER BY orderby ASC LIMIT 1</span></span><br><span class="line">            LambdaQueryWrapper&lt;Teachplan&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">            queryWrapper.eq(Teachplan::getCourseId, courseId)</span><br><span class="line">                    .eq(Teachplan::getGrade, grade)</span><br><span class="line">                    .gt(Teachplan::getOrderby, orderby)</span><br><span class="line">                    .orderByAsc(Teachplan::getOrderby)</span><br><span class="line">                    .last(<span class="string">&quot;LIMIT 1&quot;</span>);</span><br><span class="line">            Teachplan tmp = teachplanMapper.selectOne(queryWrapper);</span><br><span class="line">            exchangeOrderby(teachplan, tmp);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (grade == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="comment">// 小节下移</span></span><br><span class="line">            <span class="comment">// SELECT * FROM teachplan WHERE parentId = 268 AND orderby &gt; 1 ORDER BY orderby ASC LIMIT 1</span></span><br><span class="line">            LambdaQueryWrapper&lt;Teachplan&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">            queryWrapper.eq(Teachplan::getParentid, parentid)</span><br><span class="line">                    .gt(Teachplan::getOrderby, orderby)</span><br><span class="line">                    .orderByAsc(Teachplan::getOrderby)</span><br><span class="line">                    .last(<span class="string">&quot;LIMIT 1&quot;</span>);</span><br><span class="line">            Teachplan tmp = teachplanMapper.selectOne(queryWrapper);</span><br><span class="line">            exchangeOrderby(teachplan, tmp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 交换两个Teachplan的orderby</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> teachplan </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tmp </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">exchangeOrderby</span><span class="params">(Teachplan teachplan, Teachplan tmp)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (tmp == <span class="keyword">null</span>)</span><br><span class="line">        XueChengPlusException.cast(<span class="string">&quot;已经到头啦，不能再移啦&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 交换orderby，更新</span></span><br><span class="line">        Integer orderby = teachplan.getOrderby();</span><br><span class="line">        Integer tmpOrderby = tmp.getOrderby();</span><br><span class="line">        teachplan.setOrderby(tmpOrderby);</span><br><span class="line">        tmp.setOrderby(orderby);</span><br><span class="line">        teachplanMapper.updateById(tmp);</span><br><span class="line">        teachplanMapper.updateById(teachplan);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>完善Controller<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;课程计划排序&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/teachplan/&#123;moveType&#125;/&#123;teachplanId&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderByTeachplan</span><span class="params">(<span class="meta">@PathVariable</span> String moveType, <span class="meta">@PathVariable</span> Long teachplanId)</span> </span>&#123;</span><br><span class="line">    teachplanService.orderByTeachplan(moveType, teachplanId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="接口测试-6"><a href="#接口测试-6" class="headerlink" title="接口测试"></a>接口测试</h3><ul>
<li>可以随意打乱顺序，且移动到最上或最下也会给出提示<br><img src="https://s1.ax1x.com/2023/02/07/pSgROuF.png" alt=""></li>
</ul>
<h2 id="师资管理"><a href="#师资管理" class="headerlink" title="师资管理"></a>师资管理</h2><h3 id="需求分析-8"><a href="#需求分析-8" class="headerlink" title="需求分析"></a>需求分析</h3><ul>
<li>这部分需要完成师资信息的查询、修改、新增、删除功能<div class="note warning no-icon flat"><p>注意：只允许向机构自己的课程中添加老师、删除老师，机构id统一使用<code>1232141425L</code></p>
</div></li>
<li>不过这里机构校验在前面的新增课程已经完成了，不允许修改本机构外的课程</li>
</ul>
<h3 id="接口定义-8"><a href="#接口定义-8" class="headerlink" title="接口定义"></a>接口定义</h3><ul>
<li>接口示例<div class="tabs" id="内容管理实战教师信息4接口"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#内容管理实战教师信息4接口-1">查询教师</button></li><li class="tab"><button type="button" data-href="#内容管理实战教师信息4接口-2">添加教师</button></li><li class="tab"><button type="button" data-href="#内容管理实战教师信息4接口-3">修改教师</button></li><li class="tab"><button type="button" data-href="#内容管理实战教师信息4接口-4">删除教师</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="内容管理实战教师信息4接口-1"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">get /courseTeacher/list/<span class="number">75</span></span><br><span class="line"><span class="number">75</span>为课程id，请求参数为课程id</span><br><span class="line"></span><br><span class="line">响应结果</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">23</span>,</span><br><span class="line">    <span class="attr">&quot;courseId&quot;</span>: <span class="number">75</span>,</span><br><span class="line">    <span class="attr">&quot;teacherName&quot;</span>: <span class="string">&quot;张老师&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;position&quot;</span>: <span class="string">&quot;讲师 &quot;</span>,</span><br><span class="line">    <span class="attr">&quot;introduction&quot;</span>: <span class="string">&quot;张老师教师简介张老师教师简介张老师教师简介张老师教师简介&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;photograph &quot;</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;createDate &quot;</span>:<span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="内容管理实战教师信息4接口-2"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">post /courseTeacher</span><br><span class="line">请求参数：</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;courseId&quot;</span>: <span class="number">75</span>,</span><br><span class="line"><span class="attr">&quot;teacherName&quot;</span>: <span class="string">&quot;王老师&quot;</span>,</span><br><span class="line"><span class="attr">&quot;position&quot;</span>: <span class="string">&quot;教师职位&quot;</span>,</span><br><span class="line"><span class="attr">&quot;introduction&quot;</span>: <span class="string">&quot;教师简介&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">响应结果：</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>:<span class="number">24</span>,</span><br><span class="line">    <span class="attr">&quot;courseId&quot;</span>:<span class="number">75</span>,</span><br><span class="line">    <span class="attr">&quot;teacherName&quot;</span>:<span class="string">&quot;王老师&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;position&quot;</span>:<span class="string">&quot;教师职位&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;introduction&quot;</span>:<span class="string">&quot;教师简介&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;photograph&quot;</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>:<span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="内容管理实战教师信息4接口-3"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">post /courseTeacher</span><br><span class="line">请求参数：</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;id&quot;</span>: <span class="number">24</span>,</span><br><span class="line"><span class="attr">&quot;courseId&quot;</span>: <span class="number">75</span>,</span><br><span class="line"><span class="attr">&quot;teacherName&quot;</span>: <span class="string">&quot;王老师&quot;</span>,</span><br><span class="line"><span class="attr">&quot;position&quot;</span>: <span class="string">&quot;教师职位&quot;</span>,</span><br><span class="line"><span class="attr">&quot;introduction&quot;</span>: <span class="string">&quot;教师简介&quot;</span>,</span><br><span class="line"><span class="attr">&quot;photograph&quot;</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">&quot;createDate&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">响应结果：</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>:<span class="number">24</span>,</span><br><span class="line">    <span class="attr">&quot;courseId&quot;</span>:<span class="number">75</span>,</span><br><span class="line">    <span class="attr">&quot;teacherName&quot;</span>:<span class="string">&quot;王老师&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;position&quot;</span>:<span class="string">&quot;教师职位&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;introduction&quot;</span>:<span class="string">&quot;教师简介&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;photograph&quot;</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>:<span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="内容管理实战教师信息4接口-4"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">delete /ourseTeacher/course/<span class="number">75</span>/<span class="number">26</span></span><br><span class="line"><span class="number">75</span>:课程id</span><br><span class="line"><span class="number">26</span>:教师id，即course_teacher表的主键</span><br><span class="line"></span><br><span class="line">请求参数：课程id、教师id</span><br><span class="line"></span><br><span class="line">响应：状态码<span class="number">200</span>，不返回信息</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></li>
<li>从接口示例中可以看到，新增和删除用的是同一个接口，判断请求是新增还是删除，是根据请求参数中是否传递了id来决定的<ul>
<li>请求参数中没有id，则为新增教师</li>
<li>请求参数中有id，则为修改教师</li>
</ul>
</li>
<li>定义的接口如下<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(value = &quot;教师信息相关接口&quot;, tags = &quot;教师信息相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseTeacherController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CourseTeacherService courseTeacherService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;查询教师信息接口&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/courseTeacher/list/&#123;courseId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CourseTeacher&gt; <span class="title">getCourseTeacherList</span><span class="params">(<span class="meta">@PathVariable</span> Long courseId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加/修改教师信息接口&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/courseTeacher&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CourseTeacher <span class="title">saveCourseTeacher</span><span class="params">(<span class="meta">@RequestBody</span> CourseTeacher courseTeacher)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除教师信息接口&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/courseTeacher/course/&#123;courseId&#125;/&#123;teacherId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteCourseTeacher</span><span class="params">(<span class="meta">@PathVariable</span> Long courseId, <span class="meta">@PathVariable</span> Long teacherId)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="接口开发-8"><a href="#接口开发-8" class="headerlink" title="接口开发"></a>接口开发</h3><ul>
<li><p>定义Service接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CourseTeacherService</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;CourseTeacher&gt; <span class="title">getCourseTeacherList</span><span class="params">(Long courseId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">CourseTeacher <span class="title">saveCourseTeacher</span><span class="params">(CourseTeacher courseTeacher)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteCourseTeacher</span><span class="params">(Long courseId, Long teacherId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写对应的实现方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseTeacherServiceImpl</span> <span class="keyword">implements</span> <span class="title">CourseTeacherService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CourseTeacherMapper courseTeacherMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CourseTeacher&gt; <span class="title">getCourseTeacherList</span><span class="params">(Long courseId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// SELECT * FROM course_teacher WHERE course_id = 117</span></span><br><span class="line">        LambdaQueryWrapper&lt;CourseTeacher&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(CourseTeacher::getCourseId, courseId);</span><br><span class="line">        List&lt;CourseTeacher&gt; courseTeachers = courseTeacherMapper.selectList(queryWrapper);</span><br><span class="line">        <span class="keyword">return</span> courseTeachers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CourseTeacher <span class="title">saveCourseTeacher</span><span class="params">(CourseTeacher courseTeacher)</span> </span>&#123;</span><br><span class="line">        Long id = courseTeacher.getId();</span><br><span class="line">        <span class="keyword">if</span> (id == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// id为null，新增教师</span></span><br><span class="line">            CourseTeacher teacher = <span class="keyword">new</span> CourseTeacher();</span><br><span class="line">            BeanUtils.copyProperties(courseTeacher, teacher);</span><br><span class="line">            teacher.setCreateDate(LocalDateTime.now());</span><br><span class="line">            <span class="keyword">int</span> flag = courseTeacherMapper.insert(teacher);</span><br><span class="line">            <span class="keyword">if</span> (flag &lt;= <span class="number">0</span>)</span><br><span class="line">                XueChengPlusException.cast(<span class="string">&quot;新增失败&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> getCourseTeacher(teacher);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// id不为null，修改教师</span></span><br><span class="line">            CourseTeacher teacher = courseTeacherMapper.selectById(id);</span><br><span class="line">            BeanUtils.copyProperties(courseTeacher, teacher);</span><br><span class="line">            <span class="keyword">int</span> flag = courseTeacherMapper.updateById(teacher);</span><br><span class="line">            <span class="keyword">if</span> (flag &lt;= <span class="number">0</span>)</span><br><span class="line">                XueChengPlusException.cast(<span class="string">&quot;修改失败&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> getCourseTeacher(teacher);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteCourseTeacher</span><span class="params">(Long courseId, Long teacherId)</span> </span>&#123;</span><br><span class="line">        LambdaQueryWrapper&lt;CourseTeacher&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(CourseTeacher::getId, teacherId);</span><br><span class="line">        queryWrapper.eq(CourseTeacher::getCourseId, courseId);</span><br><span class="line">        <span class="keyword">int</span> flag = courseTeacherMapper.delete(queryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (flag &lt; <span class="number">0</span>)</span><br><span class="line">            XueChengPlusException.cast(<span class="string">&quot;删除失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CourseTeacher <span class="title">getCourseTeacher</span><span class="params">(CourseTeacher courseTeacher)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> courseTeacherMapper.selectById(courseTeacher.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="接口测试-7"><a href="#接口测试-7" class="headerlink" title="接口测试"></a>接口测试</h3><ul>
<li>进入教师设置页页面，对教师信息进行增删改查<br><img src="https://s1.ax1x.com/2023/02/07/pSgqOKA.png" alt=""></li>
</ul>
<h2 id="删除课程"><a href="#删除课程" class="headerlink" title="删除课程"></a>删除课程</h2><h3 id="需求分析-9"><a href="#需求分析-9" class="headerlink" title="需求分析"></a>需求分析</h3><ul>
<li>课程的审核状态为未提交时方可删除。</li>
<li>删除课程需要删除课程相关的基本信息、营销信息、课程计划、课程教师信息。</li>
</ul>
<h3 id="接口定义-9"><a href="#接口定义-9" class="headerlink" title="接口定义"></a>接口定义</h3><ul>
<li>删除课程接口示例如下<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delete /course/<span class="number">87</span></span><br><span class="line"><span class="number">87</span>为课程id</span><br><span class="line"></span><br><span class="line">请求参数：课程id</span><br><span class="line"></span><br><span class="line">响应：状态码<span class="number">200</span>，不返回信息</span><br></pre></td></tr></table></figure></li>
<li>定义的接口如下，这里需要指定companyId，只能删除本机构的课程<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;删除课程&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/course/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteCourse</span><span class="params">(<span class="meta">@PathVariable</span> Long courseId)</span> </span>&#123;</span><br><span class="line">    Long companyId = <span class="number">1232141425L</span>;</span><br><span class="line">    courseBaseInfoService.delectCourse(companyId,courseId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="接口开发-9"><a href="#接口开发-9" class="headerlink" title="接口开发"></a>接口开发</h3><ul>
<li>定义Service接口<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delectCourse</span><span class="params">(Long companyId, Long courseId)</span></span>;</span><br></pre></td></tr></table></figure></li>
<li>编写接口实现<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delectCourse</span><span class="params">(Long companyId, Long courseId)</span> </span>&#123;</span><br><span class="line">    CourseBase courseBase = courseBaseMapper.selectById(courseId);</span><br><span class="line">    <span class="keyword">if</span> (!companyId.equals(courseBase.getCompanyId()))</span><br><span class="line">        XueChengPlusException.cast(<span class="string">&quot;只允许删除本机构的课程&quot;</span>);</span><br><span class="line">    <span class="comment">// 删除课程教师信息</span></span><br><span class="line">    LambdaQueryWrapper&lt;CourseTeacher&gt; teacherLambdaQueryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    teacherLambdaQueryWrapper.eq(CourseTeacher::getCourseId, courseId);</span><br><span class="line">    courseTeacherMapper.delete(teacherLambdaQueryWrapper);</span><br><span class="line">    <span class="comment">// 删除课程计划</span></span><br><span class="line">    LambdaQueryWrapper&lt;Teachplan&gt; teachplanLambdaQueryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    teachplanLambdaQueryWrapper.eq(Teachplan::getCourseId, courseId);</span><br><span class="line">    teachplanMapper.delete(teachplanLambdaQueryWrapper);</span><br><span class="line">    <span class="comment">// 删除营销信息</span></span><br><span class="line">    courseMarketMapper.deleteById(courseId);</span><br><span class="line">    <span class="comment">// 删除课程基本信息</span></span><br><span class="line">    courseBaseMapper.deleteById(courseId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="接口测试-8"><a href="#接口测试-8" class="headerlink" title="接口测试"></a>接口测试</h3><ul>
<li>当我们尝试删除非本机构的课程时，会给出错误提示信息<br><img src="https://s1.ax1x.com/2023/02/07/pSgjILd.png" alt=""></li>
<li>当我们删除本机构课程时，会将课程对应的教师信息、课程计划、营销信息、课程基本信息均删除</li>
</ul>
<link rel="stylesheet" href="/css/bilicard.css" type="text/css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Kyle Violet</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://cyborg2077.github.io/2023/02/02/XuechengOnlinePart2/">https://cyborg2077.github.io/2023/02/02/XuechengOnlinePart2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://cyborg2077.github.io" target="_blank">Kyle's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringBoot/">SpringBoot</a><a class="post-meta__tags" href="/tags/SpringCloud/">SpringCloud</a><a class="post-meta__tags" href="/tags/MyBatisPlus/">MyBatisPlus</a></div><div class="post_share"><div class="social-share" data-image="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic3.zhimg.com%2Fv2-dbe4189cad999946abdcd174fba140ea_r.jpg&amp;refer=http%3A%2F%2Fpic3.zhimg.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1651217592&amp;t=44946406f8e7b9ed15f483e0495b33c9" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">不给糖就捣蛋~</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.svg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.svg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.svg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.svg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></button></div><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/02/10/XuechengOnlinePart3/"><img class="prev-cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fi0.hdslb.com%2Fbfs%2Farticle%2F7195c774995376cbaf3c2868706521746c0e9142.png&amp;refer=http%3A%2F%2Fi0.hdslb.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1645330580&amp;t=7ef089d6818c156c451e5072f53f3597" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">学成在线--媒资管理模块开发</div></div></a></div><div class="next-post pull-right"><a href="/2023/01/29/XuechengOnlinePart1/"><img class="next-cover" src="https://img1.baidu.com/it/u=2579164449,2431217981&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=800&amp;h=500" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">学成在线--项目基础环境搭建</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="cols"><div class="col"><div class="container"><div class="front avatarPanel"><div class="inner"><div class="player-title">Attributes</div><div class="player-avatar"><img src="https://s2.loli.net/2022/04/18/fj4XvrdM5o62hbA.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div></div></div><div class="back attributesPanel"><div class="inner"><div class="player-lv">LV.11</div><div class="player-name">Kyle Violet</div><div class="attributes-value"><div class="attributes-value-item"><a href="/archives/"><div class="attributes">文章</div><div class="value-bar"><div class="value-bar-fill" style="width:52.50%"><div class="value-bar-fill-in" style="background: rgba(89, 230, 54,0.6)"></div></div></div><span>105/200</span></a></div><div class="attributes-value-item"><a href="/tags/"><div class="attributes">标签</div><div class="value-bar"><div class="value-bar-fill" style="width:86.00%"><div class="value-bar-fill-in" style="background: rgba(224, 20, 20, 0.6)"></div></div></div><span>86/100</span></a></div><div class="attributes-value-item"><a href="/categories/"><div class="attributes">分类</div><div class="value-bar"><div class="value-bar-fill" style="width:10.00%"><div class="value-bar-fill-in" style="background: rgba(30, 97, 226, 0.6)"></div></div></div><span>10/100</span></a></div></div></div></div></div></div><div class="col"><div class="container"><div class="front descriptionPanel"><div class="inner"><div class="player_description">The furthest distance in the world <br>ls not between life and death <br>But when l stand in front of you <br> Yet you don't know that l love you</div><div class="play-bottom"></div></div></div><div class="back buttonPanel"><div class="inner"><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Cyborg2077"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Cyborg2077" target="_blank" title="Github"><i class="iconfont icon-github"></i></a><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=1586385296&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="iconfont icon-QQ"></i></a><a class="social-icon" href="https://music.163.com/#/user/home?id=608935942" target="_blank" title="网抑云"><i class="iconfont icon-wangyiyunyinleclick"></i></a><a class="social-icon" href="https://space.bilibili.com/160218990" target="_blank" title="Bilibili"><i class="iconfont icon-bilibili"></i></a><a class="social-icon" href="https://steamcommunity.com/profiles/76561198851566538/" target="_blank" title="Steam"><i class="iconfont icon-steam"></i></a></div><div class="play-bottom"></div></div></div></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">如果在阅读过程中遇到了问题，可以随时联系我，看到了会在第一时间给出回复（不负责DEBUG，除非我真的写的有问题），在上面名片的背面点击QQ图标就可以了哦（免加好友的临时会话）<br><br>评论区现在采用Giscus，需登录Github方能评论<br><br>碎碎念移至生活版块的闲言碎语，使用TimeLine外挂标签替代</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%99%E5%9C%A8%E6%9C%80%E5%89%8D"><span class="toc-number">1.</span> <span class="toc-text">写在最前</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">模块需求分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">2.1.</span> <span class="toc-text">什么是需求分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.2.</span> <span class="toc-text">模块介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B"><span class="toc-number">2.3.</span> <span class="toc-text">业务流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%95%8C%E9%9D%A2%E5%8E%9F%E5%9E%8B"><span class="toc-number">2.4.</span> <span class="toc-text">界面原型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.5.</span> <span class="toc-text">数据模型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%9D%97%E5%B7%A5%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">创建模块工程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E5%B7%A5%E7%A8%8B%E7%BB%93%E6%9E%84"><span class="toc-number">3.1.</span> <span class="toc-text">模块工程结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%9D%97%E5%B7%A5%E7%A8%8B-1"><span class="toc-number">3.2.</span> <span class="toc-text">创建模块工程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.</span> <span class="toc-text">课程查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">4.1.</span> <span class="toc-text">需求分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B-1"><span class="toc-number">4.1.1.</span> <span class="toc-text">业务流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-1"><span class="toc-number">4.1.2.</span> <span class="toc-text">数据模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90PO"><span class="toc-number">4.1.3.</span> <span class="toc-text">生成PO</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89"><span class="toc-number">4.2.</span> <span class="toc-text">接口定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89%E5%88%86%E6%9E%90"><span class="toc-number">4.2.1.</span> <span class="toc-text">接口定义分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E6%9F%A5%E8%AF%A2%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89"><span class="toc-number">4.2.2.</span> <span class="toc-text">课程查询接口定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Swagger%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.2.3.</span> <span class="toc-text">Swagger介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="toc-number">4.3.</span> <span class="toc-text">接口开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DAO%E5%BC%80%E5%8F%91"><span class="toc-number">4.3.1.</span> <span class="toc-text">DAO开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service%E5%BC%80%E5%8F%91"><span class="toc-number">4.3.2.</span> <span class="toc-text">Service开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E4%BB%A3%E7%A0%81%E5%AE%8C%E5%96%84"><span class="toc-number">4.3.3.</span> <span class="toc-text">接口代码完善</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95"><span class="toc-number">4.4.</span> <span class="toc-text">接口测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpClient%E6%B5%8B%E8%AF%95"><span class="toc-number">4.4.1.</span> <span class="toc-text">HttpClient测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.4.2.</span> <span class="toc-text">导入系统管理服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-number">4.4.3.</span> <span class="toc-text">解决跨域问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83"><span class="toc-number">4.4.4.</span> <span class="toc-text">前后端联调</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.</span> <span class="toc-text">课程分类查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-1"><span class="toc-number">5.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89-1"><span class="toc-number">5.2.</span> <span class="toc-text">接口定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91-1"><span class="toc-number">5.3.</span> <span class="toc-text">接口开发</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E8%AF%BE%E7%A8%8B"><span class="toc-number">6.</span> <span class="toc-text">新增课程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-2"><span class="toc-number">6.1.</span> <span class="toc-text">需求分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B-2"><span class="toc-number">6.1.1.</span> <span class="toc-text">业务流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-2"><span class="toc-number">6.1.2.</span> <span class="toc-text">数据模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89-2"><span class="toc-number">6.2.</span> <span class="toc-text">接口定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91-2"><span class="toc-number">6.3.</span> <span class="toc-text">接口开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95-1"><span class="toc-number">6.4.</span> <span class="toc-text">接口测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">6.5.</span> <span class="toc-text">异常处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="toc-number">6.5.1.</span> <span class="toc-text">异常问题分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.5.2.</span> <span class="toc-text">统一异常处理实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%B5%8B%E8%AF%95"><span class="toc-number">6.5.3.</span> <span class="toc-text">异常处理测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95"><span class="toc-number">6.5.4.</span> <span class="toc-text">面试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSR303%E6%A0%A1%E9%AA%8C"><span class="toc-number">6.6.</span> <span class="toc-text">JSR303校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E6%A0%A1%E9%AA%8C%E7%9A%84%E9%9C%80%E6%B1%82"><span class="toc-number">6.6.1.</span> <span class="toc-text">统一校验的需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E6%A0%A1%E9%AA%8C%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.6.2.</span> <span class="toc-text">统一校验实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E6%A0%A1%E9%AA%8C"><span class="toc-number">6.6.3.</span> <span class="toc-text">分组校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%A1%E9%AA%8C%E8%A7%84%E5%88%99%E4%B8%8D%E6%BB%A1%E8%B6%B3%EF%BC%9F"><span class="toc-number">6.6.4.</span> <span class="toc-text">校验规则不满足？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95-1"><span class="toc-number">6.6.5.</span> <span class="toc-text">面试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%AF%BE%E7%A8%8B"><span class="toc-number">7.</span> <span class="toc-text">修改课程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-3"><span class="toc-number">7.1.</span> <span class="toc-text">需求分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B-3"><span class="toc-number">7.1.1.</span> <span class="toc-text">业务流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-3"><span class="toc-number">7.1.2.</span> <span class="toc-text">数据模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89-3"><span class="toc-number">7.2.</span> <span class="toc-text">接口定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%BE%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="toc-number">7.2.1.</span> <span class="toc-text">查询课程信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%AF%BE%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="toc-number">7.2.2.</span> <span class="toc-text">修改课程信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91-3"><span class="toc-number">7.3.</span> <span class="toc-text">接口开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%BE%E7%A8%8B%E4%BF%A1%E6%81%AF-1"><span class="toc-number">7.3.1.</span> <span class="toc-text">查询课程信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%AF%BE%E7%A8%8B%E4%BF%A1%E6%81%AF-1"><span class="toc-number">7.3.2.</span> <span class="toc-text">修改课程信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95-2"><span class="toc-number">7.4.</span> <span class="toc-text">接口测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96"><span class="toc-number">7.5.</span> <span class="toc-text">代码优化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%BE%E7%A8%8B%E8%AE%A1%E5%88%92"><span class="toc-number">8.</span> <span class="toc-text">查询课程计划</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-4"><span class="toc-number">8.1.</span> <span class="toc-text">需求分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B-4"><span class="toc-number">8.1.1.</span> <span class="toc-text">业务流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-4"><span class="toc-number">8.2.</span> <span class="toc-text">数据模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89-4"><span class="toc-number">8.3.</span> <span class="toc-text">接口定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91-4"><span class="toc-number">8.4.</span> <span class="toc-text">接口开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95-3"><span class="toc-number">8.5.</span> <span class="toc-text">接口测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E-%E4%BF%AE%E6%94%B9%E8%AF%BE%E7%A8%8B%E8%AE%A1%E5%88%92"><span class="toc-number">9.</span> <span class="toc-text">新增&#x2F;修改课程计划</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-5"><span class="toc-number">9.1.</span> <span class="toc-text">需求分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B-5"><span class="toc-number">9.1.1.</span> <span class="toc-text">业务流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-5"><span class="toc-number">9.1.2.</span> <span class="toc-text">数据模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89-5"><span class="toc-number">9.2.</span> <span class="toc-text">接口定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91-5"><span class="toc-number">9.3.</span> <span class="toc-text">接口开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95-4"><span class="toc-number">9.4.</span> <span class="toc-text">接口测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BUG%E4%BF%AE%E6%94%B9"><span class="toc-number">9.5.</span> <span class="toc-text">BUG修改</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97%E5%AE%9E%E6%88%98"><span class="toc-number">10.</span> <span class="toc-text">内容管理模块实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%AF%BE%E7%A8%8B%E8%AE%A1%E5%88%92"><span class="toc-number">10.1.</span> <span class="toc-text">删除课程计划</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-6"><span class="toc-number">10.1.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89-6"><span class="toc-number">10.1.2.</span> <span class="toc-text">接口定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91-6"><span class="toc-number">10.1.3.</span> <span class="toc-text">接口开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95-5"><span class="toc-number">10.1.4.</span> <span class="toc-text">接口测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E8%AE%A1%E5%88%92%E6%8E%92%E5%BA%8F"><span class="toc-number">10.2.</span> <span class="toc-text">课程计划排序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-7"><span class="toc-number">10.2.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89-7"><span class="toc-number">10.2.2.</span> <span class="toc-text">接口定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91-7"><span class="toc-number">10.2.3.</span> <span class="toc-text">接口开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95-6"><span class="toc-number">10.2.4.</span> <span class="toc-text">接口测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%88%E8%B5%84%E7%AE%A1%E7%90%86"><span class="toc-number">10.3.</span> <span class="toc-text">师资管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-8"><span class="toc-number">10.3.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89-8"><span class="toc-number">10.3.2.</span> <span class="toc-text">接口定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91-8"><span class="toc-number">10.3.3.</span> <span class="toc-text">接口开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95-7"><span class="toc-number">10.3.4.</span> <span class="toc-text">接口测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%AF%BE%E7%A8%8B"><span class="toc-number">10.4.</span> <span class="toc-text">删除课程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-9"><span class="toc-number">10.4.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89-9"><span class="toc-number">10.4.2.</span> <span class="toc-text">接口定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91-9"><span class="toc-number">10.4.3.</span> <span class="toc-text">接口开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95-8"><span class="toc-number">10.4.4.</span> <span class="toc-text">接口测试</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recommend-post"><div class="item-headline"><i class="fas fa-dharmachakra"></i><span>相关推荐</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/01/29/XuechengOnlinePart1/" title="学成在线--项目基础环境搭建"><img src="https://img1.baidu.com/it/u=2579164449,2431217981&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" alt="学成在线--项目基础环境搭建"></a><div class="content"><a class="title" href="/2023/01/29/XuechengOnlinePart1/" title="学成在线--项目基础环境搭建">学成在线--项目基础环境搭建</a><time datetime="2023-03-27" title="发表于 2023-03-27">2023-03-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/28/XuechengOnlinePart4/" title="学成在线--课程发布模块开发"><img src="https://img2.baidu.com/it/u=595920241,2439700946&fm=253&fmt=auto&app=120&f=JPEG?w=1422&h=800" alt="学成在线--课程发布模块开发"></a><div class="content"><a class="title" href="/2023/02/28/XuechengOnlinePart4/" title="学成在线--课程发布模块开发">学成在线--课程发布模块开发</a><time datetime="2023-03-27" title="发表于 2023-03-27">2023-03-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/08/XuechengOnlinePart5/" title="学成在线--认证授权模块开发"><img src="https://img2.baidu.com/it/u=1767752488,2158562887&fm=253&fmt=auto&app=138&f=JPEG?w=932&h=500" alt="学成在线--认证授权模块开发"></a><div class="content"><a class="title" href="/2023/03/08/XuechengOnlinePart5/" title="学成在线--认证授权模块开发">学成在线--认证授权模块开发</a><time datetime="2023-03-27" title="发表于 2023-03-27">2023-03-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/10/XuechengOnlinePart3/" title="学成在线--媒资管理模块开发"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fi0.hdslb.com%2Fbfs%2Farticle%2F7195c774995376cbaf3c2868706521746c0e9142.png&refer=http%3A%2F%2Fi0.hdslb.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1645330580&t=7ef089d6818c156c451e5072f53f3597" alt="学成在线--媒资管理模块开发"></a><div class="content"><a class="title" href="/2023/02/10/XuechengOnlinePart3/" title="学成在线--媒资管理模块开发">学成在线--媒资管理模块开发</a><time datetime="2023-03-27" title="发表于 2023-03-27">2023-03-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/23/XuechengOnlinePart7/" title="学成在线--项目优化"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fi0.hdslb.com%2Fbfs%2Farticle%2F7195c774995376cbaf3c2868706521746c0e9142.png&refer=http%3A%2F%2Fi0.hdslb.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1645330580&t=7ef089d6818c156c451e5072f53f3597" alt="学成在线--项目优化"></a><div class="content"><a class="title" href="/2023/03/23/XuechengOnlinePart7/" title="学成在线--项目优化">学成在线--项目优化</a><time datetime="2023-03-27" title="发表于 2023-03-27">2023-03-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/17/XuechengOnlinePart6/" title="学成在线--选课学习模块开发"><img src="https://images.wallpaperscraft.com/image/single/silhouette_night_starry_sky_137292_300x168.jpg" alt="学成在线--选课学习模块开发"></a><div class="content"><a class="title" href="/2023/03/17/XuechengOnlinePart6/" title="学成在线--选课学习模块开发">学成在线--选课学习模块开发</a><time datetime="2023-03-27" title="发表于 2023-03-27">2023-03-27</time></div></div></div></div></div></div></main><footer id="footer" style="background: linear-gradient(135deg,#ace0f9,#a1c4fd)"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023  <i id="heartbeat" class="fa fas fa-heartbeat"></i> Kyle Violet</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">The worst way to miss someone is to be sitting right beside her <br> knowing you can't have her.</div></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><!--button#darkmode(type="button" title=_p('rightside.night_mode_title'))i.fas.fa-adjust--><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"><span id="percent">0<span>%</span></span></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadGiscus () {
  let nowTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light'

  const config = Object.assign({
    src: 'https://giscus.app/client.js',
    'data-repo': 'Cyborg2077/Cyborg2077.github.io',
    'data-repo-id': 'R_kgDOGflxEw',
    'data-category-id': 'DIC_kwDOGflxE84CRxKp',
    'data-mapping': 'pathname',
    'data-theme': nowTheme,
    'data-reactions-enabled': '1',
    crossorigin: 'anonymous',
    async: true
  },null)

  let ele = document.createElement('script')
  for (let key in config) {
    ele.setAttribute(key, config[key])
  }
  document.getElementById('giscus-wrap').insertAdjacentElement('afterbegin',ele)
}

function changeGiscusTheme () {
  const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light'

  function sendMessage(message) {
    const iframe = document.querySelector('iframe.giscus-frame');
    if (!iframe) return;
    iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
  }

  sendMessage({
    setConfig: {
      theme: theme
    }
  });
}

if ('Giscus' === 'Giscus' || !true) {
  if (true) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
  else loadGiscus()
} else {
  function loadOtherComment () {
    loadGiscus()
  }
}</script></div><div class="aplayer no-destroy" data-id="6831019121" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><script async src="/js/diytitle.js"></script><script src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/readPercent.js"></script><script>var meting_api='https://api.injahow.cn/meting/?server=netease&type=playlist&id=8103908316'</script><script src="/js/sun_moon.js" async></script><script src="/js/chocolate.js" async></script><script src="/js/universe.js" async></script><canvas id="universe"></canvas><script id="canvas_nest" defer="defer" color="255,192,203" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法制,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["link[rel=\"canonical\"]","meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: true,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', 'G-RQZSMGWCQS', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
    function butterfly_categories_card_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<style>li.categoryBar-list-item{width:32.3%;}.categoryBar-list{max-height: 190px;overflow:auto;}.categoryBar-list::-webkit-scrollbar{width:0!important}@media screen and (max-width: 650px){.categoryBar-list{max-height: 160px;}}</style><div class="recent-post-item" style="height:auto;width:100%;padding:0px;"><div id="categoryBar"><ul class="categoryBar-list"><li class="categoryBar-list-item" style="background:url(http://p0.itc.cn/images03/20200525/332e1ea10c634cbfaf0dfc5b69d00a3c.jpeg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/力扣/&quot;);" href="javascript:void(0);">力扣</a><span class="categoryBar-list-count">12</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(http://p8.itc.cn/images03/20200525/377f4f7044fe49b0bb932f43ef4f4891.jpeg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/踩坑日记/&quot;);" href="javascript:void(0);">踩坑日记</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(http://p8.itc.cn/images03/20200525/0ed549edde2c4d5eaecc2824e753ca74.jpeg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/实用教程/&quot;);" href="javascript:void(0);">实用教程</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(http://p6.itc.cn/images03/20200525/8dedcdf6ace44a50a1deb6a9743821fe.jpeg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/刷题日志/&quot;);" href="javascript:void(0);">刷题日志</a><span class="categoryBar-list-count">14</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(http://p9.itc.cn/images03/20200525/07539bdba160465d80d23b3f16db8620.jpeg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/学习笔记/&quot;);" href="javascript:void(0);">学习笔记</a><span class="categoryBar-list-count">61</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(http://p8.itc.cn/images03/20200525/5f6cecf10ea04dec9a5d42bf9c4c3739.jpeg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/实战项目/&quot;);" href="javascript:void(0);">实战项目</a><span class="categoryBar-list-count">3</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(http://p0.itc.cn/images03/20200525/332e1ea10c634cbfaf0dfc5b69d00a3c.jpeg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/面经/&quot;);" href="javascript:void(0);">面经</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(http://p8.itc.cn/images03/20200525/377f4f7044fe49b0bb932f43ef4f4891.jpeg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/蓝桥杯/&quot;);" href="javascript:void(0);">蓝桥杯</a><span class="categoryBar-list-count">8</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(http://p8.itc.cn/images03/20200525/0ed549edde2c4d5eaecc2824e753ca74.jpeg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/学习笔记/实战项目/&quot;);" href="javascript:void(0);">实战项目</a><span class="categoryBar-list-count">7</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(http://p6.itc.cn/images03/20200525/8dedcdf6ace44a50a1deb6a9743821fe.jpeg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/杂谈/&quot;);" href="javascript:void(0);">杂谈</a><span class="categoryBar-list-count">2</span><span class="categoryBar-list-descr"></span></li></ul></div></div>';
      console.log('已挂载butterfly_categories_card')
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      }
    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    butterfly_categories_card_injector_config()
    }
  </script><script data-pjax>
  function butterfly_clock_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-clock/clock/images/weather/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_injector_config();
  }
  </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-butterfly-clock/lib/clock.min.js"></script><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><div id="ghbdages" style="overflow:hidden;max-height:90px;height:auto;text-align:center;margin-top:10px"><div class="swiper-wrapper"><div class="swiper-slide"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v5.4.0"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v4.1.0"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本站项目由Github托管"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a></div><div class="swiper-slide"><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></div></div></div><style>a.github-badge:hover:before {display:none}</style>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="/js/runtime.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-footer-beautify/lib/swiperbdage_init.min.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/11/05/NewFeaturesOfJava8/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://pic2.zhimg.com/v2-d0a0172a71b6bc4ff18cd1f11bfa6b3b_r.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-11-05</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/11/05/NewFeaturesOfJava8/&quot;);" href="javascript:void(0);" alt="">Java 8新特性</a><div class="blog-slider__text">Java8新特性，之前只是草草看了一下，后来发现stream流操作挺好用的，来补一下票</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/11/05/NewFeaturesOfJava8/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/12/22/MeassageQueue/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://img0.baidu.com/it/u=1415156609,1199509453&amp;fm=253&amp;fmt=auto&amp;app=120&amp;f=JPEG?w=949&amp;h=500" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-12-22</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/12/22/MeassageQueue/&quot;);" href="javascript:void(0);" alt="">MeassageQueue</a><div class="blog-slider__text">消息队列相关学习记录</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/12/22/MeassageQueue/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/12/21/Docker/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://img2.baidu.com/it/u=4052816064,1042373333&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=889&amp;h=500" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-12-21</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/12/21/Docker/&quot;);" href="javascript:void(0);" alt="">Docker</a><div class="blog-slider__text">Docker实用篇学习笔记</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/12/21/Docker/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/12/24/ElasticSearch/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://img2.baidu.com/it/u=852907915,3528076091&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=PNG?w=889&amp;h=500" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-12-24</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/12/24/ElasticSearch/&quot;);" href="javascript:void(0);" alt="">ElasticSearch</a><div class="blog-slider__text">分布式搜索引擎</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/12/24/ElasticSearch/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/11/08/SpringCloud/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://img1.baidu.com/it/u=2579164449,2431217981&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=800&amp;h=500" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-11-08</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/11/08/SpringCloud/&quot;);" href="javascript:void(0);" alt="">SpringCloud</a><div class="blog-slider__text">SpringCloud学习笔记</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/11/08/SpringCloud/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/09/29/ReggieTakeOut/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://img0.baidu.com/it/u=1144121390,2782791282&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=889&amp;h=500" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-09-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/09/29/ReggieTakeOut/&quot;);" href="javascript:void(0);" alt="">瑞吉外卖</a><div class="blog-slider__text">瑞吉外卖实战项目</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/09/29/ReggieTakeOut/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/10/22/RedisPractice/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://img0.baidu.com/it/u=4155835667,974645702&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=PNG?w=889&amp;h=500" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-22</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/10/22/RedisPractice/&quot;);" href="javascript:void(0);" alt="">Redis实战篇</a><div class="blog-slider__text">Redis实战篇，包含优惠券秒杀，分布式锁，消息队列用户签到等功能</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/10/22/RedisPractice/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/issues.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"log":false});</script></body></html>